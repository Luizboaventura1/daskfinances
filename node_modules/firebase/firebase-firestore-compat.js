!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase,e.firebase.INTERNAL.modularAPIs)}(this,function(Yg,Jg){"use strict";try{!(function(){function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l,t=e(Yg);function n(t){const n=[];let r=0;for(let i=0;i<t.length;i++){let e=t.charCodeAt(i);e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(55296==(64512&e)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++i)),n[r++]=e>>18|240,n[r++]=e>>12&63|128):n[r++]=e>>12|224,n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}const r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let h=0;h<n.length;h+=3){var s=n[h],a=h+1<n.length,o=a?n[h+1]:0,u=h+2<n.length,c=u?n[h+2]:0;let e=(15&o)<<2|c>>6,t=63&c;u||(t=64,a||(e=64)),i.push(r[s>>2],r[(3&s)<<4|o>>4],r[e],r[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var i,s,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(i=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&i)):239<a&&a<365?(s=((7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))):(i=e[n++],s=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&i)<<6|63&s))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let u=0;u<e.length;){var i=n[e.charAt(u++)],s=u<e.length?n[e.charAt(u)]:0;++u;var a=u<e.length?n[e.charAt(u)]:64;++u;var o=u<e.length?n[e.charAt(u)]:64;if(++u,null==i||null==s||null==a||null==o)throw new c;r.push(i<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==o&&r.push(a<<6&192|o))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class c extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(e){return e=e,t=n(e),r.encodeByteArray(t,!0).replace(/\./g,"");var t};const i=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,s=()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&function(e){try{return r.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(e[1]);return t&&JSON.parse(t)}},o=()=>{try{return i()||(()=>{if("undefined"!=typeof process&&void 0!==process.env){var e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0}})()||s()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}};function u(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function h(){return!function(){var e=null===(e=o())||void 0===e?void 0:e.forceEnvironment;if("node"===e)return 1;if("browser"!==e)try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class d extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,d.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,f.prototype.create)}}class f{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],s=s?(r=n,s.replace(g,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",s=`${this.serviceName}: ${s} (${i}).`;return new d(i,s,n)}}const g=/\{\$([^}]+)}/g;function m(e){return e&&e._delegate?e._delegate:e}class p{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}(Yd=l=l||{})[Yd.DEBUG=0]="DEBUG",Yd[Yd.VERBOSE=1]="VERBOSE",Yd[Yd.INFO=2]="INFO",Yd[Yd.WARN=3]="WARN",Yd[Yd.ERROR=4]="ERROR",Yd[Yd.SILENT=5]="SILENT";const y={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},v=l.INFO,w={[l.DEBUG]:"log",[l.VERBOSE]:"log",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error"},b=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=w[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};var I,E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},T={},_=E||self;function S(){}function x(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function D(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var A="closure_uid_"+(1e9*Math.random()>>>0),C=0;function N(e,t,n){return e.call.apply(e.bind,arguments)}function k(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function R(e,t,n){return(R=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?N:k).apply(null,arguments)}function M(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function F(e,s){function t(){}t.prototype=s.prototype,e.$=s.prototype,e.prototype=new t,(e.prototype.constructor=e).ac=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function L(){this.s=this.s,this.o=this.o}L.prototype.s=!1,L.prototype.ra=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,A)&&e[A]||(e[A]=++C))},L.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const O=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function P(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function V(t){for(let e=1;e<arguments.length;e++){var n=arguments[e];if(x(n)){var r=t.length||0,i=n.length||0;t.length=r+i;for(let e=0;e<i;e++)t[r+e]=n[e]}else t.push(n)}}function q(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}q.prototype.h=function(){this.defaultPrevented=!0};var B=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{_.addEventListener("test",S,t),_.removeEventListener("test",S,t)}catch(e){}return e}();function U(e){return/^[\s\xa0]*$/.test(e)}var j=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function K(e,t){return e<t?-1:t<e?1:0}function G(){var e=_.navigator;return(e=e&&e.userAgent)?e:""}function z(e){return-1!=G().indexOf(e)}function $(e){return $[" "](e),e}function Q(e,t,n){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=n(t)}$[" "]=S;var H,W=z("Opera"),X=z("Trident")||z("MSIE"),Y=z("Edge"),J=Y||X,Z=z("Gecko")&&!(-1!=G().toLowerCase().indexOf("webkit")&&!z("Edge"))&&!(z("Trident")||z("MSIE"))&&!z("Edge"),ee=-1!=G().toLowerCase().indexOf("webkit")&&!z("Edge");function te(){var e=_.document;return e?e.documentMode:void 0}e:{var ne="",re=(re=G(),Z?/rv:([^\);]+)(\)|;)/.exec(re):Y?/Edge\/([\d\.]+)/.exec(re):X?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(re):ee?/WebKit\/(\S+)/.exec(re):W?/(?:Version)[ \/]?(\S+)/.exec(re):void 0);if(re&&(ne=re?re[1]:""),X){re=te();if(null!=re&&re>parseFloat(ne)){H=String(re);break e}}H=ne}var ie={};var se=_.document&&X&&(te()||parseInt(H,10))||void 0;function ae(e,t){if(q.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Z){e:{try{$(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:oe[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&ae.$.h.call(this)}}F(ae,q);var oe={2:"touch",3:"pen",4:"mouse"};ae.prototype.h=function(){ae.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var ue="closure_listenable_"+(1e6*Math.random()|0),ce=0;function he(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++ce,this.fa=this.ia=!1}function le(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function de(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function fe(e){const t={};for(const n in e)t[n]=e[n];return t}const ge="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function me(t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(let e=0;e<ge.length;e++)n=ge[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function pe(e){this.src=e,this.g={},this.h=0}function ye(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=O(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(le(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function ve(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}pe.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=ve(e,t,r,i);return-1<a?(t=e[a],n||(t.ia=!1)):((t=new he(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var we="closure_lm_"+(1e6*Math.random()|0),be={};function Ie(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}r=Ae(r);return t&&t[ue]?t.P(n,r,D(i)?!!i.capture:!!i,s):Ee(t,n,r,!0,i,s)}(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Ie(e,t[s],n,r,i);return null}return n=Ae(n),e&&e[ue]?e.O(t,n,D(r)?!!r.capture:!!r,i):Ee(e,t,n,!1,r,i)}function Ee(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=D(i)?!!i.capture:!!i,o=xe(e);if(o||(e[we]=o=new pe(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function(){const n=Se;return function e(t){return n.call(e.src,e.listener,t)}}(),(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(i=!B?a:i)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(_e(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Te(e){var t,n,r;"number"!=typeof e&&e&&!e.fa&&((t=e.src)&&t[ue]?ye(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(_e(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=xe(t))?(ye(n,e),0==n.h&&(n.src=null,t[we]=null)):le(e)))}function _e(e){return e in be?be[e]:be[e]="on"+e}function Se(e,t){var n,r;return e=!!e.fa||(t=new ae(t,this),n=e.listener,r=e.la||e.src,e.ia&&Te(e),n.call(r,t))}function xe(e){return(e=e[we])instanceof pe?e:null}var De="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ae(t){return"function"==typeof t?t:(t[De]||(t[De]=function(e){return t.handleEvent(e)}),t[De])}function Ce(){L.call(this),this.i=new pe(this),(this.S=this).J=null}function Ne(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t?t=new q(t,e):t instanceof q?t.target=t.target||e:(a=t,me(t=new q(r,e),a)),a=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],a=ke(s,r,!0,t)&&a;if(a=ke(s=t.g=e,r,!0,t)&&a,a=ke(s,r,!1,t)&&a,n)for(i=0;i<n.length;i++)a=ke(s=t.g=n[i],r,!1,t)&&a}function ke(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a,o,u=t[s];u&&!u.fa&&u.capture==n&&(a=u.listener,o=u.la||u.src,u.ia&&ye(e.i,u),i=!1!==a.call(o,r)&&i)}return i&&!r.defaultPrevented}F(Ce,L),Ce.prototype[ue]=!0,Ce.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else i=D(i)?!!i.capture:!!i,r=Ae(r),t&&t[ue]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=ve(a=t.g[n],r,i,s))&&(le(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):(t=t&&xe(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?ve(n,r,i,s):t)?n[t]:null)&&Te(r))}(this,e,t,n,r)},Ce.prototype.N=function(){if(Ce.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)le(n[r]);delete t.g[e],t.h--}}this.J=null},Ce.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Ce.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Re=_.JSON.stringify;var Me,Fe=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Le,e=>e.reset());class Le{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Oe(e,t){var n;Me||(n=_.Promise.resolve(void 0),Me=function(){n.then(qe)}),Pe||(Me(),Pe=!0),Ve.add(e,t)}var Pe=!1,Ve=new class{constructor(){this.h=this.g=null}add(e,t){const n=Fe.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function qe(){for(var e;e=function(){var e=Ve;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){_.setTimeout(()=>{throw e},0)}(e)}var t=Fe;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Pe=!1}function Be(e,t){Ce.call(this),this.h=e||1,this.g=t||_,this.j=R(this.qb,this),this.l=Date.now()}function Ue(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function je(e,t,n){if("function"==typeof e)n&&(e=R(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=R(e.handleEvent,e)}return 2147483647<Number(t)?-1:_.setTimeout(e,t||0)}F(Be,Ce),(I=Be.prototype).ga=!1,I.T=null,I.qb=function(){var e;this.ga&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ne(this,"tick"),this.ga&&(Ue(this),this.start())))},I.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},I.N=function(){Be.$.N.call(this),Ue(this),delete this.g};class Ke extends L{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=je(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ge(e){L.call(this),this.h=e,this.g={}}F(Ge,L);var ze=[];function $e(e,t,n,r){Array.isArray(n)||(n&&(ze[0]=n.toString()),n=ze);for(var i=0;i<n.length;i++){var s=Ie(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Qe(e){de(e.g,function(e,t){this.g.hasOwnProperty(t)&&Te(e)},e),e.g={}}function He(){this.g=!0}function We(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return Re(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}Ge.prototype.N=function(){Ge.$.N.call(this),Qe(this)},Ge.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},He.prototype.Ea=function(){this.g=!1},He.prototype.info=function(){};var Xe={},Ye=null;function Je(){return Ye=Ye||new Ce}function Ze(e){q.call(this,Xe.Ta,e)}function et(){var e=Je();Ne(e,new Ze(e))}function tt(e,t){q.call(this,Xe.STAT_EVENT,e),this.stat=t}function nt(e){var t=Je();Ne(t,new tt(t,e))}function rt(e,t){q.call(this,Xe.Ua,e),this.size=t}function it(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){e()},t)}Xe.Ta="serverreachability",F(Ze,q),Xe.STAT_EVENT="statevent",F(tt,q),Xe.Ua="timingevent",F(rt,q);var st={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},at={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ot(){}function ut(e){return e.h||(e.h=e.i())}function ct(){}ot.prototype.h=null;E={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ht(){q.call(this,"d")}function lt(){q.call(this,"c")}function dt(){}function ft(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Ge(this),this.P=pt,this.V=new Be(e=J?125:void 0),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.aa=-1,this.J=!1,this.O=0,this.M=null,this.ca=this.K=this.ba=this.S=!1,this.h=new gt}function gt(){this.i=null,this.g="",this.h=!1}F(ht,q),F(lt,q),F(dt,ot),dt.prototype.g=function(){return new XMLHttpRequest},dt.prototype.i=function(){return{}};var mt=new dt,pt=45e3,yt={},vt={};function wt(e,t,n){e.L=1,e.v=Pt(Rt(t)),e.s=n,e.S=!0,bt(e,null)}function bt(e,t){e.G=Date.now(),Tt(e),e.A=Rt(e.v);var a,o,u,c,h,l,n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),Xt(n.i,"t",r),e.C=0,n=e.l.I,e.h=new gt,e.g=Xn(e.l,n?t:null,!e.s),0<e.O&&(e.M=new Ke(R(e.Pa,e,e.g),e.O)),$e(e.U,e.g,"readystatechange",e.nb),t=e.I?fe(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),et(),a=e.j,o=e.u,u=e.A,c=e.m,h=e.W,l=e.s,a.info(function(){if(a.g)if(l)for(var e="",t=l.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+o+"\n"+u+"\n"+e})}function It(e){return e.g&&("GET"==e.u&&2!=e.L&&e.l.Ha)}function Et(e,t,n){let r=!0,i;for(;!e.J&&e.C<n.length;){if(i=(a=n,u=o=void 0,o=(s=e).C,-1==(u=a.indexOf("\n",o))?vt:(o=Number(a.substring(o,u)),isNaN(o)?yt:(u+=1)+o>a.length?vt:(a=a.substr(u,o),s.C=u+o,a))),i==vt){4==t&&(e.o=4,nt(14),r=!1),We(e.j,e.m,null,"[Incomplete Response]");break}if(i==yt){e.o=4,nt(15),We(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}We(e.j,e.m,i,null),At(e,i)}var s,a,o,u;It(e)&&i!=vt&&i!=yt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,nt(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ca&&(e.ca=!0,(t=e.l).g==e&&t.ca&&!t.L&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),jn(t),t.L=!0,nt(11))):(We(e.j,e.m,n,"[Invalid Chunked Response]"),Dt(e),xt(e))}function Tt(e){e.Y=Date.now()+e.P,_t(e,e.P)}function _t(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=it(R(e.lb,e),t)}function St(e){e.B&&(_.clearTimeout(e.B),e.B=null)}function xt(e){0==e.l.H||e.J||zn(e.l,e)}function Dt(e){St(e);var t=e.M;t&&"function"==typeof t.ra&&t.ra(),e.M=null,Ue(e.V),Qe(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ra())}function At(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||rn(n.h,e)))if(!e.K&&rn(n.h,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;Gn(n),Fn(n)}Un(n),nt(18)}}else n.Fa=i[1],0<n.Fa-n.V&&i[2]<37500&&n.M&&0==n.A&&!n.v&&(n.v=it(R(n.ib,n),6e3));if(nn(n.h)<=1&&n.na){try{n.na()}catch(e){}n.na=void 0}}else Qn(n,11)}else if(!e.K&&n.g!=e||Gn(n),!U(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){var s=i[t];if(n.V=s[0],s=s[1],2==n.H)if("c"==s[0]){n.J=s[1],n.oa=s[2];var a=s[3];null!=a&&(n.qa=a,n.j.info("VER="+n.qa));var o=s[4];null!=o&&(n.Ga=o,n.j.info("SVER="+n.Ga));var u,c,h=s[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.K=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const g=e.g;if(g){const m=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null;m&&((u=r.h).g||-1==m.indexOf("spdy")&&-1==m.indexOf("quic")&&-1==m.indexOf("h2")||(u.j=u.l,u.g=new Set,u.h&&(sn(u,u.h),u.h=null))),!r.F||(c=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.Da=c,Ot(r.G,r.F,c))}n.H=3,n.l&&n.l.Ba(),n.ca&&(n.S=Date.now()-e.G,n.j.info("Handshake RTT: "+n.S+"ms"));var l,d,f=e;(r=n).wa=Wn(r,r.I?r.oa:null,r.Y),f.K?(an(r.h,f),l=f,(d=r.K)&&l.setTimeout(d),l.B&&(St(l),Tt(l)),r.g=f):Bn(r),0<n.i.length&&On(n)}else"stop"!=s[0]&&"close"!=s[0]||Qn(n,7);else 3==n.H&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?Qn(n,7):Mn(n):"noop"!=s[0]&&n.l&&n.l.Aa(s),n.A=0)}et()}catch(e){}}function Ct(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(x(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.sa&&"function"==typeof e.sa)return e.sa();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(x(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(x(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(I=ft.prototype).setTimeout=function(e){this.P=e},I.nb=function(e){e=e.target;const t=this.M;t&&3==Dn(e)?t.l():this.Pa(e)},I.Pa=function(e){try{if(e==this.g)e:{var t=Dn(this.g),n=this.g.Ia();this.g.da();if(!(t<3)&&(3!=t||J||this.g&&(this.h.h||this.g.ja()||An(this.g)))){this.J||4!=t||7==n||et(),St(this);var r=this.g.da();this.aa=r;t:if(It(this)){var i=An(this.g);e="";var s=i.length,a=4==Dn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Dt(this),xt(this);var o="";break t}this.h.i=new _.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:a&&n==s-1});i.splice(0,s),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==r,l=this.j,d=this.u,f=this.A,g=this.m,m=this.W,p=t,y=r,l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+m+"]: "+d+"\n"+f+"\n"+p+" "+y}),this.i){if(this.ba&&!this.K){t:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(u)){var h=u;break t}}h=null}if(!(r=h)){this.i=!1,this.o=3,nt(12),Dt(this),xt(this);break e}We(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,At(this,r)}this.S?(Et(this,t,o),J&&this.i&&3==t&&($e(this.U,this.V,"tick",this.mb),this.V.start())):(We(this.j,this.m,o,null),At(this,o)),4==t&&Dt(this),this.i&&!this.J&&(4==t?zn(this.l,this):(this.i=!1,Tt(this)))}else 400==r&&0<o.indexOf("Unknown SID")?(this.o=3,nt(12)):(this.o=0,nt(13)),Dt(this),xt(this)}}}catch(e){}var l,d,f,g,m,p,y},I.mb=function(){var e,t;this.g&&(e=Dn(this.g),t=this.g.ja(),this.C<t.length&&(St(this),Et(this,e,t),this.i&&4!=e&&Tt(this)))},I.cancel=function(){this.J=!0,Dt(this)},I.lb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.Y?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(et(),nt(17)),Dt(this),this.o=2,xt(this)):_t(this,this.Y-n)};var Nt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function kt(e,t){var n;this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof kt?(this.h=void 0!==t?t:e.h,Mt(this,e.j),this.s=e.s,this.g=e.g,Ft(this,e.m),this.l=e.l,t=e.i,(n=new $t).i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Lt(this,n),this.o=e.o):e&&(n=String(e).match(Nt))?(this.h=!!t,Mt(this,n[1]||"",!0),this.s=Vt(n[2]||""),this.g=Vt(n[3]||"",!0),Ft(this,n[4]),this.l=Vt(n[5]||"",!0),Lt(this,n[6]||"",!0),this.o=Vt(n[7]||"")):(this.h=!!t,this.i=new $t(null,this.h))}function Rt(e){return new kt(e)}function Mt(e,t,n){e.j=n?Vt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Ft(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Lt(e,t,n){var r,i;t instanceof $t?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(Qt(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Ht(this,t),Xt(this,n,e))},r)),r.j=i):(n||(t=qt(t,Gt)),e.i=new $t(t,e.h))}function Ot(e,t,n){e.i.set(t,n)}function Pt(e){return Ot(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Vt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function qt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Bt),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function Bt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}kt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(qt(t,Ut,!0),":");var n=this.g;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(qt(t,Ut,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(qt(n,"/"==n.charAt(0)?Kt:jt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",qt(n,zt)),e.join("")};var Ut=/[#\/\?@]/g,jt=/[#\?:]/g,Kt=/[#\?]/g,Gt=/[#\?@]/g,zt=/#/g;function $t(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Qt(n){n.g||(n.g=new Map,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,i=e[n].indexOf("="),s=null;0<=i?(r=e[n].substring(0,i),s=e[n].substring(i+1)):r=e[n],t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Ht(e,t){Qt(e),t=Yt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Wt(e,t){return Qt(e),t=Yt(e,t),e.g.has(t)}function Xt(e,t,n){Ht(e,t),0<n.length&&(e.i=null,e.g.set(Yt(e,t),P(n)),e.h+=n.length)}function Yt(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(I=$t.prototype).add=function(e,t){Qt(this),this.i=null,e=Yt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},I.forEach=function(n,r){Qt(this),this.g.forEach(function(e,t){e.forEach(function(e){n.call(r,e,t,this)},this)},this)},I.sa=function(){Qt(this);const t=Array.from(this.g.values()),n=Array.from(this.g.keys()),r=[];for(let s=0;s<n.length;s++){var i=t[s];for(let e=0;e<i.length;e++)r.push(n[s])}return r},I.Z=function(t){Qt(this);let n=[];if("string"==typeof t)Wt(this,t)&&(n=n.concat(this.g.get(Yt(this,t))));else{t=Array.from(this.g.values());for(let e=0;e<t.length;e++)n=n.concat(t[e])}return n},I.set=function(e,t){return Qt(this),this.i=null,Wt(this,e=Yt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},I.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},I.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),s=this.Z(r),r=0;r<s.length;r++){var a=i;""!==s[r]&&(a+="="+encodeURIComponent(String(s[r]))),e.push(a)}return this.i=e.join("&")};var Jt=class{constructor(e,t){this.h=e,this.g=t}};function Zt(e){this.l=e||10,e=_.PerformanceNavigationTiming?0<(e=_.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(_.g&&_.g.Ka&&_.g.Ka()&&_.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var en;function tn(e){return e.h||e.g&&e.g.size>=e.j}function nn(e){return e.h?1:e.g?e.g.size:0}function rn(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function sn(e,t){e.g?e.g.add(t):e.h=t}function an(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function on(t){if(null!=t.h)return t.i.concat(t.h.F);if(null==t.g||0===t.g.size)return P(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}}function un(){}function cn(){this.g=new un}function hn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function ln(e){this.l=e.fc||null,this.j=e.ob||!1}function dn(e,t){Ce.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=fn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Zt.prototype.cancel=function(){if(this.i=on(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},un.prototype.stringify=function(e){return _.JSON.stringify(e,void 0)},un.prototype.parse=function(e){return _.JSON.parse(e,void 0)},F(ln,ot),ln.prototype.g=function(){return new dn(this.l,this.j)},ln.prototype.i=(en={},function(){return en}),F(dn,Ce);var fn=0;function gn(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function mn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,pn(e)}function pn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(I=dn.prototype).open=function(e,t){if(this.readyState!=fn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,pn(this)},I.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||_).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},I.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,mn(this)),this.readyState=fn},I.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,pn(this)),this.g&&(this.readyState=3,pn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==_.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;gn(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},I.Xa=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?mn:pn)(this),3==this.readyState&&gn(this))},I.Za=function(e){this.g&&(this.response=this.responseText=e,mn(this))},I.Ya=function(e){this.g&&(this.response=e,mn(this))},I.ka=function(){this.g&&mn(this)},I.setRequestHeader=function(e,t){this.v.append(e,t)},I.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},I.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(dn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var yn=_.JSON.parse;function vn(e){Ce.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=wn,this.L=this.M=!1}F(vn,Ce);var wn="",bn=/^https?$/i,In=["POST","PUT"];function En(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Tn(e),Sn(e)}function Tn(e){e.F||(e.F=!0,Ne(e,"complete"),Ne(e,"error"))}function _n(e){if(e.h&&void 0!==T&&(!e.C[1]||4!=Dn(e)||2!=e.da()))if(e.v&&4==Dn(e))je(e.La,0,e);else if(Ne(e,"readystatechange"),4==Dn(e)){e.h=!1;try{var t,n,r,i,s=e.da();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break e;default:a=!1}if((t=a)||((n=0===s)&&(!(i=String(e.I).match(Nt)[1]||null)&&_.self&&_.self.location&&(i=(r=_.self.location.protocol).substr(0,r.length-1)),n=!bn.test(i?i.toLowerCase():"")),t=n),t)Ne(e,"complete"),Ne(e,"success");else{e.m=6;try{var o=2<Dn(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.da()+"]",Tn(e)}}finally{Sn(e)}}}function Sn(e,t){if(e.g){xn(e);const n=e.g,r=e.C[0]?S:null;e.g=null,e.C=null,t||Ne(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function xn(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(_.clearTimeout(e.A),e.A=null)}function Dn(e){return e.g?e.g.readyState:0}function An(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case wn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Cn(e){let n="";return de(e,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}function Nn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Cn(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Ot(e,t,n))}function kn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Rn(e){this.Ga=0,this.i=[],this.j=new He,this.oa=this.wa=this.G=this.Y=this.g=this.Da=this.F=this.ma=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=kn("failFast",!1,e),this.M=this.v=this.u=this.m=this.l=null,this.aa=!0,this.ta=this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=kn("baseRetryDelayMs",5e3,e),this.hb=kn("retryDelaySeedMs",1e4,e),this.eb=kn("forwardChannelMaxRetries",2,e),this.xa=kn("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.K=void 0,this.I=e&&e.supportsCrossDomainXhr||!1,this.J="",this.h=new Zt(e&&e.concurrentRequestLimit),this.Ja=new cn,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.j.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.na=void 0,this.S=0,this.L=!1,this.pa=this.B=null}function Mn(e){var t,n;Ln(e),3==e.H&&(t=e.W++,Ot(n=Rt(e.G),"SID",e.J),Ot(n,"RID",t),Ot(n,"TYPE","terminate"),Vn(e,n),(t=new ft(e,e.j,t,void 0)).L=2,t.v=Pt(Rt(n)),n=!1,!(n=_.navigator&&_.navigator.sendBeacon?_.navigator.sendBeacon(t.v.toString(),""):n)&&_.Image&&((new Image).src=t.v,n=!0),n||(t.g=Xn(t.l,null),t.g.ha(t.v)),t.G=Date.now(),Tt(t)),Hn(e)}function Fn(e){e.g&&(jn(e),e.g.cancel(),e.g=null)}function Ln(e){Fn(e),e.u&&(_.clearTimeout(e.u),e.u=null),Gn(e),e.h.cancel(),e.m&&("number"==typeof e.m&&_.clearTimeout(e.m),e.m=null)}function On(e){tn(e.h)||e.m||(e.m=!0,Oe(e.Na,e),e.C=0)}function Pn(e,t){var n=t?t.m:e.W++,r=Rt(e.G);Ot(r,"SID",e.J),Ot(r,"RID",n),Ot(r,"AID",e.V),Vn(e,r),e.o&&e.s&&Nn(r,e.o,e.s),n=new ft(e,e.j,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.i=t.F.concat(e.i)),t=qn(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),sn(e.h,n),wt(n,r,t)}function Vn(e,n){e.ma&&de(e.ma,function(e,t){Ot(n,t,e)}),e.l&&Ct({},function(e,t){Ot(n,t,e)})}function qn(e,t,r){r=Math.min(e.i.length,r);var i=e.l?R(e.l.Va,e.l,e):null;e:{var s=e.i;let n=-1;for(;;){const u=["count="+r];-1==n?0<r?(n=s[0].h,u.push("ofs="+n)):n=0:u.push("ofs="+n);let e=!0;for(let t=0;t<r;t++){var a=s[t].h,o=s[t].g;if((a-=n)<0)n=Math.max(0,s[t].h-100),e=!1;else try{!function(e,r,t){const i=t||"";try{Ct(e,function(e,t){let n=e;D(e)&&(n=Re(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(o,u,"req"+a+"_")}catch(e){i&&i(o)}}if(e){i=u.join("&");break e}}}return e=e.i.splice(0,r),t.F=e,i}function Bn(e){e.g||e.u||(e.ba=1,Oe(e.Ma,e),e.A=0)}function Un(e){return!(e.g||e.u||3<=e.A)&&(e.ba++,e.u=it(R(e.Ma,e),$n(e,e.A)),e.A++,1)}function jn(e){null!=e.B&&(_.clearTimeout(e.B),e.B=null)}function Kn(e){e.g=new ft(e,e.j,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=Rt(e.wa);Ot(t,"RID","rpc"),Ot(t,"SID",e.J),Ot(t,"CI",e.M?"0":"1"),Ot(t,"AID",e.V),Ot(t,"TYPE","xmlhttp"),Vn(e,t),e.o&&e.s&&Nn(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.oa,n.L=1,n.v=Pt(Rt(t)),n.s=null,n.S=!0,bt(n,e)}function Gn(e){null!=e.v&&(_.clearTimeout(e.v),e.v=null)}function zn(e,t){var n,r,i,s=null;if(e.g==t){Gn(e),jn(e),e.g=null;var a=2}else{if(!rn(e.h,t))return;s=t.F,an(e.h,t),a=1}if(0!=e.H)if(e.ta=t.aa,t.i)1==a?(s=t.s?t.s.length:0,t=Date.now()-t.G,n=e.C,Ne(a=Je(),new rt(a,s)),On(e)):Bn(e);else if(3==(n=t.o)||0==n&&0<e.ta||(1!=a||(i=t,nn((r=e).h)>=r.h.j-(r.m?1:0)||(r.m?(r.i=i.F.concat(r.i),0):1==r.H||2==r.H||r.C>=(r.cb?0:r.eb)||(r.m=it(R(r.Na,r,i),$n(r,r.C)),r.C++,0))))&&(2!=a||!Un(e)))switch(s&&0<s.length&&(t=e.h,t.i=t.i.concat(s)),n){case 1:Qn(e,5);break;case 4:Qn(e,10);break;case 3:Qn(e,6);break;default:Qn(e,2)}}function $n(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.l||(n*=2),n*t}function Qn(e,t){var n,r;e.j.info("Error code "+t),2==t?(n=null,e.l&&(n=null),r=R(e.pb,e),n||(n=new kt("//www.google.com/images/cleardot.gif"),_.location&&"http"==_.location.protocol||Mt(n,"https"),Pt(n)),function(e,t){var n=new He;if(_.Image){const r=new Image;r.onload=M(hn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=M(hn,n,r,"TestLoadImage: error",!1,t),r.onabort=M(hn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=M(hn,n,r,"TestLoadImage: timeout",!1,t),_.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):nt(2),e.H=0,e.l&&e.l.za(t),Hn(e),Ln(e)}function Hn(e){var t;e.H=0,e.pa=[],e.l&&(0==(t=on(e.h)).length&&0==e.i.length||(V(e.pa,t),V(e.pa,e.i),e.h.i.length=0,P(e.i),e.i.length=0),e.l.ya())}function Wn(e,t,n){var r,i,s=n instanceof kt?Rt(n):new kt(n,void 0);return""!=s.g?(t&&(s.g=t+"."+s.g),Ft(s,s.m)):(s=(r=_.location).protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port,i=new kt(null,void 0),s&&Mt(i,s),t&&(i.g=t),r&&Ft(i,r),n&&(i.l=n),s=i),n=e.F,t=e.Da,n&&t&&Ot(s,n,t),Ot(s,"VER",e.qa),Vn(e,s),s}function Xn(e,t,n){if(t&&!e.I)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new vn(new ln({ob:!0})):new vn(e.va)).Oa(e.I),t}function Yn(){}function Jn(){if(X&&!(10<=Number(se)))throw Error("Environmental error: no available transport.")}function Zn(e,t){Ce.call(this),this.g=new Rn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!U(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!U(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new nr(this)}function er(e){ht.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function tr(){lt.call(this),this.status=1}function nr(e){this.g=e}function rr(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ir(e,t,n){n=n||0;var r=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1];var i=e.g[2],s=e.g[3],a=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+((a=t+(s^n&(i^s))+r[0]+3614090360&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(t=n+((a=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+r[9]+3951481745&4294967295;e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function sr(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(I=vn.prototype).Oa=function(e){this.M=e},I.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=(this.u||mt).g(),this.C=this.u?ut(this.u):ut(mt),this.g.onreadystatechange=R(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void En(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const u of r.keys())n.set(u,r.get(u))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=_.FormData&&e instanceof _.FormData,0<=O(In,t)&&!r&&!i&&n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[s,a]of n)this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{xn(this),0<this.B&&((this.L=(o=this.g,X&&Q(ie,9,function(){let e=0;var t=j(String(H)).split("."),n=j("9").split("."),r=Math.max(t.length,n.length);for(let a=0;0==e&&a<r;a++)for(var i=t[a]||"",s=n[a]||"";i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=i[0].length||0!=s[0].length)&&(e=K(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||K(0==i[2].length,0==s[2].length)||K(i[2],s[2]),i=i[3],s=s[3],0==e););return 0<=e})&&"number"==typeof o.timeout&&void 0!==o.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=R(this.ua,this)):this.A=je(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){En(this,e)}var o},I.ua=function(){void 0!==T&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ne(this,"timeout"),this.abort(8))},I.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Ne(this,"complete"),Ne(this,"abort"),Sn(this))},I.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Sn(this,!0)),vn.$.N.call(this)},I.La=function(){this.s||(this.G||this.v||this.l?_n(this):this.kb())},I.kb=function(){_n(this)},I.da=function(){try{return 2<Dn(this)?this.g.status:-1}catch(e){return-1}},I.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},I.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),yn(t)}},I.Ia=function(){return this.m},I.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(I=Rn.prototype).qa=8,I.H=1,I.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new ft(this,this.j,t,void 0);let e=this.s;if(this.U&&(e?(e=fe(e),me(e,this.U)):e=this.U),null!==this.o||this.O||(s.I=e,e=null),this.P)e:{for(var n=0,r=0;r<this.i.length;r++){var i=this.i[r];if("__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i=i.length:i=void 0,void 0===i)break;if(4096<(n+=i)){n=r;break e}if(4096===n||r===this.i.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=qn(this,s,n),Ot(r=Rt(this.G),"RID",t),Ot(r,"CVER",22),this.F&&Ot(r,"X-HTTP-Session-Id",this.F),Vn(this,r),e&&(this.O?n="headers="+encodeURIComponent(String(Cn(e)))+"&"+n:this.o&&Nn(r,this.o,e)),sn(this.h,s),this.bb&&Ot(r,"TYPE","init"),this.P?(Ot(r,"$req",n),Ot(r,"SID","null"),s.ba=!0,wt(s,r,null)):wt(s,r,n),this.H=2}}else 3==this.H&&(t?Pn(this,t):0==this.i.length||tn(this.h)||Pn(this))},I.Ma=function(){var e;this.u=null,Kn(this),this.ca&&!(this.L||null==this.g||this.S<=0)&&(e=2*this.S,this.j.info("BP detection timer enabled: "+e),this.B=it(R(this.jb,this),e))},I.jb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.M=!1,this.L=!0,nt(10),Fn(this),Kn(this))},I.ib=function(){null!=this.v&&(this.v=null,Fn(this),Un(this),nt(19))},I.pb=function(e){e?(this.j.info("Successfully pinged google.com"),nt(2)):(this.j.info("Failed to ping google.com"),nt(1))},(I=Yn.prototype).Ba=function(){},I.Aa=function(){},I.za=function(){},I.ya=function(){},I.Va=function(){},Jn.prototype.g=function(e,t){return new Zn(e,t)},F(Zn,Ce),Zn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.I=!0);var e=this.g,t=this.l,n=this.h||void 0;nt(0),e.Y=t,e.ma=n||{},e.M=e.aa,e.G=Wn(e,null,e.Y),On(e)},Zn.prototype.close=function(){Mn(this.g)},Zn.prototype.u=function(e){var t,n=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.v&&((t={}).__data__=Re(e),e=t),n.i.push(new Jt(n.fb++,e)),3==n.H&&On(n)},Zn.prototype.N=function(){this.g.l=null,delete this.j,Mn(this.g),delete this.g,Zn.$.N.call(this)},F(er,ht),F(tr,lt),F(nr,Yn),nr.prototype.Ba=function(){Ne(this.g,"a")},nr.prototype.Aa=function(e){Ne(this.g,new er(e))},nr.prototype.za=function(e){Ne(this.g,new tr)},nr.prototype.ya=function(){Ne(this.g,"b")},F(rr,function(){this.blockSize=-1}),rr.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},rr.prototype.j=function(e,t){for(var n=(t=void 0===t?e.length:t)-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)ir(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){ir(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){ir(this,r),i=0;break}}this.h=i,this.i+=t},rr.prototype.l=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;for(var n=8*this.i,t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;t<4;++t)for(var r=0;r<32;r+=8)e[n++]=this.g[t]>>>r&255;return e};var ar={};function or(e){return-128<=e&&e<128?Q(ar,e,function(e){return new sr([0|e],e<0?-1:0)}):new sr([0|e],e<0?-1:0)}function ur(e){if(isNaN(e)||!isFinite(e))return hr;if(e<0)return mr(ur(-e));for(var t=[],n=1,r=0;n<=e;r++)t[r]=e/n|0,n*=cr;return new sr(t,0)}var cr=4294967296,hr=or(0),lr=or(1),dr=or(16777216);function fr(e){if(0==e.h){for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return;return 1}}function gr(e){return-1==e.h}function mr(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new sr(n,~e.h).add(lr)}function pr(e,t){return e.add(mr(t))}function yr(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function vr(e,t){this.g=e,this.h=t}function wr(e,t){if(fr(t))throw Error("division by zero");if(fr(e))return new vr(hr,hr);if(gr(e))return t=wr(mr(e),t),new vr(mr(t.g),mr(t.h));if(gr(t))return t=wr(e,mr(t)),new vr(mr(t.g),t.h);if(30<e.g.length){if(gr(e)||gr(t))throw Error("slowDivide_ only works with positive integers.");for(var n=lr,r=t;r.X(e)<=0;)n=br(n),r=br(r);for(var i=Ir(n,1),s=Ir(r,1),r=Ir(r,2),n=Ir(n,2);!fr(r);){var a=s.add(r);a.X(e)<=0&&(i=i.add(n),s=a),r=Ir(r,1),n=Ir(n,1)}return t=pr(e,i.R(t)),new vr(i,t)}for(i=hr;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),a=(s=ur(n)).R(t);gr(a)||0<a.X(e);)a=(s=ur(n-=r)).R(t);fr(s)&&(s=lr),i=i.add(s),e=pr(e,a)}return new vr(i,e)}function br(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new sr(n,e.h)}function Ir(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new sr(i,e.h)}(I=sr.prototype).ea=function(){if(gr(this))return-mr(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:cr+r)*t,t*=cr}return e},I.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(fr(this))return"0";if(gr(this))return"-"+mr(this).toString(e);for(var t=ur(Math.pow(e,6)),n=this,r="";;){var i=wr(n,t).g,s=((0<(n=pr(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(fr(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},I.D=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},I.X=function(e){return gr(e=pr(this,e))?-1:fr(e)?0:1},I.abs=function(){return gr(this)?mr(this):this},I.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),a=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16),r=a>>>16;s&=65535,a&=65535,n[i]=a<<16|s}return new sr(n,-2147483648&n[n.length-1]?-1:0)},I.R=function(e){if(fr(this)||fr(e))return hr;if(gr(this))return gr(e)?mr(this).R(mr(e)):mr(mr(this).R(e));if(gr(e))return mr(this.R(mr(e)));if(this.X(dr)<0&&e.X(dr)<0)return ur(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,a=65535&this.D(r),o=e.D(i)>>>16,u=65535&e.D(i);n[2*r+2*i]+=a*u,yr(n,2*r+2*i),n[2*r+2*i+1]+=s*u,yr(n,2*r+2*i+1),n[2*r+2*i+1]+=a*o,yr(n,2*r+2*i+1),n[2*r+2*i+2]+=s*o,yr(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new sr(n,0)},I.gb=function(e){return wr(this,e).h},I.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new sr(n,this.h&e.h)},I.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new sr(n,this.h|e.h)},I.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new sr(n,this.h^e.h)},Jn.prototype.createWebChannel=Jn.prototype.g,Zn.prototype.send=Zn.prototype.u,Zn.prototype.open=Zn.prototype.m,st.NO_ERROR=0,st.TIMEOUT=8,st.HTTP_ERROR=6,at.COMPLETE="complete",(ct.EventType=E).OPEN="a",E.CLOSE="b",E.ERROR="c",E.MESSAGE="d",Ce.prototype.listen=Ce.prototype.O,vn.prototype.listenOnce=vn.prototype.P,vn.prototype.getLastError=vn.prototype.Sa,vn.prototype.getLastErrorCode=vn.prototype.Ia,vn.prototype.getStatus=vn.prototype.da,vn.prototype.getResponseJson=vn.prototype.Wa,vn.prototype.getResponseText=vn.prototype.ja,vn.prototype.send=vn.prototype.ha,vn.prototype.setWithCredentials=vn.prototype.Oa,rr.prototype.digest=rr.prototype.l,rr.prototype.update=rr.prototype.j,sr.prototype.multiply=sr.prototype.R,sr.prototype.modulo=sr.prototype.gb,sr.prototype.compare=sr.prototype.X,sr.prototype.toNumber=sr.prototype.ea,sr.prototype.getBits=sr.prototype.D,sr.fromNumber=ur,sr.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return mr(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=ur(Math.pow(n,8)),i=hr,s=0;s<t.length;s+=8)var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n),i=a<8?(a=ur(Math.pow(n,a)),i.R(a).add(ur(o))):(i=i.R(r)).add(ur(o));return i};var Er,Tr=Je,_r=st,Sr=at,xr=Xe,Dr=10,Ar=11,Cr=ln,Nr=ct,kr=vn,Rr=rr,Mr=sr;const Fr="@firebase/firestore";class Lr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Lr.UNAUTHENTICATED=new Lr(null),Lr.GOOGLE_CREDENTIALS=new Lr("google-credentials-uid"),Lr.FIRST_PARTY=new Lr("first-party-uid"),Lr.MOCK_USER=new Lr("mock-user");let Or="9.21.0";const Pr=new class{constructor(e){this.name=e,this._logLevel=v,this._logHandler=b,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in l))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?y[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,l.DEBUG,...e),this._logHandler(this,l.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,l.VERBOSE,...e),this._logHandler(this,l.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,l.INFO,...e),this._logHandler(this,l.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,l.WARN,...e),this._logHandler(this,l.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,l.ERROR,...e),this._logHandler(this,l.ERROR,...e)}}("@firebase/firestore");function Vr(){return Pr.logLevel}function qr(e,...t){var n;Pr.logLevel<=l.DEBUG&&(n=t.map(jr),Pr.debug(`Firestore (${Or}): ${e}`,...n))}function Br(e,...t){var n;Pr.logLevel<=l.ERROR&&(n=t.map(jr),Pr.error(`Firestore (${Or}): ${e}`,...n))}function Ur(e,...t){var n;Pr.logLevel<=l.WARN&&(n=t.map(jr),Pr.warn(`Firestore (${Or}): ${e}`,...n))}function jr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function Kr(e="Unexpected state"){var t=`FIRESTORE (${Or}) INTERNAL ASSERTION FAILED: `+e;throw Br(t),new Error(t)}function Gr(e){e||Kr()}const zr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class $r extends d{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Qr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Hr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Wr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Lr.UNAUTHENTICATED))}shutdown(){}}class Xr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Yr{constructor(e){this.t=e,this.currentUser=Lr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const i=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let s=new Qr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Qr,t.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},o=e=>{qr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(qr("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Qr))},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(qr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Gr("string"==typeof e.accessToken),new Hr(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return Gr(null===e||"string"==typeof e),new Lr(e)}}class Jr{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=Lr.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);var e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class Zr{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Jr(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(Lr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ei{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class ti{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(t,n){const r=e=>{null!=e.error&&qr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);var t=e.token!==this.T;return this.T=e.token,qr("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>r(e))};const i=e=>{qr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit(e=>i(e)),setTimeout(()=>{var e;this.appCheck||((e=this.I.getImmediate({optional:!0}))?i(e):qr("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Gr("string"==typeof e.token),this.T=e.token,new ei(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class ni{static A(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(t){const n="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(n&&"function"==typeof n.getRandomValues)n.getRandomValues(r);else for(let e=0;e<t;e++)r[e]=Math.floor(256*Math.random());return r}(40);for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function ri(e,t){return e<t?-1:t<e?1:0}function ii(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function si(e){return e+"\0"}class ai{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new $r(zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new $r(zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new $r(zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new $r(zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ai.fromMillis(Date.now())}static fromDate(e){return ai.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new ai(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ri(this.nanoseconds,e.nanoseconds):ri(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class oi{constructor(e){this.timestamp=e}static fromTimestamp(e){return new oi(e)}static min(){return new oi(new ai(0,0))}static max(){return new oi(new ai(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ui{constructor(e,t,n){void 0===t?t=0:t>e.length&&Kr(),void 0===n?n=e.length-t:n>e.length-t&&Kr(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ui.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ui?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ci extends ui{construct(e,t,n){return new ci(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new $r(zr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new ci(t)}static emptyPath(){return new ci([])}}const hi=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class li extends ui{construct(e,t,n){return new li(e,t,n)}static isValidIdentifier(e){return hi.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!li.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new li(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new $r(zr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new $r(zr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new $r(zr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new $r(zr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new li(t)}static emptyPath(){return new li([])}}class di{constructor(e){this.path=e}static fromPath(e){return new di(ci.fromString(e))}static fromName(e){return new di(ci.fromString(e).popFirst(5))}static empty(){return new di(ci.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ci.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ci.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new di(new ci(e.slice()))}}class fi{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function gi(e){return e.fields.find(e=>2===e.kind)}function mi(e){return e.fields.filter(e=>2!==e.kind)}fi.UNKNOWN_ID=-1;class pi{constructor(e,t){this.fieldPath=e,this.kind=t}}class yi{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new yi(0,bi.min())}}function vi(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,r=oi.fromTimestamp(1e9===r?new ai(n+1,0):new ai(n,r));return new bi(r,di.empty(),t)}function wi(e){return new bi(e.readTime,e.key,-1)}class bi{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new bi(oi.min(),di.empty(),-1)}static max(){return new bi(oi.max(),di.empty(),-1)}}function Ii(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=di.comparator(e.documentKey,t.documentKey),0!==n?n:ri(e.largestBatchId,t.largestBatchId))}const Ei="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ti{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function _i(e){if(e.code!==zr.FAILED_PRECONDITION||e.message!==Ei)throw e;qr("LocalStore","Unexpectedly lost primary lease")}class Si{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&Kr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new Si((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof Si?t:Si.resolve(t)}catch(e){return Si.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Si.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Si.reject(t)}static resolve(n){return new Si((e,t)=>{e(n)})}static reject(n){return new Si((e,t)=>{t(n)})}static waitFor(e){return new Si((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=Si.resolve(!1);for(const n of e)t=t.next(e=>e?Si.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}static mapArray(o,u){return new Si((t,n)=>{const r=o.length,i=new Array(r);let s=0;for(let e=0;e<r;e++){const a=e;u(o[a]).next(e=>{i[a]=e,++s,s===r&&t(i)},e=>n(e))}})}static doWhile(r,i){return new Si((e,t)=>{const n=()=>{!0===r()?i().next(()=>{n()},t):e()};n()})}}class xi{constructor(n,e){this.action=n,this.transaction=e,this.aborted=!1,this.R=new Qr,this.transaction.oncomplete=()=>{this.R.resolve()},this.transaction.onabort=()=>{e.error?this.R.reject(new Ci(n,e.error)):this.R.resolve()},this.transaction.onerror=e=>{var t=Fi(e.target.error);this.R.reject(new Ci(n,t))}}static open(e,t,n,r){try{return new xi(t,e.transaction(r,n))}catch(e){throw new Ci(t,e)}}get v(){return this.R.promise}abort(e){e&&this.R.reject(e),this.aborted||(qr("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){var t=this.transaction.objectStore(e);return new ki(t)}}class Di{constructor(e,t,n){this.name=e,this.version=t,this.V=n,12.2===Di.S(u())&&Br("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return qr("SimpleDb","Removing database:",e),Ri(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!function(){try{return"object"==typeof indexedDB}catch(e){return}}())return!1;if(Di.C())return!0;const e=u(),t=Di.S(e),n=0<t&&t<10,r=Di.N(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static C(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static N(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(s){return this.db||(qr("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=e=>{var t=e.target.result;n(t)},i.onblocked=()=>{r(new Ci(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=e=>{var t=e.target.error;"VersionError"===t.name?r(new $r(zr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===t.name?r(new $r(zr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+t)):r(new Ci(s,t))},i.onupgradeneeded=e=>{qr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.V.$(t,i.transaction,e.oldVersion,this.version).next(()=>{qr("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.F&&(this.db.onversionchange=e=>this.F(e)),this.db}B(t){this.F=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.O(e);const t=xi.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.P(),e)).catch(e=>(t.abort(e),Si.reject(e))).toPromise();return s.catch(()=>{}),await t.v,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(qr("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Ai{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return Ri(this.L.delete())}}class Ci extends $r{constructor(e,t){super(zr.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ni(e){return"IndexedDbTransactionError"===e.name}class ki{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(qr("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(qr("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),Ri(n)}add(e){return qr("SimpleDb","ADD",this.store.name,e,e),Ri(this.store.add(e))}get(t){return Ri(this.store.get(t)).next(e=>(qr("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return qr("SimpleDb","DELETE",this.store.name,e),Ri(this.store.delete(e))}count(){return qr("SimpleDb","COUNT",this.store.name),Ri(this.store.count())}j(e,n){var t=this.options(e,n);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.W(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new Si((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}H(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new Si((t,n)=>{r.onerror=e=>{n(e.target.error)},r.onsuccess=e=>{t(e.target.result)}})}J(e,t){qr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Y=!1;var r=this.cursor(n);return this.W(r,(e,t,n)=>n.delete())}X(e,t){let n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.W(r,t)}Z(i){const e=this.cursor({});return new Si((n,r)=>{e.onerror=e=>{var t=Fi(e.target.error);r(t)},e.onsuccess=e=>{const t=e.target.result;t?i(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}W(e,s){const a=[];return new Si((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new Ai(t),r=s(t.primaryKey,t.value,n);if(r instanceof Si){const e=r.catch(e=>(n.done(),Si.reject(e)));a.push(e)}n.isDone?i():null===n.K?t.continue():t.continue(n.K)}else i()}}).next(()=>Si.waitFor(a))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ri(e){return new Si((n,r)=>{e.onsuccess=e=>{var t=e.target.result;n(t)},e.onerror=e=>{var t=Fi(e.target.error);r(t)}})}let Mi=!1;function Fi(e){const t=Di.S(u());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new $r("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Mi||(Mi=!0,setTimeout(()=>{throw e},0)),e}}return e}class Li{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){qr("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{qr("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(e){Ni(e)?qr("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await _i(e)}await this.et(6e4)})}}class Oi{constructor(e,t){this.localStore=e,this.persistence=t}async nt(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.st(e,t))}st(e,t){const n=new Set;let r=t,i=!0;return Si.doWhile(()=>!0===i&&0<r,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>null===t||n.has(t)?void(i=!1):(qr("IndexBackiller",`Processing collection: ${t}`),this.it(e,t,r).next(e=>{r-=e,n.add(t)})))).next(()=>t-r)}it(r,i,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(r,i).next(n=>this.localStore.localDocuments.getNextDocuments(r,i,n,e).next(e=>{const t=e.changes;return this.localStore.indexManager.updateIndexEntries(r,t).next(()=>this.rt(n,e)).next(e=>(qr("IndexBackiller",`Updating offset: ${e}`),this.localStore.indexManager.updateCollectionGroup(r,i,e))).next(()=>t.size)}))}rt(e,t){let r=e;return t.changes.forEach((e,t)=>{var n=wi(t);0<Ii(n,r)&&(r=n)}),new bi(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Pi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.ut&&this.ut(e),e}}function Vi(e){return null==e}function qi(e){return 0===e&&1/e==-1/0}function Bi(e){return"number"==typeof e&&Number.isInteger(e)&&!qi(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function Ui(e){let t="";for(let n=0;n<e.length;n++)0<t.length&&(t=ji(t)),t=function(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const r=e.charAt(i);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(e.get(n),t);return ji(t)}function ji(e){return e+""}function Ki(t){const n=t.length;if(Gr(2<=n),2===n)return Gr(""===t.charAt(0)&&""===t.charAt(1)),ci.emptyPath();const __PRIVATE_lastReasonableEscapeIndex=n-2,r=[];let i="";for(let a=0;a<n;){const n=t.indexOf("",a);switch((n<0||n>__PRIVATE_lastReasonableEscapeIndex)&&Kr(),t.charAt(n+1)){case"":var s=t.substring(a,n);let e;0===i.length?e=s:(i+=s,e=i,i=""),r.push(e);break;case"":i+=t.substring(a,n),i+="\0";break;case"":i+=t.substring(a,n+1);break;default:Kr()}a=n+2}return new ci(r)}Pi.ct=-1;const Gi=["userId","batchId"];function zi(e,t){return[e,Ui(t)]}function $i(e,t,n){return[e,Ui(t),n]}const Qi={},Hi=["prefixPath","collectionGroup","readTime","documentId"],Wi=["prefixPath","collectionGroup","documentId"],Xi=["collectionGroup","readTime","prefixPath","documentId"],Yi=["canonicalId","targetId"],Ji=["targetId","path"],Zi=["path","targetId"],es=["collectionId","parent"],ts=["indexId","uid"],ns=["uid","sequenceNumber"],rs=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],is=["indexId","uid","orderedDocumentKey"],ss=["userId","collectionPath","documentId"],as=["userId","collectionPath","largestBatchId"],os=["userId","collectionGroup","largestBatchId"],us=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],cs=[...us,"documentOverlays"],hs=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ls=hs,ds=[...ls,"indexConfiguration","indexState","indexEntries"];class fs extends Ti{constructor(e,t){super(),this.at=e,this.currentSequenceNumber=t}}function gs(e,t){var n=e;return Di.M(n.at,t)}function ms(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ps(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ys(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class vs{constructor(e,t){this.comparator=e,this.root=t||bs.EMPTY}insert(e,t){return new vs(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,bs.BLACK,null,null))}remove(e){return new vs(this.comparator,this.root.remove(e,this.comparator).copy(null,null,bs.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ws(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ws(this.root,e,this.comparator,!1)}getReverseIterator(){return new ws(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ws(this.root,e,this.comparator,!0)}}class ws{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class bs{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:bs.RED,this.left=null!=r?r:bs.EMPTY,this.right=null!=i?i:bs.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new bs(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return bs.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return bs.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,bs.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,bs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Kr();if(this.right.isRed())throw Kr();var e=this.left.check();if(e!==this.right.check())throw Kr();return e+(this.isRed()?0:1)}}bs.EMPTY=null,bs.RED=!0,bs.BLACK=!1,bs.EMPTY=new class{constructor(){this.size=0}get key(){throw Kr()}get value(){throw Kr()}get color(){throw Kr()}get left(){throw Kr()}get right(){throw Kr()}copy(e,t,n,r,i){return this}insert(e,t,n){return new bs(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Is{constructor(e){this.comparator=e,this.data=new vs(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Es(this.data.getIterator())}getIteratorFrom(e){return new Es(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Is))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new Is(this.comparator);return t.data=e,t}}class Es{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ts(e){return e.hasNext()?e.getNext():void 0}class _s{constructor(e){(this.fields=e).sort(li.comparator)}static empty(){return new _s([])}unionWith(e){let t=new Is(li.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new _s(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ii(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Ss extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class xs{constructor(e){this.binaryString=e}static fromBase64String(e){var t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Ss("Invalid base64 string: "+e):e}}(e);return new xs(t)}static fromUint8Array(e){var t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new xs(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ri(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}xs.EMPTY_BYTE_STRING=new xs("");const Ds=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function As(t){if(Gr(!!t),"string"!=typeof t)return{seconds:Cs(t.seconds),nanos:Cs(t.nanos)};{let e=0;var n=Ds.exec(t);Gr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function Cs(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ns(e){return"string"==typeof e?xs.fromBase64String(e):xs.fromUint8Array(e)}function ks(e){var t;return"server_timestamp"===(null===(t=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Rs(e){var t=e.mapValue.fields.__previous_value__;return ks(t)?Rs(t):t}function Ms(e){var t=As(e.mapValue.fields.__local_write_time__.timestampValue);return new ai(t.seconds,t.nanos)}class Fs{constructor(e,t,n,r,i,s,a,o){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class Ls{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Ls("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Ls&&e.projectId===this.projectId&&e.database===this.database}}const Os={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ps={nullValue:"NULL_VALUE"};function Vs(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ks(e)?4:Ys(e)?9007199254740991:10:Kr()}function qs(r,i){if(r===i)return!0;var e,t,n=Vs(r);if(n!==Vs(i))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return Ms(r).isEqual(Ms(i));case 3:return function(e){if("string"==typeof r.timestampValue&&"string"==typeof e.timestampValue&&r.timestampValue.length===e.timestampValue.length)return r.timestampValue===e.timestampValue;var t=As(r.timestampValue),n=As(e.timestampValue);return t.seconds===n.seconds&&t.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,Ns(r.bytesValue).isEqual(Ns(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,Cs((t=r).geoPointValue.latitude)===Cs(e.geoPointValue.latitude)&&Cs(t.geoPointValue.longitude)===Cs(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Cs(e.integerValue)===Cs(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=Cs(e.doubleValue),r=Cs(t.doubleValue);return n===r?qi(n)===qi(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return ii(r.arrayValue.values||[],i.arrayValue.values||[],qs);case 10:return function(e){const t=e.mapValue.fields||{},n=i.mapValue.fields||{};if(ms(t)!==ms(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!qs(t[e],n[e])))return!1;return!0}(r);default:return Kr()}}function Bs(e,t){return void 0!==(e.values||[]).find(e=>qs(e,t))}function Us(e,t){if(e===t)return 0;var n,r,i,s,a=Vs(e),o=Vs(t);if(a!==o)return ri(a,o);switch(a){case 0:case 9007199254740991:return 0;case 1:return ri(e.booleanValue,t.booleanValue);case 2:return r=t,i=Cs(e.integerValue||e.doubleValue),s=Cs(r.integerValue||r.doubleValue),i<s?-1:s<i?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return js(e.timestampValue,t.timestampValue);case 4:return js(Ms(e),Ms(t));case 5:return ri(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ns(e),r=Ns(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const t=ri(n[i],r[i]);if(0!==t)return t}return ri(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0!==(s=ri(Cs(n.latitude),Cs(r.latitude)))?s:ri(Cs(n.longitude),Cs(r.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const t=Us(n[i],r[i]);if(t)return t}return ri(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Os.mapValue&&t===Os.mapValue)return 0;if(e===Os.mapValue)return 1;if(t===Os.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const t=ri(r[o],s[o]);if(0!==t)return t;var a=Us(n[r[o]],i[s[o]]);if(0!==a)return a}return ri(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Kr()}}function js(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ri(e,t);var n=As(e),r=As(t),i=ri(n.seconds,r.seconds);return 0!==i?i:ri(n.nanos,r.nanos)}function Ks(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=As(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ns(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,di.fromName(t).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=s(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${s(e.fields[i])}`;return n+"}"}(e.mapValue):Kr();var t}(e)}function Gs(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function zs(e){return e&&"integerValue"in e}function $s(e){return!!e&&"arrayValue"in e}function Qs(e){return e&&"nullValue"in e}function Hs(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ws(e){return e&&"mapValue"in e}function Xs(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return ps(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=Xs(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=Xs(t.arrayValue.values[e]);return r}return Object.assign({},t)}function Ys(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Js(e,t){var n=Us(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Zs(e,t){var n=Us(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class ea{constructor(e){this.value=e}static empty(){return new ea({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let e=this.value;for(let t=0;t<n.length-1;++t)if(e=(e.mapValue.fields||{})[n.get(t)],!Ws(e))return null;return e=(e.mapValue.fields||{})[n.lastSegment()],e||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Xs(t)}setAll(e){let n=li.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=Xs(e):i.push(t.lastSegment())});var t=this.getFieldsMap(n);this.applyChanges(t,r,i)}delete(e){const t=this.field(e.popLast());Ws(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qs(this.value,e.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let e=n.mapValue.fields[t.get(r)];Ws(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=e),n=e}return n.mapValue.fields}applyChanges(n,e,t){ps(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new ea(Xs(this.value))}}class ta{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new ta(e,0,oi.min(),oi.min(),oi.min(),ea.empty(),0)}static newFoundDocument(e,t,n,r){return new ta(e,1,t,oi.min(),n,r,0)}static newNoDocument(e,t){return new ta(e,2,t,oi.min(),oi.min(),ea.empty(),0)}static newUnknownDocument(e,t){return new ta(e,3,t,oi.min(),oi.min(),ea.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(oi.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ea.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ea.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=oi.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ta&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ta(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class na{constructor(e,t){this.position=e,this.inclusive=t}}function ra(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],a=e.position[i];if(r=s.field.isKeyField()?di.comparator(di.fromName(a.referenceValue),n.key):Us(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ia(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!qs(e.position[n],t.position[n]))return!1;return!0}class sa{constructor(e,t="asc"){this.field=e,this.dir=t}}class aa{}class oa extends aa{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ma(e,t,n):"array-contains"===t?new wa(e,n):"in"===t?new ba(e,n):"not-in"===t?new Ia(e,n):"array-contains-any"===t?new Ea(e,n):new oa(e,t,n)}static createKeyFieldInFilter(e,t,n){return new("in"===t?pa:ya)(e,n)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Us(t,this.value)):null!==t&&Vs(this.value)===Vs(t)&&this.matchesComparison(Us(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return Kr()}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ua extends aa{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new ua(e,t)}matches(t){return ca(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){var e=this.lt(e=>e.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function ca(e){return"and"===e.op}function ha(e){return"or"===e.op}function la(e){return da(e)&&ca(e)}function da(e){for(const t of e.filters)if(t instanceof ua)return!1;return!0}function fa(e,t){var n=e.filters.concat(t);return ua.create(n,e.op)}function ga(e){return e instanceof oa?`${(t=e).field.canonicalString()} ${t.op} ${Ks(t.value)}`:e instanceof ua?(e=e).op.toString()+" {"+e.getFilters().map(ga).join(" ,")+"}":"Filter";var t}class ma extends oa{constructor(e,t,n){super(e,t,n),this.key=di.fromName(n.referenceValue)}matches(e){var t=di.comparator(e.key,this.key);return this.matchesComparison(t)}}class pa extends oa{constructor(e,t){super(e,"in",t),this.keys=va(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class ya extends oa{constructor(e,t){super(e,"not-in",t),this.keys=va(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function va(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>di.fromName(e.referenceValue))}class wa extends oa{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return $s(t)&&Bs(t.arrayValue,this.value)}}class ba extends oa{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&Bs(this.value.arrayValue,t)}}class Ia extends oa{constructor(e,t){super(e,"not-in",t)}matches(e){if(Bs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Bs(this.value.arrayValue,t)}}class Ea extends oa{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!$s(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Bs(this.value.arrayValue,e))}}class Ta{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ft=null}}function _a(e,t=null,n=[],r=[],i=null,s=null,a=null){return new Ta(e,t,n,r,i,s,a)}function Sa(e){const t=e;if(null===t.ft){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function t(e){if(e instanceof oa)return e.field.canonicalString()+e.op.toString()+Ks(e.value);if(la(e))return e.filters.map(e=>t(e)).join(",");var n=e.filters.map(e=>t(e)).join(",");return`${e.op}(${n})`}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Vi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Ks(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Ks(e)).join(",")),t.ft=e}return t.ft}function xa(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(n=e.orderBy[i],r=t.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;var n,r;if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(!function r(e,t){return e instanceof oa?(n=e,(s=t)instanceof oa&&n.op===s.op&&n.field.isEqual(s.field)&&qs(n.value,s.value)):e instanceof ua?(i=t)instanceof ua&&e.op===i.op&&e.filters.length===i.filters.length&&e.filters.reduce((e,t,n)=>e&&r(t,i.filters[n]),!0):void Kr();var i,n,s}(e.filters[s],t.filters[s]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ia(e.startAt,t.startAt)&&ia(e.endAt,t.endAt)}function Da(e){return di.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Aa(e,t){return e.filters.filter(e=>e instanceof oa&&e.field.isEqual(t))}function Ca(t,n,r){let i=Ps,s=!0;for(const r of Aa(t,n)){let e=Ps,t=!0;switch(r.op){case"<":case"<=":e="nullValue"in(a=r.value)?Ps:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?Gs(Ls.empty(),di.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?{mapValue:{}}:Kr();break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=Ps}Js({value:i,inclusive:s},{value:e,inclusive:t})<0&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];Js({value:i,inclusive:s},{value:t,inclusive:r.inclusive})<0&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}function Na(t,n,r){let i=Os,s=!0;for(const r of Aa(t,n)){let e=Os,t=!0;switch(r.op){case">=":case">":e="nullValue"in(a=r.value)?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?Gs(Ls.empty(),di.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?{mapValue:{}}:"mapValue"in a?Os:Kr(),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=Os}0<Zs({value:i,inclusive:s},{value:e,inclusive:t})&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];0<Zs({value:i,inclusive:s},{value:t,inclusive:r.inclusive})&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}class ka{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.dt=null,this._t=null,this.startAt,this.endAt}}function Ra(e,t,n,r,i,s,a,o){return new ka(e,t,n,r,i,s,a,o)}function Ma(e){return new ka(e)}function Fa(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function La(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function Oa(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function Pa(e){return null!==e.collectionGroup}function Va(t){const n=t;if(null===n.dt){n.dt=[];const t=Oa(n),e=La(n);if(null!==t&&null===e)t.isKeyField()||n.dt.push(new sa(t)),n.dt.push(new sa(li.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.dt.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.dt.push(new sa(li.keyField(),t))}}}return n.dt}function qa(e){const t=e;if(!t._t)if("F"===t.limitType)t._t=_a(t.path,t.collectionGroup,Va(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of Va(t)){const t="desc"===i.dir?"asc":"desc";e.push(new sa(i.field,t))}var n=t.endAt?new na(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new na(t.startAt.position,t.startAt.inclusive):null;t._t=_a(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function Ba(e,t){t.getFirstInequalityField(),Oa(e);var n=e.filters.concat([t]);return new ka(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Ua(e,t,n){return new ka(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ja(e,t){return xa(qa(e),qa(t))&&e.limitType===t.limitType}function Ka(e){return`${Sa(qa(e))}|lt:${e.limitType}`}function Ga(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>ga(e)).join(", ")}]`),Vi(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Ks(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Ks(e)).join(",")),`Target(${t})`}(qa(e))}; limitType=${e.limitType})`}function za(n,e){return e.isFoundDocument()&&(i=n,a=(s=e).key.path,null!==i.collectionGroup?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(a):di.isDocumentKey(i.path)?i.path.isEqual(a):i.path.isImmediateParentOf(a))&&function(e){for(const t of Va(n))if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(i=e,(!(e=n).startAt||(t=e.startAt,r=ra(t,Va(e),i),t.inclusive?r<=0:r<0))&&(!e.endAt||(t=e.endAt,r=ra(t,Va(e),i),t.inclusive?0<=r:0<r)));var t,r,i,s,a}function $a(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Qa(i){return(e,t)=>{let n=!1;for(const r of Va(i)){const i=function(e,i,t){var n=e.field.isKeyField()?di.comparator(i.key,t.key):function(e,t){var n=i.data.field(e),r=t.data.field(e);return null!==n&&null!==r?Us(n,r):Kr()}(e.field,t);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return Kr()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}class Ha{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(r){ps(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return ys(this.inner)}size(){return this.innerSize}}const Wa=new vs(di.comparator);const Xa=new vs(di.comparator);function Ya(...e){let t=Xa;for(const n of e)t=t.insert(n.key,n);return t}function Ja(e){let n=Xa;return e.forEach((e,t)=>n=n.insert(e,t.overlayedDocument)),n}function Za(){return new Ha(e=>e.toString(),(e,t)=>e.isEqual(t))}const eo=new vs(di.comparator),to=new Is(di.comparator);function no(...e){let t=to;for(const n of e)t=t.add(n);return t}const ro=new Is(ri);function io(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qi(t)?"-0":t}}function so(e){return{integerValue:""+e}}function ao(e,t){return Bi(t)?so(t):io(e,t)}class oo{constructor(){this._=void 0}}function uo(e,t){return e instanceof mo?zs(n=t)||n&&"doubleValue"in n?t:{integerValue:0}:null;var n}class co extends oo{}class ho extends oo{constructor(e){super(),this.elements=e}}function lo(e,t){const n=yo(t);for(const t of e.elements)n.some(e=>qs(e,t))||n.push(t);return{arrayValue:{values:n}}}class fo extends oo{constructor(e){super(),this.elements=e}}function go(e,t){let n=yo(t);for(const t of e.elements)n=n.filter(e=>!qs(e,t));return{arrayValue:{values:n}}}class mo extends oo{constructor(e,t){super(),this.serializer=e,this.wt=t}}function po(e){return Cs(e.integerValue||e.doubleValue)}function yo(e){return $s(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class vo{constructor(e,t){this.field=e,this.transform=t}}class wo{constructor(e,t){this.version=e,this.transformResults=t}}class bo{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new bo}static exists(e){return new bo(void 0,e)}static updateTime(e){return new bo(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Io(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Eo{}function To(e,n){if(!e.hasLocalMutations||n&&0===n.fields.length)return null;if(null===n)return e.isNoDocument()?new Ro(e.key,bo.none()):new Do(e.key,e.data,bo.none());{const i=e.data,s=ea.empty();let t=new Is(li.comparator);for(var r of n.fields)if(!t.has(r)){let e=i.field(r);null===e&&1<r.length&&(r=r.popLast(),e=i.field(r)),null===e?s.delete(r):s.set(r,e),t=t.add(r)}return new Ao(e.key,s,new _s(t.toArray()),bo.none())}}function _o(e,t,n){e instanceof Do?function(e,t,n){const r=e.value.clone(),i=No(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Ao?function(e,t,n){if(!Io(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=No(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Co(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function So(e,t,n,r){return e instanceof Do?function(e,t,n,r){if(!Io(e.precondition,t))return n;const i=e.value.clone(),s=ko(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Ao?function(e,t,n,r){if(!Io(e.precondition,t))return n;const i=ko(e.fieldTransforms,r,t),s=t.data;return s.setAll(Co(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):(t=t,n=n,Io(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n)}function xo(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&ii(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof ho&&t instanceof ho||e instanceof fo&&t instanceof fo?ii(e.elements,t.elements,qs):e instanceof mo&&t instanceof mo?qs(e.wt,t.wt):e instanceof co&&t instanceof co)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class Do extends Eo{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ao extends Eo{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Co(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function No(e,t,n){const r=new Map;Gr(e.length===n.length);for(let h=0;h<n.length;h++){var i=e[h],s=i.transform,a=t.data.field(i.field);r.set(i.field,(o=s,u=a,c=n[h],o instanceof ho?lo(o,u):o instanceof fo?go(o,u):c))}var o,u,c;return r}function ko(e,t,n){const r=new Map;for(const c of e){const e=c.transform,h=n.data.field(c.field);r.set(c.field,(i=e,s=h,a=t,u=o=void 0,i instanceof co?function(e){const t={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return(e=e&&ks(e)?Rs(e):e)&&(t.fields.__previous_value__=e),{mapValue:t}}(s):i instanceof ho?lo(i,s):i instanceof fo?go(i,s):(o=uo(i=i,s),u=po(o)+po(i.wt),zs(o)&&zs(i.wt)?so(u):io(i.serializer,u))))}var i,s,a,o,u;return r}class Ro extends Eo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Mo extends Eo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Fo{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){var n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&_o(i,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=So(n,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=So(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(s,a){const o=Za();return this.mutations.forEach(e=>{const t=s.get(e.key),n=t.overlayedDocument;let r=this.applyToLocalView(n,t.mutatedFields);r=a.has(e.key)?null:r;var i=To(n,r);null!==i&&o.set(e.key,i),n.isValidDocument()||n.convertToNoDocument(oi.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),no())}isEqual(e){return this.batchId===e.batchId&&ii(this.mutations,e.mutations,(e,t)=>xo(e,t))&&ii(this.baseMutations,e.baseMutations,(e,t)=>xo(e,t))}}class Lo{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Gr(e.mutations.length===n.length);let r=eo;var i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new Lo(e,t,n,r)}}class Oo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Po{constructor(e,t){this.count=e,this.unchangedNames=t}}function Vo(e){switch(e){default:return Kr(),0;case zr.CANCELLED:case zr.UNKNOWN:case zr.DEADLINE_EXCEEDED:case zr.RESOURCE_EXHAUSTED:case zr.INTERNAL:case zr.UNAVAILABLE:case zr.UNAUTHENTICATED:return;case zr.INVALID_ARGUMENT:case zr.NOT_FOUND:case zr.ALREADY_EXISTS:case zr.PERMISSION_DENIED:case zr.FAILED_PRECONDITION:case zr.ABORTED:case zr.OUT_OF_RANGE:case zr.UNIMPLEMENTED:case zr.DATA_LOSS:return 1}}function qo(e){if(void 0===e)return Br("GRPC error has no .code"),zr.UNKNOWN;switch(e){case Er.OK:return zr.OK;case Er.CANCELLED:return zr.CANCELLED;case Er.UNKNOWN:return zr.UNKNOWN;case Er.DEADLINE_EXCEEDED:return zr.DEADLINE_EXCEEDED;case Er.RESOURCE_EXHAUSTED:return zr.RESOURCE_EXHAUSTED;case Er.INTERNAL:return zr.INTERNAL;case Er.UNAVAILABLE:return zr.UNAVAILABLE;case Er.UNAUTHENTICATED:return zr.UNAUTHENTICATED;case Er.INVALID_ARGUMENT:return zr.INVALID_ARGUMENT;case Er.NOT_FOUND:return zr.NOT_FOUND;case Er.ALREADY_EXISTS:return zr.ALREADY_EXISTS;case Er.PERMISSION_DENIED:return zr.PERMISSION_DENIED;case Er.FAILED_PRECONDITION:return zr.FAILED_PRECONDITION;case Er.ABORTED:return zr.ABORTED;case Er.OUT_OF_RANGE:return zr.OUT_OF_RANGE;case Er.UNIMPLEMENTED:return zr.UNIMPLEMENTED;case Er.DATA_LOSS:return zr.DATA_LOSS;default:return Kr()}}(at=Er=Er||{})[at.OK=0]="OK",at[at.CANCELLED=1]="CANCELLED",at[at.UNKNOWN=2]="UNKNOWN",at[at.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",at[at.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",at[at.NOT_FOUND=5]="NOT_FOUND",at[at.ALREADY_EXISTS=6]="ALREADY_EXISTS",at[at.PERMISSION_DENIED=7]="PERMISSION_DENIED",at[at.UNAUTHENTICATED=16]="UNAUTHENTICATED",at[at.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",at[at.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",at[at.ABORTED=10]="ABORTED",at[at.OUT_OF_RANGE=11]="OUT_OF_RANGE",at[at.UNIMPLEMENTED=12]="UNIMPLEMENTED",at[at.INTERNAL=13]="INTERNAL",at[at.UNAVAILABLE=14]="UNAVAILABLE",at[at.DATA_LOSS=15]="DATA_LOSS";class Bo{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Uo}static getOrCreateInstance(){return null===Uo&&(Uo=new Bo),Uo}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(t){this.onExistenceFilterMismatchCallbacks.forEach(e=>e(t))}}let Uo=null;function jo(){return new TextEncoder}const Ko=new Mr([4294967295,4294967295],0);function Go(e){const t=jo().encode(e),n=new Rr;return n.update(t),new Uint8Array(n.digest())}function zo(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Mr([n,r],0),new Mr([i,s],0)]}class $o{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||8<=t)throw new Qo(`Invalid padding: ${t}`);if(n<0)throw new Qo(`Invalid hash count: ${n}`);if(0<e.length&&0===this.hashCount)throw new Qo(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Qo(`Invalid padding when bitmap length is 0: ${t}`);this.yt=8*e.length-t,this.It=Mr.fromNumber(this.yt)}Tt(e,t,n){let r=e.add(t.multiply(Mr.fromNumber(n)));return 1===r.compare(Ko)&&(r=new Mr([r.getBits(0),r.getBits(1)],0)),r.modulo(this.It).toNumber()}Et(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}At(e){if(0===this.yt)return!1;const t=Go(e),[n,r]=zo(t);for(let i=0;i<this.hashCount;i++){const t=this.Tt(n,r,i);if(!this.Et(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new $o(i,r,t);return n.forEach(e=>s.insert(e)),s}insert(t){if(0!==this.yt){const n=Go(t),[r,i]=zo(n);for(let e=0;e<this.hashCount;e++){const n=this.Tt(r,i,e);this.Rt(n)}}}Rt(e){var t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Qo extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ho{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Wo.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Ho(oi.min(),r,new vs(ri),Wa,no())}}class Wo{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Wo(n,t,no(),no(),no())}}class Xo{constructor(e,t,n,r){this.vt=e,this.removedTargetIds=t,this.key=n,this.Pt=r}}class Yo{constructor(e,t){this.targetId=e,this.bt=t}}class Jo{constructor(e,t,n=xs.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Zo{constructor(){this.Vt=0,this.St=nu(),this.Dt=xs.EMPTY_BYTE_STRING,this.Ct=!1,this.xt=!0}get current(){return this.Ct}get resumeToken(){return this.Dt}get Nt(){return 0!==this.Vt}get kt(){return this.xt}Mt(e){0<e.approximateByteSize()&&(this.xt=!0,this.Dt=e)}Ot(){let n=no(),r=no(),i=no();return this.St.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:Kr()}}),new Wo(this.Dt,this.Ct,n,r,i)}$t(){this.xt=!1,this.St=nu()}Ft(e,t){this.xt=!0,this.St=this.St.insert(e,t)}Bt(e){this.xt=!0,this.St=this.St.remove(e)}Lt(){this.Vt+=1}qt(){--this.Vt}Ut(){this.xt=!0,this.Ct=!0}}class eu{constructor(e){this.Kt=e,this.Gt=new Map,this.Qt=Wa,this.jt=tu(),this.zt=new vs(ri)}Wt(e){for(const t of e.vt)e.Pt&&e.Pt.isFoundDocument()?this.Ht(t,e.Pt):this.Jt(t,e.key,e.Pt);for(const n of e.removedTargetIds)this.Jt(n,e.key,e.Pt)}Yt(n){this.forEachTarget(n,e=>{const t=this.Xt(e);switch(n.state){case 0:this.Zt(e)&&t.Mt(n.resumeToken);break;case 1:t.qt(),t.Nt||t.$t(),t.Mt(n.resumeToken);break;case 2:t.qt(),t.Nt||this.removeTarget(e);break;case 3:this.Zt(e)&&(t.Ut(),t.Mt(n.resumeToken));break;case 4:this.Zt(e)&&(this.te(e),t.Mt(n.resumeToken));break;default:Kr()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.Gt.forEach((e,t)=>{this.Zt(t)&&n(t)})}ee(e){const t=e.targetId,n=e.bt.count,r=this.ne(t);if(r){var i=r.target;if(Da(i))if(0===n){const e=new di(i.path);this.Jt(t,e,ta.newNoDocument(e,oi.min()))}else Gr(1===n);else{const r=this.se(t);if(r!==n){const n=this.ie(e,r);if(0!==n){this.te(t);const e=2===n?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.zt=this.zt.insert(t,e)}null===(i=Bo.instance)||void 0===i||i.notifyOnExistenceFilterMismatch(function(e,t,n){var r;const i={localCacheCount:t,existenceFilterCount:n.count},s=n.unchangedNames;return s&&(i.bloomFilter={applied:0===e,hashCount:null!==(r=null==s?void 0:s.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(r=null===(r=null===(r=null==s?void 0:s.bits)||void 0===r?void 0:r.bitmap)||void 0===r?void 0:r.length)&&void 0!==r?r:0,padding:null!==(r=null===(r=null==s?void 0:s.bits)||void 0===r?void 0:r.padding)&&void 0!==r?r:0}),i}(n,r,e.bt))}}}}ie(e,t){var{unchangedNames:n,count:r}=e.bt;if(!n||!n.bits)return 1;var{bits:{bitmap:i="",padding:s=0},hashCount:n=0}=n;let a,o;try{a=Ns(i).toUint8Array()}catch(e){if(e instanceof Ss)return Ur("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{o=new $o(a,s,n)}catch(e){return Ur(e instanceof Qo?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===o.yt?1:r!==t-this.re(e.targetId,o)?2:0}re(n,r){const e=this.Kt.getRemoteKeysForTarget(n);let i=0;return e.forEach(e=>{var t=this.Kt.oe(),t=`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`;r.At(t)||(this.Jt(n,e,null),i++)}),i}ue(r){const i=new Map;this.Gt.forEach((e,t)=>{var n=this.ne(t);if(n){if(e.current&&Da(n.target)){const i=new di(n.target.path);null!==this.Qt.get(i)||this.ce(t,i)||this.Jt(t,i,ta.newNoDocument(i,r))}e.kt&&(i.set(t,e.Ot()),e.$t())}});let s=no();this.jt.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{var t=this.ne(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1)}),n&&(s=s.add(e))}),this.Qt.forEach((e,t)=>t.setReadTime(r));var e=new Ho(r,i,this.zt,this.Qt,s);return this.Qt=Wa,this.jt=tu(),this.zt=new vs(ri),e}Ht(e,t){var n;this.Zt(e)&&(n=this.ce(e,t.key)?2:0,this.Xt(e).Ft(t.key,n),this.Qt=this.Qt.insert(t.key,t),this.jt=this.jt.insert(t.key,this.ae(t.key).add(e)))}Jt(e,t,n){if(this.Zt(e)){const r=this.Xt(e);this.ce(e,t)?r.Ft(t,1):r.Bt(t),this.jt=this.jt.insert(t,this.ae(t).delete(e)),n&&(this.Qt=this.Qt.insert(t,n))}}removeTarget(e){this.Gt.delete(e)}se(e){var t=this.Xt(e).Ot();return this.Kt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Lt(e){this.Xt(e).Lt()}Xt(e){let t=this.Gt.get(e);return t||(t=new Zo,this.Gt.set(e,t)),t}ae(e){let t=this.jt.get(e);return t||(t=new Is(ri),this.jt=this.jt.insert(e,t)),t}Zt(e){var t=null!==this.ne(e);return t||qr("WatchChangeAggregator","Detected inactive target",e),t}ne(e){var t=this.Gt.get(e);return t&&t.Nt?null:this.Kt.he(e)}te(t){this.Gt.set(t,new Zo),this.Kt.getRemoteKeysForTarget(t).forEach(e=>{this.Jt(t,e,null)})}ce(e,t){return this.Kt.getRemoteKeysForTarget(e).has(t)}}function tu(){return new vs(di.comparator)}function nu(){return new vs(di.comparator)}const ru={asc:"ASCENDING",desc:"DESCENDING"},iu={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},su={and:"AND",or:"OR"};class au{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ou(e,t){return e.useProto3Json||Vi(t)?t:{value:t}}function uu(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function cu(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function hu(e){return Gr(!!e),oi.fromTimestamp((t=As(e),new ai(t.seconds,t.nanos)));var t}function lu(e,t){return e=e,new ci(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function du(e){var t=ci.fromString(e);return Gr(Nu(t)),t}function fu(e,t){return lu(e.databaseId,t.path)}function gu(e,t){const n=du(t);if(n.get(1)!==e.databaseId.projectId)throw new $r(zr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new $r(zr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new di(vu(n))}function mu(e,t){return lu(e.databaseId,t)}function pu(e){var t=du(e);return 4===t.length?ci.emptyPath():vu(t)}function yu(e){return new ci(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function vu(e){return Gr(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function wu(e,t,n){return{name:fu(e,t),fields:n.value.mapValue.fields}}function bu(e,t,n){const r=gu(e,t.name),i=hu(t.updateTime),s=t.createTime?hu(t.createTime):oi.min(),a=new ea({mapValue:{fields:t.fields}}),o=ta.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Iu(e,t){let n;if(t instanceof Do)n={update:wu(e,t.key,t.value)};else if(t instanceof Ro)n={delete:fu(e,t.key)};else if(t instanceof Ao)n={update:wu(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof Mo))return Kr();n={verify:fu(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof co)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof ho)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof fo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof mo)return{fieldPath:e.field.canonicalString(),increment:t.wt};throw Kr()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:(t=r.updateTime,uu(e,t.toTimestamp()))}:void 0!==r.exists?{exists:r.exists}:Kr()),n;var r}function Eu(t,n){const e=n.currentDocument?void 0!==(i=n.currentDocument).updateTime?bo.updateTime(hu(i.updateTime)):void 0!==i.exists?bo.exists(i.exists):bo.none():bo.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)Gr("REQUEST_TIME"===t.setToServerValue),n=new co;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new ho(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new fo(e)}else"increment"in t?n=new mo(e,t.increment):Kr();var r=li.fromServerFormat(t.fieldPath);return new vo(r,n)}(t,e)):[];var i;if(n.update){n.update.name;var s=gu(t,n.update.name),a=new ea({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new _s(e.map(e=>li.fromServerFormat(e)))}();return new Ao(s,a,t,e,r)}return new Do(s,a,e,r)}if(n.delete){const r=gu(t,n.delete);return new Ro(r,e)}if(n.verify){const r=gu(t,n.verify);return new Mo(r,e)}return Kr()}function Tu(e,t){return{documents:[mu(e,t.path)]}}function _u(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=mu(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=mu(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length)return function n(e){return e instanceof oa?function(e){if("=="===e.op){if(Hs(e.value))return{unaryFilter:{field:Au(e.field),op:"IS_NAN"}};if(Qs(e.value))return{unaryFilter:{field:Au(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Hs(e.value))return{unaryFilter:{field:Au(e.field),op:"IS_NOT_NAN"}};if(Qs(e.value))return{unaryFilter:{field:Au(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Au(e.field),op:xu(e.op),value:e.value}}}(e):e instanceof ua?function(e){const t=e.getFilters().map(e=>n(e));return 1===t.length?t[0]:{compositeFilter:{op:Du(e.op),filters:t}}}(e):Kr()}(ua.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);i=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Au(e.field),direction:(e=e.dir,ru[e])}}(e))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);i=ou(e,t.limit);return null!==i&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt={before:(i=t.startAt).inclusive,values:i.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function Su(e){let t=pu(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(0<r){Gr(1===r);const g=n.from[0];g.allDescendants?i=g.collectionId:t=t.child(g.collectionId)}let s=[];n.where&&(s=function(){const e=function t(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Cu(e.unaryFilter.field);return oa.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Cu(e.unaryFilter.field);return oa.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Cu(e.unaryFilter.field);return oa.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Cu(e.unaryFilter.field);return oa.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Kr()}}(e):void 0!==e.fieldFilter?function(e){return oa.create(Cu(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Kr()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return ua.create(e.compositeFilter.filters.map(e=>t(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Kr()}}(e.compositeFilter.op))}(e):Kr()}(n.where);return e instanceof ua&&la(e)?e.getFilters():[e]}());let a=[];n.orderBy&&(a=n.orderBy.map(e=>function(e){return new sa(Cu(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let o=null;var u,c,h,l;n.limit&&(o=(e=n.limit,Vi(u="object"==typeof e?e.value:e)?null:u));let d=null;n.startAt&&(d=(c=n.startAt,l=!!c.before,h=c.values||[],new na(h,l)));let f=null;return n.endAt&&(f=(c=n.endAt,h=!c.before,l=c.values||[],new na(l,h))),Ra(t,i,a,s,o,"F",d,f)}function xu(e){return iu[e]}function Du(e){return su[e]}function Au(e){return{fieldPath:e.canonicalString()}}function Cu(e){return li.fromServerFormat(e.fieldPath)}function Nu(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}class ku{constructor(e,t,n,r,i=oi.min(),s=oi.min(),a=xs.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new ku(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ku(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ku(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ku(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ru{constructor(e){this.le=e}}function Mu(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Fu(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:fu(i=e.le,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:uu(i,e.version.toTimestamp()),createTime:uu(i,e.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Lu(t.version)};else{if(!t.isUnknownDocument())return Kr();r.unknownDocument={path:n.path.toArray(),version:Lu(t.version)}}var i;return r}function Fu(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Lu(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Ou(e){var t=new ai(e.seconds,e.nanoseconds);return oi.fromTimestamp(t)}function Pu(t,e){const n=(e.baseMutations||[]).map(e=>Eu(t.le,e));for(let s=0;s<e.mutations.length-1;++s){const n=e.mutations[s];if(s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform){const r=e.mutations[s+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(e=>Eu(t.le,e)),i=ai.fromMillis(e.localWriteTimeMs);return new Fo(e.batchId,i,n,r)}function Vu(e){var t,n=Ou(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?Ou(e.lastLimboFreeSnapshotVersion):oi.min();let i;return i=void 0!==e.query.documents?(Gr(1===(t=e.query).documents.length),qa(Ma(pu(t.documents[0])))):qa(Su(e.query)),new ku(i,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,r,xs.fromBase64String(e.resumeToken))}function qu(e,t){var n=Lu(t.snapshotVersion),r=Lu(t.lastLimboFreeSnapshotVersion),i=(Da(t.target)?Tu:_u)(e.le,t.target),s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Sa(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Bu(e){var t=Su({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ua(t,t.limit,"L"):t}function Uu(e,t){return new Oo(t.largestBatchId,Eu(e.le,t.overlayMutation))}function ju(e,t){var n=t.path.lastSegment();return[e,Ui(t.path.popLast()),n]}function Ku(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Lu(r.readTime),documentKey:Ui(r.documentKey.path),largestBatchId:r.largestBatchId}}class Gu{getBundleMetadata(e,t){return zu(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:Ou(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return zu(e).put({bundleId:(n=t).id,createTime:Lu(hu(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return $u(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:Bu(t.bundledQuery),readTime:Ou(t.readTime)};var t})}saveNamedQuery(e,t){return $u(e).put({name:(t=t).name,readTime:Lu(hu(t.readTime)),bundledQuery:t.bundledQuery})}}function zu(e){return gs(e,"bundles")}function $u(e){return gs(e,"namedQueries")}class Qu{constructor(e,t){this.serializer=e,this.userId=t}static fe(e,t){var n=t.uid||"";return new Qu(e,n)}getOverlay(e,t){return Hu(e).get(ju(this.userId,t)).next(e=>e?Uu(this.serializer,e):null)}getOverlays(e,t){const n=Za();return Si.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(r,i,e){const s=[];return e.forEach((e,t)=>{var n=new Oo(i,t);s.push(this.de(r,n))}),Si.waitFor(s)}removeOverlaysForBatchId(n,e,r){const t=new Set;e.forEach(e=>t.add(Ui(e.getCollectionPath())));const i=[];return t.forEach(e=>{var t=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,r+1],!1,!0);i.push(Hu(n).J("collectionPathOverlayIndex",t))}),Si.waitFor(i)}getOverlaysForCollection(e,t,n){const r=Za(),i=Ui(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Hu(e).j("collectionPathOverlayIndex",s).next(e=>{for(const t of e){const e=Uu(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,i){const s=Za();let a;var r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Hu(e).X({index:"collectionGroupOverlayIndex",range:r},(e,t,n)=>{const r=Uu(this.serializer,t);s.size()<i||r.largestBatchId===a?(s.set(r.getKey(),r),a=r.largestBatchId):n.done()}).next(()=>s)}de(e,t){return Hu(e).put(function(e,t,n){var[,r,i]=ju(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Iu(e.le,n.mutation)}}(this.serializer,this.userId,t))}}function Hu(e){return gs(e,"documentOverlays")}class Wu{constructor(){}_e(e,t){this.we(e,t),t.me()}we(e,t){var n,r;"nullValue"in e?this.ge(t,5):"booleanValue"in e?(this.ge(t,10),t.ye(e.booleanValue?1:0)):"integerValue"in e?(this.ge(t,15),t.ye(Cs(e.integerValue))):"doubleValue"in e?(n=Cs(e.doubleValue),isNaN(n)?this.ge(t,13):(this.ge(t,15),qi(n)?t.ye(0):t.ye(n))):"timestampValue"in e?(r=e.timestampValue,this.ge(t,20),"string"==typeof r?t.pe(r):(t.pe(`${r.seconds||""}`),t.ye(r.nanos||0))):"stringValue"in e?(this.Ie(e.stringValue,t),this.Te(t)):"bytesValue"in e?(this.ge(t,30),t.Ee(Ns(e.bytesValue)),this.Te(t)):"referenceValue"in e?this.Ae(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.ge(t,45),t.ye(r.latitude||0),t.ye(r.longitude||0)):"mapValue"in e?Ys(e)?this.ge(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Te(t)):"arrayValue"in e?(this.ve(e.arrayValue,t),this.Te(t)):Kr()}Ie(e,t){this.ge(t,25),this.Pe(e,t)}Pe(e,t){t.pe(e)}Re(e,t){var n=e.fields||{};this.ge(t,55);for(const e of Object.keys(n))this.Ie(e,t),this.we(n[e],t)}ve(e,t){var n=e.values||[];this.ge(t,50);for(const e of n)this.we(e,t)}Ae(e,t){this.ge(t,37),di.fromName(e).path.forEach(e=>{this.ge(t,60),this.Pe(e,t)})}ge(e,t){e.ye(t)}Te(e){e.ye(2)}}function Xu(e){var t=64-function(e){let t=0;for(let r=0;r<8;++r){var n=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e);return Math.ceil(t/8)}Wu.be=new Wu;class Yu{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ve(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Se(n.value),n=t.next();this.De()}Ce(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.xe(n.value),n=t.next();this.Ne()}ke(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Se(e);else if(e<2048)this.Se(960|e>>>6),this.Se(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Se(480|e>>>12),this.Se(128|63&e>>>6),this.Se(128|63&e);else{const e=t.codePointAt(0);this.Se(240|e>>>18),this.Se(128|63&e>>>12),this.Se(128|63&e>>>6),this.Se(128|63&e)}}this.De()}Me(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.xe(e);else if(e<2048)this.xe(960|e>>>6),this.xe(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.xe(480|e>>>12),this.xe(128|63&e>>>6),this.xe(128|63&e);else{const e=t.codePointAt(0);this.xe(240|e>>>18),this.xe(128|63&e>>>12),this.xe(128|63&e>>>6),this.xe(128|63&e)}}this.Ne()}Oe(e){var t=this.$e(e),n=Xu(t);this.Fe(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Be(e){var t=this.$e(e),n=Xu(t);this.Fe(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Le(){this.qe(255),this.qe(255)}Ue(){this.Ke(255),this.Ke(255)}reset(){this.position=0}seed(e){this.Fe(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ge(){return this.buffer.slice(0,this.position)}$e(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Se(e){var t=255&e;0==t?(this.qe(0),this.qe(255)):255==t?(this.qe(255),this.qe(0)):this.qe(t)}xe(e){var t=255&e;0==t?(this.Ke(0),this.Ke(255)):255==t?(this.Ke(255),this.Ke(0)):this.Ke(e)}De(){this.qe(0),this.qe(1)}Ne(){this.Ke(0),this.Ke(1)}qe(e){this.Fe(1),this.buffer[this.position++]=e}Ke(e){this.Fe(1),this.buffer[this.position++]=~e}Fe(e){var t=e+this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class Ju{constructor(e){this.Qe=e}Ee(e){this.Qe.Ve(e)}pe(e){this.Qe.ke(e)}ye(e){this.Qe.Oe(e)}me(){this.Qe.Le()}}class Zu{constructor(e){this.Qe=e}Ee(e){this.Qe.Ce(e)}pe(e){this.Qe.Me(e)}ye(e){this.Qe.Be(e)}me(){this.Qe.Ue()}}class ec{constructor(){this.Qe=new Yu,this.je=new Ju(this.Qe),this.ze=new Zu(this.Qe)}seed(e){this.Qe.seed(e)}We(e){return 0===e?this.je:this.ze}Ge(){return this.Qe.Ge()}reset(){this.Qe.reset()}}class tc{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}He(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new tc(this.indexId,this.documentKey,this.arrayValue,n)}}function nc(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=rc(e.arrayValue,t.arrayValue),0!==n?n:(n=rc(e.directionalValue,t.directionalValue),0!==n?n:di.comparator(e.documentKey,t.documentKey)))}function rc(e,t){for(let r=0;r<e.length&&r<t.length;++r){var n=e[r]-t[r];if(0!=n)return n}return e.length-t.length}class ic{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Je=e.orderBy,this.Ye=[];for(const t of e.filters){const e=t;e.isInequality()?this.Xe=e:this.Ye.push(e)}}Ze(e){Gr(e.collectionGroup===this.collectionId);var t=gi(e);if(void 0!==t&&!this.tn(t))return!1;var n=mi(e);let r=0,i=0;for(;r<n.length&&this.tn(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Xe){const e=n[r];if(!this.en(this.Xe,e)||!this.nn(this.Je[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Je.length||!this.nn(this.Je[i++],e))return!1}return!0}tn(e){for(const t of this.Ye)if(this.en(t,e))return!0;return!1}en(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind==n}nn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function sc(e){if(0===e.getFilters().length)return[];const t=function t(e){if(Gr(e instanceof oa||e instanceof ua),e instanceof oa)return e;if(1===e.filters.length)return t(e.filters[0]);const n=e.filters.map(e=>t(e));let r=ua.create(n,e.op);return r=lc(r),uc(r)?r:(Gr(r instanceof ua),Gr(ca(r)),Gr(1<r.filters.length),r.filters.reduce((e,t)=>cc(e,t)))}(function t(n){var e;if(Gr(n instanceof oa||n instanceof ua),n instanceof oa){if(n instanceof ba){const r=(null===(e=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===e?void 0:e.map(e=>oa.create(n.field,"==",e)))||[];return ua.create(r,"or")}return n}const r=n.filters.map(e=>t(e));return ua.create(r,n.op)}(e));return Gr(uc(t)),ac(t)||oc(t)?[t]:t.getFilters()}function ac(e){return e instanceof oa}function oc(e){return e instanceof ua&&la(e)}function uc(e){return ac(e)||oc(e)||function(e){if(e instanceof ua&&ha(e)){for(const t of e.getFilters())if(!ac(t)&&!oc(t))return!1;return!0}return!1}(e)}function cc(e,t){var n,r;return Gr(e instanceof oa||e instanceof ua),Gr(t instanceof oa||t instanceof ua),lc(e instanceof oa?t instanceof oa?(n=e,r=t,ua.create([n,r],"and")):hc(e,t):t instanceof oa?hc(t,e):function(e,t){if(Gr(0<e.filters.length&&0<t.filters.length),ca(e)&&ca(t))return fa(e,t.getFilters());const n=ha(e)?e:t,r=ha(e)?t:e,i=n.filters.map(e=>cc(e,r));return ua.create(i,"or")}(e,t))}function hc(t,e){if(ca(e))return fa(e,t.getFilters());var n=e.filters.map(e=>cc(t,e));return ua.create(n,"or")}function lc(t){if(Gr(t instanceof oa||t instanceof ua),t instanceof oa)return t;const e=t.getFilters();if(1===e.length)return lc(e[0]);if(da(t))return t;const n=e.map(e=>lc(e)),r=[];return n.forEach(e=>{e instanceof oa?r.push(e):e instanceof ua&&(e.op===t.op?r.push(...e.filters):r.push(e))}),1===r.length?r[0]:ua.create(r,t.op)}class dc{constructor(){this.sn=new fc}addToCollectionParentIndex(e,t){return this.sn.add(t),Si.resolve()}getCollectionParents(e,t){return Si.resolve(this.sn.getEntries(t))}addFieldIndex(e,t){return Si.resolve()}deleteFieldIndex(e,t){return Si.resolve()}getDocumentsMatchingTarget(e,t){return Si.resolve(null)}getIndexType(e,t){return Si.resolve(0)}getFieldIndexes(e,t){return Si.resolve([])}getNextCollectionGroupToUpdate(e){return Si.resolve(null)}getMinOffset(e,t){return Si.resolve(bi.min())}getMinOffsetFromCollectionGroup(e,t){return Si.resolve(bi.min())}updateCollectionGroup(e,t,n){return Si.resolve()}updateIndexEntries(e,t){return Si.resolve()}}class fc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Is(ci.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Is(ci.comparator)).toArray()}}const gc=new Uint8Array(0);class mc{constructor(e,t){this.user=e,this.databaseId=t,this.rn=new fc,this.on=new Ha(e=>Sa(e),(e,t)=>xa(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.rn.has(t))return Si.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.rn.add(t)});r={collectionId:n,parent:Ui(r)};return pc(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[si(n),""],!1,!0);return pc(e).j(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(Ki(t.parent))}return r})}addFieldIndex(e,t){const n=vc(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;const i=n.add(r);if(t.indexState){const n=wc(e);return i.next(e=>{n.put(Ku(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=vc(e),r=wc(e),i=yc(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,c){const h=yc(e);let l=!0;const n=new Map;return Si.forEach(this.un(c),t=>this.cn(e,t).next(e=>{l=l&&!!e,n.set(t,e)})).next(()=>{if(l){let u=no();const l=[];return Si.forEach(n,(e,t)=>{qr("IndexedDbIndexManager",`Using index ${o=e,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`} to execute ${Sa(c)}`);var n=function(e,t){var n=gi(t);if(void 0===n)return null;for(const t of Aa(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(t,e),r=function(e,t){const n=new Map;for(const r of mi(t))for(const t of Aa(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(t,e),i=function(e,t){const n=[];let r=!0;for(const i of mi(t)){const t=(0===i.kind?Ca:Na)(e,i.fieldPath,e.startAt);n.push(t.value),r=r&&t.inclusive}return new na(n,r)}(t,e),s=function(e,t){const n=[];let r=!0;for(const i of mi(t)){const t=(0===i.kind?Na:Ca)(e,i.fieldPath,e.endAt);n.push(t.value),r=r&&t.inclusive}return new na(n,r)}(t,e),a=this.an(e,t,i),o=this.an(e,t,s),r=this.hn(e,t,r),r=this.ln(e.indexId,n,a,i.inclusive,o,s.inclusive,r);return Si.forEach(r,e=>h.H(e,c.limit).next(e=>{e.forEach(e=>{var t=di.fromSegments(e.documentKey);u.has(t)||(u=u.add(t),l.push(t))})}))}).next(()=>l)}return Si.resolve(null)})}un(t){let e=this.on.get(t);return e||(e=0===t.filters.length?[t]:sc(ua.create(t.filters,"and")).map(e=>_a(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt)),this.on.set(t,e),e)}ln(t,e,n,r,i,s,a){const o=(null!=e?e.length:1)*Math.max(n.length,i.length),u=o/(null!=e?e.length:1),c=[];for(let h=0;h<o;++h){const o=e?this.fn(e[h/u]):gc,l=this.dn(t,o,n[h%u],r),d=this._n(t,o,i[h%u],s),f=a.map(e=>this.dn(t,o,e,!0));c.push(...this.createRange(l,d,f))}return c}dn(e,t,n,r){const i=new tc(e,di.empty(),t,n);return r?i:i.He()}_n(e,t,n,r){const i=new tc(e,di.empty(),t,n);return r?i.He():i}cn(e,t){const r=new ic(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(const n of e)r.Ze(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let n=2;const r=this.un(t);return Si.forEach(r,t=>this.cn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new Is(li.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&1<r.length&&2===n?1:n)}wn(e,t){const n=new ec;for(const i of mi(e)){const e=t.data.field(i.fieldPath);if(null==e)return null;var r=n.We(i.kind);Wu.be._e(e,r)}return n.Ge()}fn(e){const t=new ec;return Wu.be._e(e,t.We(0)),t.Ge()}mn(e,t){const n=new ec;return Wu.be._e(Gs(this.databaseId,t),n.We(0===(r=mi(e)).length?0:r[r.length-1].kind)),n.Ge();var r}hn(e,t,n){if(null===n)return[];let r=[];r.push(new ec);let i=0;for(const s of mi(e)){const e=n[i++];for(const n of r)if(this.gn(t,s.fieldPath)&&$s(e))r=this.yn(r,s,e);else{const t=n.We(s.kind);Wu.be._e(e,t)}}return this.pn(r)}an(e,t,n){return this.hn(e,t,n.position)}pn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Ge();return t}yn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new ec;r.seed(n.Ge()),Wu.be._e(e,r.We(t.kind)),i.push(r)}return i}gn(e,t){return!!e.filters.find(e=>e instanceof oa&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=vc(e),r=wc(e);return(t?n.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.j()).next(e=>{const s=[];return Si.forEach(e,i=>r.get([i.indexId,this.uid]).next(e=>{var t,n,r;s.push((t=i,n=(e=e)?new yi(e.sequenceNumber,new bi(Ou(e.readTime),new di(Ki(e.documentKey)),e.largestBatchId)):yi.empty(),r=t.fields.map(([e,t])=>new pi(li.fromServerFormat(e),t)),new fi(t.indexId,t.collectionGroup,r,n)))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=n?n:ri(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=vc(e),s=wc(e);return this.In(e).next(t=>i.j("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(e=>Si.forEach(e,e=>s.put(Ku(e.indexId,this.user,t,r)))))}updateIndexEntries(i,e){const n=new Map;return Si.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?Si.resolve(e):this.getFieldIndexes(i,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),Si.forEach(e,n=>this.Tn(i,t,n).next(e=>{var t=this.En(r,n);return e.isEqual(t)?Si.resolve():this.An(i,r,n,e,t)}))))})}Rn(e,t,n,r){return yc(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,r){return yc(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}Tn(e,n,r){const t=yc(e);let i=new Is(nc);return t.X({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,n)])},(e,t)=>{i=i.add(new tc(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>i)}En(e,t){let n=new Is(nc);var r=this.wn(t,e);if(null==r)return n;const i=gi(t);if(null!=i){var s=e.data.field(i.fieldPath);if($s(s))for(const i of s.arrayValue.values||[])n=n.add(new tc(t.indexId,e.key,this.fn(i),r))}else n=n.add(new tc(t.indexId,e.key,gc,r));return n}An(t,n,r,c,e){qr("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const i=[];return function(e,n,r,i){var s=c.getIterator(),a=e.getIterator();let o=Ts(s),u=Ts(a);for(;o||u;){let e=!1,t=!1;if(o&&u){const r=n(o,u);r<0?t=!0:0<r&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(u),u=Ts(a)):t?(i(o),o=Ts(s)):(o=Ts(s),u=Ts(a))}}(e,nc,e=>{i.push(this.Rn(t,n,r,e))},e=>{i.push(this.vn(t,n,r,e))}),Si.waitFor(i)}In(e){let r=1;return wc(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}createRange(e,t,n){n=n.sort((e,t)=>nc(e,t)).filter((e,t,n)=>!t||0!==nc(e,n[t-1]));const r=[];r.push(e);for(const i of n){const n=nc(i,e),s=nc(i,t);if(0===n)r[0]=e.He();else if(0<n&&s<0)r.push(i),r.push(i.He());else if(0<s)break}r.push(t);const i=[];for(let a=0;a<r.length;a+=2){if(this.Pn(r[a],r[a+1]))return[];const t=[r[a].indexId,this.uid,r[a].arrayValue,r[a].directionalValue,gc,[]],n=[r[a+1].indexId,this.uid,r[a+1].arrayValue,r[a+1].directionalValue,gc,[]];i.push(IDBKeyRange.bound(t,n))}return i}Pn(e,t){return 0<nc(e,t)}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(bc)}getMinOffset(t,e){return Si.mapArray(this.un(e),e=>this.cn(t,e).next(e=>e||Kr())).next(bc)}}function pc(e){return gs(e,"collectionParents")}function yc(e){return gs(e,"indexEntries")}function vc(e){return gs(e,"indexConfiguration")}function wc(e){return gs(e,"indexState")}function bc(e){Gr(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let i=1;i<e.length;i++){var r=e[i].indexState.offset;Ii(r,t)<0&&(t=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new bi(t.readTime,t.documentKey,n)}const Ic={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ec{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Ec(e,Ec.DEFAULT_COLLECTION_PERCENTILE,Ec.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Tc(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId);let o=0;const u=r.X({range:a},(e,t,n)=>(o++,n.delete()));s.push(u.next(()=>{Gr(1===o)}));const c=[];for(const e of n.mutations){const r=$i(t,e.key.path,n.batchId);s.push(i.delete(r)),c.push(e.key)}return Si.waitFor(s).next(()=>c)}function _c(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Kr();t=e.noDocument}return JSON.stringify(t).length}Ec.DEFAULT_COLLECTION_PERCENTILE=10,Ec.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ec.DEFAULT=new Ec(41943040,Ec.DEFAULT_COLLECTION_PERCENTILE,Ec.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ec.DISABLED=new Ec(-1,0,0);class Sc{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.bn={}}static fe(e,t,n,r){Gr(""!==e.uid);var i=e.isAuthenticated()?e.uid:"";return new Sc(i,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Dc(e).X({index:"userMutationsIndex",range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(h,l,d,f){const g=Ac(h),m=Dc(h);return m.add({}).next(e=>{Gr("number"==typeof e);const t=new Fo(e,l,d,f),n=(i=this.serializer,s=this.userId,a=t,o=a.baseMutations.map(e=>Iu(i.le,e)),u=a.mutations.map(e=>Iu(i.le,e)),{userId:s,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:u}),r=[];var i,s,a,o,u;let c=new Is((e,t)=>ri(e.canonicalString(),t.canonicalString()));for(const h of f){const l=$i(this.userId,h.key.path,e);c=c.add(h.key.path.popLast()),r.push(m.put(n)),r.push(g.put(l,Qi))}return c.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(h,e))}),h.addOnCommittedListener(()=>{this.bn[e]=t.keys()}),Si.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return Dc(e).get(t).next(e=>e?(Gr(e.userId===this.userId),Pu(this.serializer,e)):null)}Vn(e,n){return this.bn[n]?Si.resolve(this.bn[n]):this.lookupMutationBatch(e,n).next(e=>{if(e){var t=e.keys();return this.bn[n]=t}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Dc(e).X({index:"userMutationsIndex",range:n},(e,t,n)=>{t.userId===this.userId&&(Gr(t.batchId>=r),i=Pu(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Dc(e).X({index:"userMutationsIndex",range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Dc(e).j("userMutationsIndex",t).next(e=>e.map(e=>Pu(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(a,o){const e=zi(this.userId,o.path),t=IDBKeyRange.lowerBound(e),u=[];return Ac(a).X({range:t},(e,t,n)=>{var[r,i,s]=e,i=Ki(i);if(r===this.userId&&o.path.isEqual(i))return Dc(a).get(s).next(e=>{if(!e)throw Kr();Gr(e.userId===this.userId),u.push(Pu(this.serializer,e))});n.done()}).next(()=>u)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new Is(ri);const n=[];return e.forEach(a=>{var e=zi(this.userId,a.path),e=IDBKeyRange.lowerBound(e),e=Ac(t).X({range:e},(e,t,n)=>{var[r,i,s]=e,i=Ki(i);r===this.userId&&a.path.isEqual(i)?o=o.add(s):n.done()});n.push(e)}),Si.waitFor(n).next(()=>this.Sn(t,o))}getAllMutationBatchesAffectingQuery(e,t){const a=t.path,o=a.length+1,n=zi(this.userId,a),r=IDBKeyRange.lowerBound(n);let u=new Is(ri);return Ac(e).X({range:r},(e,t,n)=>{var[r,i,s]=e,i=Ki(i);r===this.userId&&a.isPrefixOf(i)?i.length===o&&(u=u.add(s)):n.done()}).next(()=>this.Sn(e,u))}Sn(t,e){const n=[],r=[];return e.forEach(e=>{r.push(Dc(t).get(e).next(e=>{if(null===e)throw Kr();Gr(e.userId===this.userId),n.push(Pu(this.serializer,e))}))}),Si.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return Tc(t.at,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.Dn(n.batchId)}),Si.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}Dn(e){delete this.bn[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return Si.resolve();var t=IDBKeyRange.lowerBound([this.userId]);const r=[];return Ac(n).X({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=Ki(e[1]);r.push(t)}else n.done()}).next(()=>{Gr(0===r.length)})})}containsKey(e,t){return xc(e,this.userId,t)}Cn(e){return Cc(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function xc(e,s,t){const n=zi(s,t.path),a=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return Ac(e).X({range:r,Y:!0},(e,t,n)=>{var[r,i]=e;r===s&&i===a&&(o=!0),n.done()}).next(()=>o)}function Dc(e){return gs(e,"mutations")}function Ac(e){return gs(e,"documentMutations")}function Cc(e){return gs(e,"mutationQueues")}class Nc{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static Nn(){return new Nc(0)}static kn(){return new Nc(-1)}}class kc{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(n){return this.Mn(n).next(e=>{const t=new Nc(e.highestTargetId);return e.highestTargetId=t.next(),this.On(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Mn(e).next(e=>oi.fromTimestamp(new ai(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Mn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Mn(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.On(t,e)))}addTargetData(t,n){return this.$n(t,n).next(()=>this.Mn(t).next(e=>(e.targetCount+=1,this.Fn(n,e),this.On(t,e))))}updateTargetData(e,t){return this.$n(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Rc(t).delete(e.targetId)).next(()=>this.Mn(t)).next(e=>(Gr(0<e.targetCount),--e.targetCount,this.On(t,e)))}removeTargets(r,i,s){let a=0;const o=[];return Rc(r).X((e,t)=>{var n=Vu(t);n.sequenceNumber<=i&&null===s.get(n.targetId)&&(a++,o.push(this.removeTargetData(r,n)))}).next(()=>Si.waitFor(o)).next(()=>a)}forEachTarget(e,r){return Rc(e).X((e,t)=>{var n=Vu(t);r(n)})}Mn(e){return Mc(e).get("targetGlobalKey").next(e=>(Gr(null!==e),e))}On(e,t){return Mc(e).put("targetGlobalKey",t)}$n(e,t){return Rc(e).put(qu(this.serializer,t))}Fn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Mn(e).next(e=>e.targetCount)}getTargetData(e,i){var t=Sa(i),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let s=null;return Rc(e).X({range:t,index:"queryTargetsIndex"},(e,t,n)=>{var r=Vu(t);xa(i,r.target)&&(s=r,n.done())}).next(()=>s)}addMatchingKeys(n,e,r){const i=[],s=Fc(n);return e.forEach(e=>{var t=Ui(e.path);i.push(s.put({targetId:r,path:t})),i.push(this.referenceDelegate.addReference(n,r,e))}),Si.waitFor(i)}removeMatchingKeys(n,e,r){const i=Fc(n);return Si.forEach(e,e=>{var t=Ui(e.path);return Si.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=Fc(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Fc(e);let i=no();return r.X({range:n,Y:!0},(e,t,n)=>{var r=Ki(e[1]),r=new di(r);i=i.add(r)}).next(()=>i)}containsKey(e,t){var n=Ui(t.path),n=IDBKeyRange.bound([n],[si(n)],!1,!0);let r=0;return Fc(e).X({index:"documentTargetsIndex",Y:!0,range:n},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}he(e,t){return Rc(e).get(t).next(e=>e?Vu(e):null)}}function Rc(e){return gs(e,"targets")}function Mc(e){return gs(e,"targetGlobal")}function Fc(e){return gs(e,"targetDocuments")}function Lc([e,t],[n,r]){var i=ri(e,n);return 0===i?ri(t,r):i}class Oc{constructor(e){this.Bn=e,this.buffer=new Is(Lc),this.Ln=0}qn(){return++this.Ln}Un(e){var t=[e,this.qn()];if(this.buffer.size<this.Bn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Lc(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Pc{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Kn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Gn(6e4)}stop(){this.Kn&&(this.Kn.cancel(),this.Kn=null)}get started(){return null!==this.Kn}Gn(e){qr("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Kn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Kn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ni(e)?qr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await _i(e)}await this.Gn(3e5)})}}class Vc{constructor(e,t){this.Qn=e,this.params=t}calculateTargetCount(e,t){return this.Qn.jn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Si.resolve(Pi.ct);const n=new Oc(t);return this.Qn.forEachTarget(e,e=>n.Un(e.sequenceNumber)).next(()=>this.Qn.zn(e,e=>n.Un(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Qn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Qn.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(qr("LruGarbageCollector","Garbage collection skipped; disabled"),Si.resolve(Ic)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(qr("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ic):this.Wn(t,n))}getCacheSize(e){return this.Qn.getCacheSize(e)}Wn(t,n){let r,i,s,a,o,u,c;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(qr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,o=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,u=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(c=Date.now(),Vr()<=l.DEBUG&&qr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-h}ms\n\tDetermined least recently used ${i} in `+(o-a)+"ms\n"+`\tRemoved ${s} targets in `+(u-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-u)+"ms\n"+`Total Duration: ${c-h}ms`),Si.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class qc{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new Vc(e,t))}jn(e){const n=this.Hn(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Hn(e){let t=0;return this.zn(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}zn(e,n){return this.Jn(e,(e,t)=>n(t))}addReference(e,t,n){return Bc(e,n)}removeReference(e,t,n){return Bc(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Bc(e,t)}Yn(t,n){let r=!1;return Cc(t).Z(e=>xc(t,e,n).next(e=>(e&&(r=!0),Si.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let a=0;return this.Jn(n,(t,e)=>{if(e<=r){const r=this.Yn(n,t).next(e=>{if(!e)return a++,i.getEntry(n,t).next(()=>(i.removeEntry(t,oi.min()),Fc(n).delete([0,Ui(t.path)])))});s.push(r)}}).next(()=>Si.waitFor(s)).next(()=>i.apply(n)).next(()=>a)}removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Bc(e,t)}Jn(e,r){const t=Fc(e);let i,s=Pi.ct;return t.X({index:"documentTargetsIndex"},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==Pi.ct&&r(new di(Ki(i)),s),s=n,i=t):s=Pi.ct}).next(()=>{s!==Pi.ct&&r(new di(Ki(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Bc(e,t){return Fc(e).put((e=e.currentSequenceNumber,{targetId:0,path:Ui(t.path),sequenceNumber:e}))}class Uc{constructor(){this.changes=new Ha(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ta.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Si.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class jc{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return $c(e).put(n)}removeEntry(e,n,t){return $c(e).delete(function(e){const t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],Fu(e),t[t.length-1]]}(t))}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.Xn(t,e)))}getEntry(e,n){let r=ta.newInvalidDocument(n);return $c(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(Qc(n))},(e,t)=>{r=this.Zn(n,t)}).next(()=>r)}ts(e,n){let r={size:0,document:ta.newInvalidDocument(n)};return $c(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(Qc(n))},(e,t)=>{r={document:this.Zn(n,t),size:_c(t)}}).next(()=>r)}getEntries(e,t){let r=Wa;return this.es(e,t,(e,t)=>{var n=this.Zn(e,t);r=r.insert(e,n)}).next(()=>r)}ns(e,t){let r=Wa,i=new vs(di.comparator);return this.es(e,t,(e,t)=>{var n=this.Zn(e,t);r=r.insert(e,n),i=i.insert(e,_c(t))}).next(()=>({documents:r,ss:i}))}es(e,t,i){if(t.isEmpty())return Si.resolve();let n=new Is(Wc);t.forEach(e=>n=n.add(e));const r=IDBKeyRange.bound(Qc(n.first()),Qc(n.last())),s=n.getIterator();let a=s.getNext();return $c(e).X({index:"documentKeyIndex",range:r},(e,t,n)=>{for(var r=di.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&Wc(a,r)<0;)i(a,null),a=s.getNext();a&&a.isEqual(r)&&(i(a,t),a=s.hasNext()?s.getNext():null),a?n.G(Qc(a)):n.done()}).next(()=>{for(;a;)i(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,r,t,i){const n=r.path,s=[n.popLast().toArray(),n.lastSegment(),Fu(t.readTime),t.documentKey.path.isEmpty()?"":t.documentKey.path.lastSegment()],a=[n.popLast().toArray(),n.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return $c(e).j(IDBKeyRange.bound(s,a,!0)).next(e=>{let t=Wa;for(const n of e){const e=this.Zn(di.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);e.isFoundDocument()&&(za(r,e)||i.has(e.key))&&(t=t.insert(e.key,e))}return t})}getAllFromCollectionGroup(e,t,n,i){let s=Wa;var r=Hc(t,n),a=Hc(t,bi.max());return $c(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,a,!0)},(e,t,n)=>{var r=this.Zn(di.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);s=s.insert(r.key,r),s.size===i&&n.done()}).next(()=>s)}newChangeBuffer(e){return new Gc(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return zc(e).get("remoteDocumentGlobalKey").next(e=>(Gr(!!e),e))}Xn(e,t){return zc(e).put("remoteDocumentGlobalKey",t)}Zn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=bu(e.le,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=di.fromSegments(t.noDocument.path),i=Ou(t.noDocument.readTime);n=ta.newNoDocument(e,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Kr();{const e=di.fromSegments(t.unknownDocument.path),s=Ou(t.unknownDocument.version);n=ta.newUnknownDocument(e,s)}}return t.readTime&&n.setReadTime((t=t.readTime,r=new ai(t[0],t[1]),oi.fromTimestamp(r))),n;var r}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(oi.min()))return e}return ta.newInvalidDocument(e)}}function Kc(e){return new jc(e)}class Gc extends Uc{constructor(e,t){super(),this.rs=e,this.trackRemovals=t,this.os=new Ha(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){const a=[];let o=0,u=new Is((e,t)=>ri(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.os.get(e);if(a.push(this.rs.removeEntry(s,e,n.readTime)),t.isValidDocument()){var r=Mu(this.rs.serializer,t);u=u.add(e.path.popLast());var i=_c(r);o+=i-n.size,a.push(this.rs.addEntry(s,e,r))}else if(o-=n.size,this.trackRemovals){const o=Mu(this.rs.serializer,t.convertToNoDocument(oi.min()));a.push(this.rs.addEntry(s,e,o))}}),u.forEach(e=>{a.push(this.rs.indexManager.addToCollectionParentIndex(s,e))}),a.push(this.rs.updateMetadata(s,o)),Si.waitFor(a)}getFromCache(e,t){return this.rs.ts(e,t).next(e=>(this.os.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.rs.ns(e,t).next(({documents:n,ss:e})=>(e.forEach((e,t)=>{this.os.set(e,{size:t,readTime:n.get(e).readTime})}),n))}}function zc(e){return gs(e,"remoteDocumentGlobal")}function $c(e){return gs(e,"remoteDocumentsV14")}function Qc(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Hc(e,t){const n=t.documentKey.path.toArray();return[e,Fu(t.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function Wc(e,t){var n=e.path.toArray(),r=t.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=ri(n[s],r[s]),i)return i;return i=ri(n.length,r.length),i||(i=ri(n[n.length-2],r[r.length-2]),i||ri(n[n.length-1],r[r.length-1]))}class Xc{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Yc{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(e=>(r=e,this.remoteDocumentCache.getEntry(t,n))).next(e=>(null!==r&&So(r.mutation,e,_s.empty(),ai.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,no()).next(()=>e))}getLocalViewOfDocuments(e,t,n=no()){const r=Za();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let n=Ya();return e.forEach((e,t)=>{n=n.insert(e,t.overlayedDocument)}),n}))}getOverlayedDocuments(e,t){const n=Za();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,no()))}populateOverlays(e,n,t){const r=[];return t.forEach(e=>{n.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,t)=>{n.set(e,t)})})}computeViews(e,t,r,i){let s=Wa;const a=Za(),o=Za();return t.forEach((e,t)=>{const n=r.get(t.key);i.has(t.key)&&(void 0===n||n.mutation instanceof Ao)?s=s.insert(t.key,t):void 0!==n?(a.set(t.key,n.mutation.getFieldMask()),So(n.mutation,t,n.mutation.getFieldMask(),ai.now())):a.set(t.key,_s.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new Xc(t,null!==(n=a.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(s,a){const o=Za();let u=new vs((e,t)=>e-t),c=no();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(s,a).next(e=>{for(const r of e)r.keys().forEach(e=>{var t,n=a.get(e);null!==n&&(t=o.get(e)||_s.empty(),t=r.applyToLocalView(n,t),o.set(e,t),t=(u.get(r.batchId)||no()).add(e),u=u.insert(r.batchId,t))})}).next(()=>{const e=[],t=u.getReverseIterator();for(;t.hasNext();){const u=t.getNext(),n=u.key,r=u.value,i=Za();r.forEach(e=>{var t;c.has(e)||(null!==(t=To(a.get(e),o.get(e)))&&i.set(e,t),c=c.add(e))}),e.push(this.documentOverlayCache.saveOverlays(s,n,i))}return Si.waitFor(e)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,di.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Pa(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var r}getNextDocuments(s,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(s,t,a,o).next(n=>{const e=0<o-n.size?this.documentOverlayCache.getOverlaysForCollectionGroup(s,t,a.largestBatchId,o-n.size):Si.resolve(Za());let r=-1,i=n;return e.next(e=>Si.forEach(e,(t,e)=>(r<e.largestBatchId&&(r=e.largestBatchId),n.get(t)?Si.resolve():this.remoteDocumentCache.getEntry(s,t).next(e=>{i=i.insert(t,e)}))).next(()=>this.populateOverlays(s,e,n)).next(()=>this.computeViews(s,i,e,no())).next(e=>({batchId:r,changes:Ja(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new di(t)).next(e=>{let t=Ya();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(r,i,s){const a=i.collectionGroup;let o=Ya();return this.indexManager.getCollectionParents(r,a).next(e=>Si.forEach(e,e=>{var t,n=(t=i,e=e.child(a),new ka(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.getDocumentsMatchingCollectionQuery(r,n,s).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,s,n){let a;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,n.largestBatchId).next(e=>(a=e,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,n,a))).next(r=>{a.forEach((e,t)=>{var n=t.getKey();null===r.get(n)&&(r=r.insert(n,ta.newInvalidDocument(n)))});let i=Ya();return r.forEach((e,t)=>{var n=a.get(e);void 0!==n&&So(n.mutation,t,_s.empty(),ai.now()),za(s,t)&&(i=i.insert(e,t))}),i})}}class Jc{constructor(e){this.serializer=e,this.us=new Map,this.cs=new Map}getBundleMetadata(e,t){return Si.resolve(this.us.get(t))}saveBundleMetadata(e,t){return this.us.set(t.id,{id:t.id,version:t.version,createTime:hu(t.createTime)}),Si.resolve()}getNamedQuery(e,t){return Si.resolve(this.cs.get(t))}saveNamedQuery(e,t){return this.cs.set(t.name,{name:(t=t).name,query:Bu(t.bundledQuery),readTime:hu(t.readTime)}),Si.resolve()}}class Zc{constructor(){this.overlays=new vs(di.comparator),this.hs=new Map}getOverlay(e,t){return Si.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Za();return Si.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){return e.forEach((e,t)=>{this.de(n,r,t)}),Si.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hs.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.hs.delete(n)),Si.resolve()}getOverlaysForCollection(e,t,n){const r=Za(),i=t.length+1,s=new di(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Si.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new vs((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=Za(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const a=Za(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return Si.resolve(a)}de(e,t,n){var r=this.overlays.get(n.key);if(null!==r){const e=this.hs.get(r.largestBatchId).delete(n.key);this.hs.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Oo(t,n));let i=this.hs.get(t);void 0===i&&(i=no(),this.hs.set(t,i)),this.hs.set(t,i.add(n.key))}}class eh{constructor(){this.ls=new Is(th.fs),this.ds=new Is(th._s)}isEmpty(){return this.ls.isEmpty()}addReference(e,t){var n=new th(e,t);this.ls=this.ls.add(n),this.ds=this.ds.add(n)}ws(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.gs(new th(e,t))}ys(e,t){e.forEach(e=>this.removeReference(e,t))}ps(e){const t=new di(new ci([])),n=new th(t,e),r=new th(t,e+1),i=[];return this.ds.forEachInRange([n,r],e=>{this.gs(e),i.push(e.key)}),i}Is(){this.ls.forEach(e=>this.gs(e))}gs(e){this.ls=this.ls.delete(e),this.ds=this.ds.delete(e)}Ts(e){var t=new di(new ci([])),n=new th(t,e),t=new th(t,e+1);let r=no();return this.ds.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new th(e,0),t=this.ls.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class th{constructor(e,t){this.key=e,this.Es=t}static fs(e,t){return di.comparator(e.key,t.key)||ri(e.Es,t.Es)}static _s(e,t){return ri(e.Es,t.Es)||di.comparator(e.key,t.key)}}class nh{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.As=1,this.Rs=new Is(th.fs)}checkEmpty(e){return Si.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){var i=this.As;this.As++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1];var s=new Fo(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.Rs=this.Rs.add(new th(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Si.resolve(s)}lookupMutationBatch(e,t){return Si.resolve(this.vs(t))}getNextMutationBatchAfterBatchId(e,t){var n=this.Ps(t+1),n=n<0?0:n;return Si.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return Si.resolve(0===this.mutationQueue.length?-1:this.As-1)}getAllMutationBatches(e){return Si.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new th(t,0),r=new th(t,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([n,r],e=>{var t=this.vs(e.Es);i.push(t)}),Si.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Is(ri);return t.forEach(e=>{var t=new th(e,0),n=new th(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,n],e=>{r=r.add(e.Es)})}),Si.resolve(this.bs(r))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;di.isDocumentKey(i)||(i=i.child(""));var s=new th(new di(i),0);let a=new Is(ri);return this.Rs.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Es)),!0)},s),Si.resolve(this.bs(a))}bs(e){const n=[];return e.forEach(e=>{var t=this.vs(e);null!==t&&n.push(t)}),n}removeMutationBatch(n,r){Gr(0===this.Vs(r.batchId,"removed")),this.mutationQueue.shift();let i=this.Rs;return Si.forEach(r.mutations,e=>{var t=new th(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.Rs=i})}Dn(e){}containsKey(e,t){var n=new th(t,0),n=this.Rs.firstAfterOrEqual(n);return Si.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,Si.resolve()}Vs(e,t){return this.Ps(e)}Ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}vs(e){var t=this.Ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class rh{constructor(e){this.Ss=e,this.docs=new vs(di.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Ss(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Si.resolve(n?n.document.mutableCopy():ta.newInvalidDocument(t))}getEntries(e,t){let n=Wa;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ta.newInvalidDocument(e))}),Si.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Wa;const s=t.path,a=new di(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Ii(wi(a),n)<=0||(r.has(a.key)||za(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return Si.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Kr()}Ds(e,t){return Si.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new ih(this)}getSize(e){return Si.resolve(this.size)}}class ih extends Uc{constructor(e){super(),this.rs=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.rs.addEntry(n,t)):this.rs.removeEntry(e)}),Si.waitFor(r)}getFromCache(e,t){return this.rs.getEntry(e,t)}getAllFromCache(e,t){return this.rs.getEntries(e,t)}}class sh{constructor(e){this.persistence=e,this.Cs=new Ha(e=>Sa(e),xa),this.lastRemoteSnapshotVersion=oi.min(),this.highestTargetId=0,this.xs=0,this.Ns=new eh,this.targetCount=0,this.ks=Nc.Nn()}forEachTarget(e,n){return this.Cs.forEach((e,t)=>n(t)),Si.resolve()}getLastRemoteSnapshotVersion(e){return Si.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Si.resolve(this.xs)}allocateTargetId(e){return this.highestTargetId=this.ks.next(),Si.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.xs&&(this.xs=t),Si.resolve()}$n(e){this.Cs.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.ks=new Nc(t),this.highestTargetId=t),e.sequenceNumber>this.xs&&(this.xs=e.sequenceNumber)}addTargetData(e,t){return this.$n(t),this.targetCount+=1,Si.resolve()}updateTargetData(e,t){return this.$n(t),Si.resolve()}removeTargetData(e,t){return this.Cs.delete(t.target),this.Ns.ps(t.targetId),--this.targetCount,Si.resolve()}removeTargets(n,r,i){let s=0;const a=[];return this.Cs.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.Cs.delete(e),a.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),Si.waitFor(a).next(()=>s)}getTargetCount(e){return Si.resolve(this.targetCount)}getTargetData(e,t){var n=this.Cs.get(t)||null;return Si.resolve(n)}addMatchingKeys(e,t,n){return this.Ns.ws(t,n),Si.resolve()}removeMatchingKeys(t,e,n){this.Ns.ys(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),Si.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ns.ps(t),Si.resolve()}getMatchingKeysForTargetId(e,t){var n=this.Ns.Ts(t);return Si.resolve(n)}containsKey(e,t){return Si.resolve(this.Ns.containsKey(t))}}class ah{constructor(e,t){this.Ms={},this.overlays={},this.Os=new Pi(0),this.$s=!1,this.$s=!0,this.referenceDelegate=e(this),this.Fs=new sh(this),this.indexManager=new dc,this.remoteDocumentCache=(e=e=>this.referenceDelegate.Bs(e),new rh(e)),this.serializer=new Ru(t),this.Ls=new Jc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.$s=!1,Promise.resolve()}get started(){return this.$s}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Zc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Ms[e.toKey()];return n||(n=new nh(t,this.referenceDelegate),this.Ms[e.toKey()]=n),n}getTargetCache(){return this.Fs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ls}runTransaction(e,t,n){qr("MemoryPersistence","Starting transaction:",e);const r=new oh(this.Os.next());return this.referenceDelegate.qs(),n(r).next(e=>this.referenceDelegate.Us(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ks(t,n){return Si.or(Object.values(this.Ms).map(e=>()=>e.containsKey(t,n)))}}class oh extends Ti{constructor(e){super(),this.currentSequenceNumber=e}}class uh{constructor(e){this.persistence=e,this.Gs=new eh,this.Qs=null}static js(e){return new uh(e)}get zs(){if(this.Qs)return this.Qs;throw Kr()}addReference(e,t,n){return this.Gs.addReference(n,t),this.zs.delete(n.toString()),Si.resolve()}removeReference(e,t,n){return this.Gs.removeReference(n,t),this.zs.add(n.toString()),Si.resolve()}markPotentiallyOrphaned(e,t){return this.zs.add(t.toString()),Si.resolve()}removeTarget(e,t){this.Gs.ps(t.targetId).forEach(e=>this.zs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.zs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}qs(){this.Qs=new Set}Us(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Si.forEach(this.zs,e=>{const t=di.fromPath(e);return this.Ws(n,t).next(e=>{e||r.removeEntry(t,oi.min())})}).next(()=>(this.Qs=null,r.apply(n)))}updateLimboDocument(e,t){return this.Ws(e,t).next(e=>{e?this.zs.delete(t.toString()):this.zs.add(t.toString())})}Bs(e){return 0}Ws(e,t){return Si.or([()=>Si.resolve(this.Gs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ks(e,t)])}}class ch{constructor(e){this.serializer=e}$(t,e,n,r){const i=new xi("createOrUpgrade",e);var s;n<1&&1<=r&&(t.createObjectStore("owner"),(s=t).createObjectStore("mutationQueues",{keyPath:"userId"}),s.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Gi,{unique:!0}),s.createObjectStore("documentMutations"),hh(t),t.createObjectStore("remoteDocuments"));let a=Si.resolve();return n<3&&3<=r&&(0!==n&&((s=t).deleteObjectStore("targetDocuments"),s.deleteObjectStore("targets"),s.deleteObjectStore("targetGlobal"),hh(t)),a=a.next(()=>function(){const e=i.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:oi.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",t)}())),n<4&&4<=r&&(0!==n&&(a=a.next(()=>function(r,i){return i.store("mutations").j().next(e=>{r.deleteObjectStore("mutations"),r.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Gi,{unique:!0});const t=i.store("mutations"),n=e.map(e=>t.put(e));return Si.waitFor(n)})}(t,i))),a=a.next(()=>{t.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&5<=r&&(a=a.next(()=>this.Js(i))),n<6&&6<=r&&(a=a.next(()=>(t.createObjectStore("remoteDocumentGlobal"),this.Ys(i)))),n<7&&7<=r&&(a=a.next(()=>this.Xs(i))),n<8&&8<=r&&(a=a.next(()=>this.Zs(t,i))),n<9&&9<=r&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&10<=r&&(a=a.next(()=>this.ti(i))),n<11&&11<=r&&(a=a.next(()=>{t.createObjectStore("bundles",{keyPath:"bundleId"}),t.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&12<=r&&(a=a.next(()=>{!function(){const e=t.createObjectStore("documentOverlays",{keyPath:ss});e.createIndex("collectionPathOverlayIndex",as,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",os,{unique:!1})}()})),n<13&&13<=r&&(a=a.next(()=>function(){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:Hi});e.createIndex("documentKeyIndex",Wi),e.createIndex("collectionGroupIndex",Xi)}()).next(()=>this.ei(t,i)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&14<=r&&(a=a.next(()=>this.ni(t,i))),n<15&&15<=r&&(a=a.next(()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:ts}).createIndex("sequenceNumberIndex",ns,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:rs}).createIndex("documentKeyIndex",is,{unique:!1})}(t))),a}Ys(t){let n=0;return t.store("remoteDocuments").X((e,t)=>{n+=_c(t)}).next(()=>{var e={byteSize:n};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",e)})}Js(r){const e=r.store("mutationQueues"),t=r.store("mutations");return e.j().next(e=>Si.forEach(e,n=>{var e=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return t.j("userMutationsIndex",e).next(e=>Si.forEach(e,e=>{Gr(e.userId===n.userId);var t=Pu(this.serializer,e);return Tc(r,n.userId,t).next(()=>{})}))}))}Xs(e){const a=e.store("targetDocuments"),t=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return t.X((e,t)=>{const n=new ci(e),r=[0,Ui(n)];s.push(a.get(r).next(e=>e?Si.resolve():(e=>a.put({targetId:0,path:Ui(e),sequenceNumber:i.highestListenSequenceNumber}))(n)))}).next(()=>Si.waitFor(s))})}Zs(e,t){e.createObjectStore("collectionParents",{keyPath:es});const n=t.store("collectionParents"),r=new fc,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Ui(r)})}};return t.store("remoteDocuments").X({Y:!0},(e,t)=>{const n=new ci(e);return i(n.popLast())}).next(()=>t.store("documentMutations").X({Y:!0},([,e],t)=>{const n=Ki(e);return i(n.popLast())}))}ti(e){const r=e.store("targets");return r.X((e,t)=>{var n=Vu(t),n=qu(this.serializer,n);return r.put(n)})}ei(e,s){const t=s.store("remoteDocuments"),a=[];return t.X((e,t)=>{const n=s.store("remoteDocumentsV14"),r=((i=t).document?new di(ci.fromString(i.document.name).popFirst(5)):i.noDocument?di.fromSegments(i.noDocument.path):i.unknownDocument?di.fromSegments(i.unknownDocument.path):Kr()).path.toArray();var i={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};a.push(n.put(i))}).next(()=>Si.waitFor(a))}ni(e,s){const t=s.store("mutations"),a=Kc(this.serializer),o=new ah(uh.js,this.serializer.le);return t.j().next(e=>{const r=new Map;return e.forEach(e=>{var t;let n=null!==(t=r.get(e.userId))&&void 0!==t?t:no();Pu(this.serializer,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),Si.forEach(r,(e,t)=>{var n=new Lr(t),r=Qu.fe(this.serializer,n),i=o.getIndexManager(n),n=Sc.fe(n,this.serializer,i,o.referenceDelegate);return new Yc(a,n,r,i).recalculateAndSaveOverlaysForDocumentKeys(new fs(s,Pi.ct),e).next()})})}}function hh(e){e.createObjectStore("targetDocuments",{keyPath:Ji}).createIndex("documentTargetsIndex",Zi,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Yi,{unique:!0}),e.createObjectStore("targetGlobal")}const lh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class dh{constructor(e,t,n,r,i,s,a,o,u,c,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.si=i,this.window=s,this.document=a,this.ii=u,this.ri=c,this.oi=h,this.Os=null,this.$s=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.ai=null,this.hi=Number.NEGATIVE_INFINITY,this.li=e=>Promise.resolve(),!dh.D())throw new $r(zr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new qc(this,r),this.fi=t+"main",this.serializer=new Ru(o),this.di=new Di(this.fi,this.oi,new ch(this.serializer)),this.Fs=new kc(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Kc(this.serializer),this.Ls=new Gu,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===c&&Br("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new $r(zr.FAILED_PRECONDITION,lh);return this.mi(),this.gi(),this.yi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Fs.getHighestSequenceNumber(e))}).then(e=>{this.Os=new Pi(e,this.ii)}).then(()=>{this.$s=!0}).catch(e=>(this.di&&this.di.close(),Promise.reject(e)))}pi(t){return this.li=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.di.B(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget(async()=>{this.started&&await this.wi()}))}wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>gh(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ii(t).next(e=>{e||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.li(!1)))})}).next(()=>this.Ti(t)).next(e=>this.isPrimary&&!e?this.Ei(t).next(()=>!1):!!e&&this.Ai(t).next(()=>!0))).catch(e=>{if(Ni(e))return qr("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return qr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.li(e)),this.isPrimary=e})}Ii(e){return fh(e).get("owner").next(e=>Si.resolve(this.Ri(e)))}vi(e){return gh(e).delete(this.clientId)}async Pi(){if(this.isPrimary&&!this.bi(this.hi,18e5)){this.hi=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=gs(e,"clientMetadata");return r.j().next(e=>{const t=this.Vi(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return Si.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this._i)for(const t of e)this._i.removeItem(this.Si(t.clientId))}}yi(){this.ai=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.wi().then(()=>this.Pi()).then(()=>this.yi()))}Ri(e){return!!e&&e.ownerId===this.clientId}Ti(t){return this.ri?Si.resolve(!0):fh(t).get("owner").next(e=>{if(null!==e&&this.bi(e.leaseTimestampMs,5e3)&&!this.Di(e.ownerId)){if(this.Ri(e)&&this.networkEnabled)return!0;if(!this.Ri(e)){if(!e.allowTabSynchronization)throw new $r(zr.FAILED_PRECONDITION,lh);return!1}}return!(!this.networkEnabled||!this.inForeground)||gh(t).j().next(e=>void 0===this.Vi(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&qr("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.$s=!1,this.Ci(),this.ai&&(this.ai.cancel(),this.ai=null),this.xi(),this.Ni(),await this.di.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new fs(e,Pi.ct);return this.Ei(t).next(()=>this.vi(t))}),this.di.close(),this.ki()}Vi(e,t){return e.filter(e=>this.bi(e.updateTimeMs,t)&&!this.Di(e.clientId))}Mi(){return this.runTransaction("getActiveClients","readonly",e=>gh(e).j().next(e=>this.Vi(e,18e5).map(e=>e.clientId)))}get started(){return this.$s}getMutationQueue(e,t){return Sc.fe(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Fs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new mc(e,this.serializer.le.databaseId)}getDocumentOverlayCache(e){return Qu.fe(this.serializer,e)}getBundleCache(){return this.Ls}runTransaction(t,n,r){qr("IndexedDbPersistence","Starting transaction:",t);var e,i="readonly"===n?"readonly":"readwrite",e=15===(e=this.oi)?ds:14===e?ls:13===e?hs:12===e?cs:11===e?us:void Kr();let s;return this.di.runTransaction(t,i,e,e=>(s=new fs(e,this.Os?this.Os.next():Pi.ct),"readwrite-primary"===n?this.Ii(s).next(e=>!!e||this.Ti(s)).next(e=>{if(!e)throw Br(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.li(!1)),new $r(zr.FAILED_PRECONDITION,Ei);return r(s)}).next(e=>this.Ai(s).next(()=>e)):this.Oi(s).next(()=>r(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}Oi(e){return fh(e).get("owner").next(e=>{if(null!==e&&this.bi(e.leaseTimestampMs,5e3)&&!this.Di(e.ownerId)&&!this.Ri(e)&&!(this.ri||this.allowTabSynchronization&&e.allowTabSynchronization))throw new $r(zr.FAILED_PRECONDITION,lh)})}Ai(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return fh(e).put("owner",t)}static D(){return Di.D()}Ei(e){const t=fh(e);return t.get("owner").next(e=>this.Ri(e)?(qr("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):Si.resolve())}bi(e,t){var n=Date.now();return!(e<n-t||n<e&&(Br(`Detected an update time that is in the future: ${e} > ${n}`),1))}mi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.wi()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground="visible"===this.document.visibilityState)}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ui=()=>{this.Ci();var e=/(?:Version|Mobile)\/1[456]/;h()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Ni(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Di(e){var t;try{var n=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Si(e)));return qr("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Br("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ci(){if(this._i)try{this._i.setItem(this.Si(this.clientId),String(Date.now()))}catch(e){Br("Failed to set zombie client id.",e)}}ki(){if(this._i)try{this._i.removeItem(this.Si(this.clientId))}catch(e){}}Si(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function fh(e){return gs(e,"owner")}function gh(e){return gs(e,"clientMetadata")}function mh(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class ph{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$i=n,this.Fi=r}static Bi(e,t){let n=no(),r=no();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new ph(e,t.fromCache,n,r)}}class yh{constructor(){this.Li=!1}initialize(e,t){this.qi=e,this.indexManager=t,this.Li=!0}getDocumentsMatchingQuery(t,n,r,i){return this.Ui(t,n).next(e=>e||this.Ki(t,n,i,r)).next(e=>e||this.Gi(t,n))}Ui(i,s){if(Fa(s))return Si.resolve(null);let t=qa(s);return this.indexManager.getIndexType(i,t).next(e=>0===e?null:(null!==s.limit&&1===e&&(s=Ua(s,null,"F"),t=qa(s)),this.indexManager.getDocumentsMatchingTarget(i,t).next(e=>{const r=no(...e);return this.qi.getDocuments(i,r).next(n=>this.indexManager.getMinOffset(i,t).next(e=>{var t=this.Qi(s,n);return this.ji(s,t,r,e.readTime)?this.Ui(i,Ua(s,null,"F")):this.zi(i,t,s,e)}))})))}Ki(n,r,i,s){return Fa(r)||s.isEqual(oi.min())?this.Gi(n,r):this.qi.getDocuments(n,i).next(e=>{var t=this.Qi(r,e);return this.ji(r,t,i,s)?this.Gi(n,r):(Vr()<=l.DEBUG&&qr("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ga(r)),this.zi(n,t,r,vi(s,-1)))})}Qi(n,e){let r=new Is(Qa(n));return e.forEach((e,t)=>{za(n,t)&&(r=r.add(t))}),r}ji(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Gi(e,t){return Vr()<=l.DEBUG&&qr("QueryEngine","Using full collection scan to execute query:",Ga(t)),this.qi.getDocumentsMatchingQuery(e,t,bi.min())}zi(e,n,t,r){return this.qi.getDocumentsMatchingQuery(e,t,r).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t))}}class vh{constructor(e,t,n,r){this.persistence=e,this.Wi=t,this.serializer=r,this.Hi=new vs(ri),this.Ji=new Ha(e=>Sa(e),xa),this.Yi=new Map,this.Xi=e.getRemoteDocumentCache(),this.Fs=e.getTargetCache(),this.Ls=e.getBundleCache(),this.Zi(n)}Zi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Yc(this.Xi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Xi.setIndexManager(this.indexManager),this.Wi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Hi))}}function wh(e,t,n,r){return new vh(e,t,n,r)}async function bh(e,t){const a=e;return a.persistence.runTransaction("Handle user change","readonly",i=>{let s;return a.mutationQueue.getAllMutationBatches(i).next(e=>(s=e,a.Zi(t),a.mutationQueue.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=no();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return a.localDocuments.getDocuments(i,r).next(e=>({tr:e,removedBatchIds:t,addedBatchIds:n}))})})}function Ih(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Fs.getLastRemoteSnapshotVersion(e))}function Eh(e,c){const h=e,l=c.snapshotVersion;let d=h.Hi;return h.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const e=h.Xi.newChangeBuffer({trackRemovals:!0});d=h.Hi;const u=[];c.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){u.push(h.Fs.removeMatchingKeys(o,t.removedDocuments,n).next(()=>h.Fs.addMatchingKeys(o,t.addedDocuments,n)));let e=r.withSequenceNumber(o.currentSequenceNumber);var i,s,a;null!==c.targetMismatches.get(n)?e=e.withResumeToken(xs.EMPTY_BYTE_STRING,oi.min()).withLastLimboFreeSnapshotVersion(oi.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,l)),d=d.insert(n,e),i=r,s=e,a=t,0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size)||u.push(h.Fs.updateTargetData(o,e))}});let t=Wa,n=no();if(c.documentUpdates.forEach(e=>{c.resolvedLimboDocuments.has(e)&&u.push(h.persistence.referenceDelegate.updateLimboDocument(o,e))}),u.push(Th(o,e,c.documentUpdates).next(e=>{t=e.er,n=e.nr})),!l.isEqual(oi.min())){const c=h.Fs.getLastRemoteSnapshotVersion(o).next(e=>h.Fs.setTargetsMetadata(o,o.currentSequenceNumber,l));u.push(c)}return Si.waitFor(u).next(()=>e.apply(o)).next(()=>h.localDocuments.getLocalViewOfDocuments(o,t,n)).next(()=>t)}).then(e=>(h.Hi=d,e))}function Th(e,s,t){let n=no(),a=no();return t.forEach(e=>n=n.add(e)),s.getEntries(e,n).next(r=>{let i=Wa;return t.forEach((e,t)=>{const n=r.get(e);t.isFoundDocument()!==n.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(oi.min())?(s.removeEntry(e,t.readTime),i=i.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(t),i=i.insert(e,t)):qr("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),{er:i,nr:a}})}function _h(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.Fs.getTargetData(t,r).next(e=>e?(n=e,Si.resolve(n)):i.Fs.allocateTargetId(t).next(e=>(n=new ku(r,e,"TargetPurposeListen",t.currentSequenceNumber),i.Fs.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.Hi.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.Hi=i.Hi.insert(e.targetId,e),i.Ji.set(r,e.targetId)),e})}async function Sh(e,t,n){const r=e,i=r.Hi.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!Ni(e))throw e;qr("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Hi=r.Hi.remove(t),r.Ji.delete(i.target)}function xh(e,n,r){const i=e;let s=oi.min(),a=no();return i.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,i=r.Ji.get(n);return void 0!==i?Si.resolve(r.Hi.get(i)):r.Fs.getTargetData(t,n)}(i,t,qa(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Fs.getMatchingKeysForTargetId(t,e.targetId).next(e=>{a=e})}).next(()=>i.Wi.getDocumentsMatchingQuery(t,n,r?s:oi.min(),r?a:no())).next(e=>(Ch(i,$a(n),e),{documents:e,sr:a})))}function Dh(e,t){const n=e,r=n.Fs,i=n.Hi.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.he(e,t).next(e=>e?e.target:null))}function Ah(e,t){const n=e,r=n.Yi.get(t)||oi.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.Xi.getAllFromCollectionGroup(e,t,vi(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(Ch(n,t,e),e))}function Ch(e,t,n){let r=e.Yi.get(t)||oi.min();n.forEach((e,t)=>{0<t.readTime.compareTo(r)&&(r=t.readTime)}),e.Yi.set(t,r)}function Nh(e,t){return`firestore_clients_${e}_${t}`}function kh(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Rh(e,t){return`firestore_targets_${e}_${t}`}class Mh{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static cr(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new $r(r.error.code,r.error.message))),s?new Mh(e,t,r.state,i):(Br("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ar(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Fh{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static cr(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new $r(n.error.code,n.error.message))),i?new Fh(e,n.state,r):(Br("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ar(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Lh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static cr(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ro;for(let s=0;r&&s<n.activeTargetIds.length;++s)r=Bi(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new Lh(e,i):(Br("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Oh{constructor(e,t){this.clientId=e,this.onlineState=t}static cr(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Oh(t.clientId,t.onlineState):(Br("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Ph{constructor(){this.activeTargetIds=ro}hr(e){this.activeTargetIds=this.activeTargetIds.add(e)}lr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ar(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Vh{constructor(e,t,n,r,i){this.window=e,this.si=t,this.persistenceKey=n,this.dr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this._r=this.wr.bind(this),this.mr=new vs(ri),this.started=!1,this.gr=[];var s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.yr=Nh(this.persistenceKey,this.dr),this.pr=`firestore_sequence_number_${this.persistenceKey}`,this.mr=this.mr.insert(this.dr,new Ph),this.Ir=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Tr=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Er=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.Ar=`firestore_online_state_${this.persistenceKey}`,this.Rr=`firestore_bundle_loaded_v2_${this.persistenceKey}`,this.window.addEventListener("storage",this._r)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Mi();for(const n of e)if(n!==this.dr){const e=this.getItem(Nh(this.persistenceKey,n));var t;!e||(t=Lh.cr(n,e))&&(this.mr=this.mr.insert(t.clientId,t))}this.vr();const n=this.storage.getItem(this.Ar);if(n){const e=this.Pr(n);e&&this.br(e)}for(const e of this.gr)this.wr(e);this.gr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.pr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Vr(this.mr)}isActiveQueryTarget(n){let r=!1;return this.mr.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.Sr(e,"pending")}updateMutationState(e,t,n){this.Sr(e,t,n),this.Dr(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(Rh(this.persistenceKey,e)))||(n=Fh.cr(e,n))&&(t=n.state)),this.Cr.hr(e),this.vr(),t}removeLocalQueryTarget(e){this.Cr.lr(e),this.vr()}isLocalQueryTarget(e){return this.Cr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Rh(this.persistenceKey,e))}updateQueryState(e,t,n){this.Nr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Dr(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.kr(e)}notifyBundleLoaded(e){this.Mr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this._r),this.removeItem(this.yr),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return qr("SharedClientState","READ",e,t),t}setItem(e,t){qr("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){qr("SharedClientState","REMOVE",e),this.storage.removeItem(e)}wr(e){const i=e;i.storageArea===this.storage&&(qr("SharedClientState","EVENT",i.key,i.newValue),i.key!==this.yr?this.si.enqueueRetryable(async()=>{if(this.started){if(null!==i.key)if(this.Ir.test(i.key)){if(null==i.newValue){var e=this.Or(i.key);return this.$r(e,null)}e=this.Fr(i.key,i.newValue);if(e)return this.$r(e.clientId,e)}else if(this.Tr.test(i.key)){if(null!==i.newValue){var t=this.Br(i.key,i.newValue);if(t)return this.Lr(t)}}else if(this.Er.test(i.key)){if(null!==i.newValue){t=this.qr(i.key,i.newValue);if(t)return this.Ur(t)}}else if(i.key===this.Ar){if(null!==i.newValue){var n=this.Pr(i.newValue);if(n)return this.br(n)}}else if(i.key===this.pr){n=function(e){let t=Pi.ct;if(null!=e)try{var n=JSON.parse(e);Gr("number"==typeof n),t=n}catch(e){Br("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(i.newValue);n!==Pi.ct&&this.sequenceNumberHandler(n)}else if(i.key===this.Rr){const r=this.Kr(i.newValue);await Promise.all(r.map(e=>this.syncEngine.Gr(e)))}}else this.gr.push(i)}):Br("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Cr(){return this.mr.get(this.dr)}vr(){this.setItem(this.yr,this.Cr.ar())}Sr(e,t,n){const r=new Mh(this.currentUser,e,t,n),i=kh(this.persistenceKey,this.currentUser,e);this.setItem(i,r.ar())}Dr(e){var t=kh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}kr(e){var t={clientId:this.dr,onlineState:e};this.storage.setItem(this.Ar,JSON.stringify(t))}Nr(e,t,n){const r=Rh(this.persistenceKey,e),i=new Fh(e,t,n);this.setItem(r,i.ar())}Mr(e){var t=JSON.stringify(Array.from(e));this.setItem(this.Rr,t)}Or(e){var t=this.Ir.exec(e);return t?t[1]:null}Fr(e,t){var n=this.Or(e);return Lh.cr(n,t)}Br(e,t){var n=this.Tr.exec(e),r=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Mh.cr(new Lr(n),r,t)}qr(e,t){var n=this.Er.exec(e),n=Number(n[1]);return Fh.cr(n,t)}Pr(e){return Oh.cr(e)}Kr(e){return JSON.parse(e)}async Lr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Qr(e.batchId,e.state,e.error);qr("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Ur(e){return this.syncEngine.jr(e.targetId,e.state,e.error)}$r(e,t){const n=t?this.mr.insert(e,t):this.mr.remove(e),r=this.Vr(this.mr),i=this.Vr(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.zr(s,a).then(()=>{this.mr=n})}br(e){this.mr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Vr(e){let n=ro;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class qh{constructor(){this.Wr=new Ph,this.Hr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Wr.hr(e),this.Hr[e]||"not-current"}updateQueryState(e,t,n){this.Hr[e]=t}removeLocalQueryTarget(e){this.Wr.lr(e)}isLocalQueryTarget(e){return this.Wr.activeTargetIds.has(e)}clearQueryState(e){delete this.Hr[e]}getAllActiveQueryTargets(){return this.Wr.activeTargetIds}isActiveQueryTarget(e){return this.Wr.activeTargetIds.has(e)}start(){return this.Wr=new Ph,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Bh{Jr(e){}shutdown(){}}class Uh{constructor(){this.Yr=()=>this.Xr(),this.Zr=()=>this.eo(),this.no=[],this.so()}Jr(e){this.no.push(e)}shutdown(){window.removeEventListener("online",this.Yr),window.removeEventListener("offline",this.Zr)}so(){window.addEventListener("online",this.Yr),window.addEventListener("offline",this.Zr)}Xr(){qr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.no)e(0)}eo(){qr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.no)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let jh=null;function Kh(){return null===jh?jh=268435456+Math.round(2147483648*Math.random()):jh++,"0x"+jh.toString(16)}const Gh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class zh{constructor(e){this.io=e.io,this.ro=e.ro}oo(e){this.uo=e}co(e){this.ao=e}onMessage(e){this.ho=e}close(){this.ro()}send(e){this.io(e)}lo(){this.uo()}fo(e){this.ao(e)}_o(e){this.ho(e)}}const $h="WebChannelConnection";class Qh extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.wo=t+"://"+e.host,this.mo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get yo(){return!1}po(t,e,n,r,i){const s=Kh(),a=this.Io(t,e);qr("RestConnection",`Sending RPC '${t}' ${s}:`,a,n);var o={};return this.To(o,r,i),this.Eo(t,a,o,n).then(e=>(qr("RestConnection",`Received RPC '${t}' ${s}: `,e),e),e=>{throw Ur("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",a,"request:",n),e})}Ao(e,t,n,r,i,s){return this.po(e,t,n,r,i)}To(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+Or,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}Io(e,t){var n=Gh[e];return`${this.wo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Eo(o,t,n,r){const u=Kh();return new Promise((i,s)=>{const a=new kr;a.setWithCredentials(!0),a.listenOnce(Sr.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case _r.NO_ERROR:var e=a.getResponseJson();qr($h,`XHR for RPC '${o}' ${u} received:`,JSON.stringify(e)),i(e);break;case _r.TIMEOUT:qr($h,`RPC '${o}' ${u} timed out`),s(new $r(zr.DEADLINE_EXCEEDED,"Request time out"));break;case _r.HTTP_ERROR:var t=a.getStatus();if(qr($h,`RPC '${o}' ${u} failed with status:`,t,"response text:",a.getResponseText()),0<t){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);var n=null==e?void 0:e.error;if(n&&n.status&&n.message){const o=(r=n.status.toLowerCase().replace(/_/g,"-"),0<=Object.values(zr).indexOf(r)?r:zr.UNKNOWN);s(new $r(o,n.message))}else s(new $r(zr.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new $r(zr.UNAVAILABLE,"Connection failed."));break;default:Kr()}}finally{qr($h,`RPC '${o}' ${u} completed.`)}var r});var e=JSON.stringify(r);qr($h,`RPC '${o}' ${u} sending request:`,r),a.send(t,"POST",e,n,15)})}Ro(i,e,t){const s=Kh(),n=[this.wo,"/","google.firestore.v1.Firestore","/",i,"/channel"],r=new Jn,a=Tr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Cr({})),this.To(o.initMessageHeaders,e,t),o.encodeInitMessageHeaders=!0;var u=n.join("");qr($h,`Creating RPC '${i}' stream ${s}: ${u}`,o);const c=r.createWebChannel(u,o);let h=!1,l=!1;const d=new zh({io:e=>{l?qr($h,`Not sending because RPC '${i}' stream ${s} is closed:`,e):(h||(qr($h,`Opening RPC '${i}' stream ${s} transport.`),c.open(),h=!0),qr($h,`RPC '${i}' stream ${s} sending:`,e),c.send(e))},ro:()=>c.close()}),f=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return f(c,Nr.EventType.OPEN,()=>{l||qr($h,`RPC '${i}' stream ${s} transport opened.`)}),f(c,Nr.EventType.CLOSE,()=>{l||(l=!0,qr($h,`RPC '${i}' stream ${s} transport closed`),d.fo())}),f(c,Nr.EventType.ERROR,e=>{l||(l=!0,Ur($h,`RPC '${i}' stream ${s} transport errored:`,e),d.fo(new $r(zr.UNAVAILABLE,"The operation could not be completed")))}),f(c,Nr.EventType.MESSAGE,n=>{if(!l){var e=n.data[0];Gr(!!e);var r=e.error||(null===(r=e[0])||void 0===r?void 0:r.error);if(r){qr($h,`RPC '${i}' stream ${s} received error:`,r);const n=r.status;let e=function(e){var t=Er[e];if(void 0!==t)return qo(t)}(n),t=r.message;void 0===e&&(e=zr.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),l=!0,d.fo(new $r(e,t)),c.close()}else qr($h,`RPC '${i}' stream ${s} received:`,e),d._o(e)}}),f(a,xr.STAT_EVENT,e=>{e.stat===Dr?qr($h,`RPC '${i}' stream ${s} detected buffering proxy`):e.stat===Ar&&qr($h,`RPC '${i}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{d.lo()},0),d}}function Hh(){return"undefined"!=typeof window?window:null}function Wh(){return"undefined"!=typeof document?document:null}function Xh(e){return new au(e,!0)}class Yh{constructor(e,t,n=1e3,r=1.5,i=6e4){this.si=e,this.timerId=t,this.vo=n,this.Po=r,this.bo=i,this.Vo=0,this.So=null,this.Do=Date.now(),this.reset()}reset(){this.Vo=0}Co(){this.Vo=this.bo}xo(e){this.cancel();var t=Math.floor(this.Vo+this.No()),n=Math.max(0,Date.now()-this.Do),r=Math.max(0,t-n);0<r&&qr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Vo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.So=this.si.enqueueAfterDelay(this.timerId,r,()=>(this.Do=Date.now(),e())),this.Vo*=this.Po,this.Vo<this.vo&&(this.Vo=this.vo),this.Vo>this.bo&&(this.Vo=this.bo)}ko(){null!==this.So&&(this.So.skipDelay(),this.So=null)}cancel(){null!==this.So&&(this.So.cancel(),this.So=null)}No(){return(Math.random()-.5)*this.Vo}}class Jh{constructor(e,t,n,r,i,s,a,o){this.si=e,this.Mo=n,this.Oo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.$o=0,this.Fo=null,this.Bo=null,this.stream=null,this.Lo=new Yh(e,t)}qo(){return 1===this.state||5===this.state||this.Uo()}Uo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Ko()}async stop(){this.qo()&&await this.close(0)}Go(){this.state=0,this.Lo.reset()}Qo(){this.Uo()&&null===this.Fo&&(this.Fo=this.si.enqueueAfterDelay(this.Mo,6e4,()=>this.jo()))}zo(e){this.Wo(),this.stream.send(e)}async jo(){if(this.Uo())return this.close(0)}Wo(){this.Fo&&(this.Fo.cancel(),this.Fo=null)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}async close(e,t){this.Wo(),this.Ho(),this.Lo.cancel(),this.$o++,4!==e?this.Lo.reset():t&&t.code===zr.RESOURCE_EXHAUSTED?(Br(t.toString()),Br("Using maximum backoff delay to prevent overloading the backend."),this.Lo.Co()):t&&t.code===zr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Jo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.co(t)}Jo(){}auth(){this.state=1;const e=this.Yo(this.$o),n=this.$o;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.$o===n&&this.Xo(e,t)},t=>{e(()=>{var e=new $r(zr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Zo(e)})})}Xo(e,t){const n=this.Yo(this.$o);this.stream=this.tu(e,t),this.stream.oo(()=>{n(()=>(this.state=2,this.Bo=this.si.enqueueAfterDelay(this.Oo,1e4,()=>(this.Uo()&&(this.state=3),Promise.resolve())),this.listener.oo()))}),this.stream.co(e=>{n(()=>this.Zo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Ko(){this.state=5,this.Lo.xo(async()=>{this.state=0,this.start()})}Zo(e){return qr("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Yo(t){return e=>{this.si.enqueueAndForget(()=>this.$o===t?e():(qr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Zh extends Jh{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}tu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.Lo.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(f=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:Kr(),i=t.targetChange.targetIds||[],s=(f=t.targetChange.resumeToken,e.useProto3Json?(Gr(void 0===f||"string"==typeof f),xs.fromBase64String(f||"")):(Gr(void 0===f||f instanceof Uint8Array),xs.fromUint8Array(f||new Uint8Array))),a=t.targetChange.cause,o=a&&(o=void 0===(f=a).code?zr.UNKNOWN:qo(f.code),new $r(o,f.message||""));n=new Jo(r,i,s,o||null)}else if("documentChange"in t){t.documentChange;var u=t.documentChange;u.document,u.document.name,u.document.updateTime;var s=gu(e,u.document.name),o=hu(u.document.updateTime),c=u.document.createTime?hu(u.document.createTime):oi.min(),h=new ea({mapValue:{fields:u.document.fields}}),c=ta.newFoundDocument(s,o,c,h),h=u.targetIds||[],u=u.removedTargetIds||[];n=new Xo(h,u,c.key,c)}else if("documentDelete"in t){t.documentDelete;h=t.documentDelete;h.document;u=gu(e,h.document),c=h.readTime?hu(h.readTime):oi.min(),c=ta.newNoDocument(u,c),h=h.removedTargetIds||[];n=new Xo([],h,c.key,c)}else if("documentRemove"in t){t.documentRemove;var l=t.documentRemove;l.document;var d=gu(e,l.document),l=l.removedTargetIds||[];n=new Xo([],l,d,null)}else{if(!("filter"in t))return Kr();{t.filter;const e=t.filter;e.targetId;var{count:l=0,unchangedNames:d}=e,l=new Po(l,d),d=e.targetId;n=new Yo(d,l)}}var o,f;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return oi.min();var t=e.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?hu(t.readTime):oi.min()}(e);return this.listener.eu(t,n)}nu(e){const t={};t.database=yu(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Da(r)?{documents:Tu(e,r)}:{query:_u(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()){n.resumeToken=cu(e,t.resumeToken);const r=ou(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(0<t.snapshotVersion.compareTo(oi.min())){n.readTime=uu(e,t.snapshotVersion.toTimestamp());const r=ou(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);var n,r,r=(this.serializer,n=e,null==(r=function(){switch(n.purpose){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Kr()}}())?null:{"goog-listen-tags":r});r&&(t.labels=r),this.zo(t)}su(e){const t={};t.database=yu(this.serializer),t.removeTarget=e,this.zo(t)}}class el extends Jh{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.iu=!1}get ru(){return this.iu}start(){this.iu=!1,this.lastStreamToken=void 0,super.start()}Jo(){this.iu&&this.ou([])}tu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(Gr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.iu){this.Lo.reset();var t=(r=e.writeResults,i=e.commitTime,r&&0<r.length?(Gr(void 0!==i),r.map(e=>function(e,t){let n=e.updateTime?hu(e.updateTime):hu(t);return n.isEqual(oi.min())&&(n=hu(t)),new wo(n,e.transformResults||[])}(e,i))):[]),n=hu(e.commitTime);return this.listener.uu(n,t)}var r,i;return Gr(!e.writeResults||0===e.writeResults.length),this.iu=!0,this.listener.cu()}au(){const e={};e.database=yu(this.serializer),this.zo(e)}ou(e){var t={streamToken:this.lastStreamToken,writes:e.map(e=>Iu(this.serializer,e))};this.zo(t)}}class tl extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.hu=!1}lu(){if(this.hu)throw new $r(zr.FAILED_PRECONDITION,"The client has already been terminated.")}po(n,r,i){return this.lu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.po(n,r,i,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===zr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new $r(zr.UNKNOWN,e.toString())})}Ao(n,r,i,s){return this.lu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.Ao(n,r,i,e,t,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===zr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new $r(zr.UNKNOWN,e.toString())})}terminate(){this.hu=!0}}class nl{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.du=0,this._u=null,this.wu=!0}mu(){0===this.du&&(this.gu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.yu("Backend didn't respond within 10 seconds."),this.gu("Offline"),Promise.resolve())))}pu(e){"Online"===this.state?this.gu("Unknown"):(this.du++,1<=this.du&&(this.Iu(),this.yu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.gu("Offline")))}set(e){this.Iu(),this.du=0,"Online"===e&&(this.wu=!1),this.gu(e)}gu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}yu(e){var t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.wu?(Br(t),this.wu=!1):qr("OnlineStateTracker",t)}Iu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class rl{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Tu=[],this.Eu=new Map,this.Au=new Set,this.Ru=[],this.vu=i,this.vu.Jr(e=>{n.enqueueAndForget(async()=>{dl(this)&&(qr("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.Au.add(4),await sl(t),t.Pu.set("Unknown"),t.Au.delete(4),await il(t)}(this))})}),this.Pu=new nl(n,r)}}async function il(e){if(dl(e))for(const t of e.Ru)await t(!0)}async function sl(e){for(const t of e.Ru)await t(!1)}function al(e,t){const n=e;n.Eu.has(t.targetId)||(n.Eu.set(t.targetId,t),ll(n)?hl(n):Il(n).Uo()&&ul(n,t))}function ol(e,t){const n=e,r=Il(n);n.Eu.delete(t),r.Uo()&&cl(n,t),0===n.Eu.size&&(r.Uo()?r.Qo():dl(n)&&n.Pu.set("Unknown"))}function ul(e,t){var n;e.bu.Lt(t.targetId),(0<t.resumeToken.approximateByteSize()||0<t.snapshotVersion.compareTo(oi.min()))&&(n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size,t=t.withExpectedCount(n)),Il(e).nu(t)}function cl(e,t){e.bu.Lt(t),Il(e).su(t)}function hl(t){t.bu=new eu({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),he:e=>t.Eu.get(e)||null,oe:()=>t.datastore.serializer.databaseId}),Il(t).start(),t.Pu.mu()}function ll(e){return dl(e)&&!Il(e).qo()&&0<e.Eu.size}function dl(e){return 0===e.Au.size}function fl(e){e.bu=void 0}async function gl(e,t,n){if(!Ni(t))throw t;e.Au.add(1),await sl(e),e.Pu.set("Offline"),n=n||(()=>Ih(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{qr("RemoteStore","Retrying IndexedDB access"),await n(),e.Au.delete(1),await il(e)})}function ml(t,n){return n().catch(e=>gl(t,e,n))}async function pl(e){const t=e,n=El(t);let r=0<t.Tu.length?t.Tu[t.Tu.length-1].batchId:-1;for(;dl(i=t)&&i.Tu.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.Tu.length&&n.Qo();break}r=e.batchId,function(e,t){e.Tu.push(t);const n=El(e);n.Uo()&&n.ru&&n.ou(t.mutations)}(t,e)}catch(e){await gl(t,e)}var i;yl(t)&&vl(t)}function yl(e){return dl(e)&&!El(e).qo()&&0<e.Tu.length}function vl(e){El(e).start()}async function wl(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),qr("RemoteStore","RemoteStore received new credentials");var r=dl(n);n.Au.add(3),await sl(n),r&&n.Pu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Au.delete(3),await il(n)}async function bl(e,t){const n=e;t?(n.Au.delete(2),await il(n)):(n.Au.add(2),await sl(n),n.Pu.set("Unknown"))}function Il(t){return t.Vu||(t.Vu=function(e,t,n){const r=e;return r.lu(),new Zh(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{oo:(async function(n){n.Eu.forEach((e,t)=>{ul(n,e)})}).bind(null,t),co:(async function(e,t){fl(e),ll(e)?(e.Pu.pu(t),hl(e)):e.Pu.set("Unknown")}).bind(null,t),eu:(async function(e,r,t){if(e.Pu.set("Online"),r instanceof Jo&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.Eu.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.Eu.delete(n),e.bu.removeTarget(n))}(e)}catch(t){qr("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await gl(e,t)}else if(r instanceof Xo?e.bu.Wt(r):r instanceof Yo?e.bu.ee(r):e.bu.Yt(r),!t.isEqual(oi.min()))try{const r=await Ih(e.localStore);0<=t.compareTo(r)&&await function(i,r){const e=i.bu.ue(r);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=i.Eu.get(t);n&&i.Eu.set(t,n.withResumeToken(e.resumeToken,r))}}),e.targetMismatches.forEach((e,t)=>{const n=i.Eu.get(e);var r;n&&(i.Eu.set(e,n.withResumeToken(xs.EMPTY_BYTE_STRING,n.snapshotVersion)),cl(i,e),r=new ku(n.target,e,t,n.sequenceNumber),ul(i,r))}),i.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){qr("RemoteStore","Failed to raise snapshot:",r),await gl(e,r)}}).bind(null,t)}),t.Ru.push(async e=>{e?(t.Vu.Go(),ll(t)?hl(t):t.Pu.set("Unknown")):(await t.Vu.stop(),fl(t))})),t.Vu}function El(t){return t.Su||(t.Su=function(e,t,n){const r=e;return r.lu(),new el(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{oo:(async function(e){El(e).au()}).bind(null,t),co:(async function(e,t){t&&El(e).ru&&await async function(e,t){if(Vo(n=t.code)&&n!==zr.ABORTED){const n=e.Tu.shift();El(e).Go(),await ml(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await pl(e)}var n}(e,t),yl(e)&&vl(e)}).bind(null,t),cu:(async function(e){const t=El(e);for(const n of e.Tu)t.ou(n.mutations)}).bind(null,t),uu:(async function(e,t,n){const r=e.Tu.shift(),i=Lo.from(r,t,n);await ml(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await pl(e)}).bind(null,t)}),t.Ru.push(async e=>{e?(t.Su.Go(),await pl(t)):(await t.Su.stop(),0<t.Tu.length&&(qr("RemoteStore",`Stopping write stream with ${t.Tu.length} pending writes`),t.Tu=[]))})),t.Su}class Tl{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Qr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,a=new Tl(e,t,s,r,i);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new $r(zr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function _l(e,t){if(Br("AsyncQueue",`${t}: ${e}`),Ni(e))return new $r(zr.UNAVAILABLE,`${t}: ${e}`);throw e}class Sl{constructor(n){this.comparator=n?(e,t)=>n(e,t)||di.comparator(e.key,t.key):(e,t)=>di.comparator(e.key,t.key),this.keyedMap=Ya(),this.sortedSet=new vs(this.comparator)}static emptySet(e){return new Sl(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Sl))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new Sl;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class xl{constructor(){this.Du=new vs(di.comparator)}track(e){var t=e.doc.key,n=this.Du.get(t);!n||0!==e.type&&3===n.type?this.Du=this.Du.insert(t,e):3===e.type&&1!==n.type?this.Du=this.Du.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Du=this.Du.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Du=this.Du.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Du=this.Du.remove(t):1===e.type&&2===n.type?this.Du=this.Du.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Du=this.Du.insert(t,{type:2,doc:e.doc}):Kr()}Cu(){const n=[];return this.Du.inorderTraversal((e,t)=>{n.push(t)}),n}}class Dl{constructor(e,t,n,r,i,s,a,o,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new Dl(e,t,Sl.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ja(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Al{constructor(){this.xu=void 0,this.listeners=[]}}class Cl{constructor(){this.queries=new Ha(e=>Ka(e),ja),this.onlineState="Unknown",this.Nu=new Set}}async function Nl(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Al),i)try{s.xu=await n.onListen(r)}catch(e){const n=_l(e,`Initialization of query '${Ga(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.ku(n.onlineState),!s.xu||t.Mu(s.xu)&&Rl(n)}async function kl(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Rl(e){e.Nu.forEach(e=>{e.next()})}class Ml{constructor(e,t,n){this.query=e,this.Ou=t,this.$u=!1,this.Fu=null,this.onlineState="Unknown",this.options=n||{}}Mu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Dl(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.$u?this.Bu(e)&&(this.Ou.next(e),t=!0):this.Lu(e,this.onlineState)&&(this.qu(e),t=!0),this.Fu=e,t}onError(e){this.Ou.error(e)}ku(e){this.onlineState=e;let t=!1;return this.Fu&&!this.$u&&this.Lu(this.Fu,e)&&(this.qu(this.Fu),t=!0),t}Lu(e,t){return!e.fromCache||(!this.options.Uu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Bu(e){if(0<e.docChanges.length)return!0;var t=this.Fu&&this.Fu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}qu(e){e=Dl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.$u=!0,this.Ou.next(e)}}class Fl{constructor(e,t){this.Ku=e,this.byteLength=t}Gu(){return"metadata"in this.Ku}}class Ll{constructor(e){this.serializer=e}ir(e){return gu(this.serializer,e)}rr(e){return e.metadata.exists?bu(this.serializer,e.document,!1):ta.newNoDocument(this.ir(e.metadata.name),this.ur(e.metadata.readTime))}ur(e){return hu(e)}}class Ol{constructor(e,t,n){this.Qu=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Pl(e)}ju(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Ku.namedQuery)this.queries.push(e.Ku.namedQuery);else if(e.Ku.documentMetadata){this.documents.push({metadata:e.Ku.documentMetadata}),e.Ku.documentMetadata.exists||++t;const n=ci.fromString(e.Ku.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Ku.document&&(this.documents[this.documents.length-1].document=e.Ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}zu(e){const t=new Map,n=new Ll(this.serializer);for(const i of e)if(i.metadata.queries){const e=n.ir(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||no()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=no(),a=Wa;for(const e of n){const n=t.ir(e.metadata.name);e.document&&(s=s.add(n));const c=t.rr(e);c.setReadTime(t.ur(e.metadata.readTime)),a=a.insert(n,c)}const o=i.Xi.newChangeBuffer({trackRemovals:!0}),u=await _h(i,(r=r,qa(Ma(ci.fromString(`__bundle__/docs/${r}`)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>Th(t,o,a).next(e=>(o.apply(t),e)).next(e=>i.Fs.removeMatchingKeysForTargetId(t,u.targetId).next(()=>i.Fs.addMatchingKeys(t,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(t,e.er,e.nr)).next(()=>e.er)))}(this.localStore,new Ll(this.serializer),this.documents,this.Qu.id),t=this.zu(this.documents);for(const e of this.queries)await async function(e,n,r=no()){const i=await _h(e,qa(Bu(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=hu(n.readTime);if(0<=i.snapshotVersion.compareTo(t))return s.Ls.saveNamedQuery(e,n);t=i.withResumeToken(xs.EMPTY_BYTE_STRING,t);return s.Hi=s.Hi.insert(t.targetId,t),s.Fs.updateTargetData(e,t).next(()=>s.Fs.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.Fs.addMatchingKeys(e,r,i.targetId)).next(()=>s.Ls.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Wu:this.collectionGroups,Hu:e}}}function Pl(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Vl{constructor(e){this.key=e}}class ql{constructor(e){this.key=e}}class Bl{constructor(e,t){this.query=e,this.Ju=t,this.Yu=null,this.hasCachedResults=!1,this.current=!1,this.Xu=no(),this.mutatedKeys=no(),this.Zu=Qa(e),this.tc=new Sl(this.Zu)}get ec(){return this.Ju}nc(e,t){const o=t?t.sc:new xl,u=(t||this).tc;let c=(t||this).mutatedKeys,h=u,l=!1;const d="F"===this.query.limitType&&u.size===this.query.limit?u.last():null,f="L"===this.query.limitType&&u.size===this.query.limit?u.first():null;if(e.inorderTraversal((e,t)=>{const n=u.get(e),r=za(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let a=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(o.track({type:3,doc:r}),a=!0):this.ic(n,r)||(o.track({type:2,doc:r}),a=!0,(d&&0<this.Zu(r,d)||f&&this.Zu(r,f)<0)&&(l=!0)):!n&&r?(o.track({type:0,doc:r}),a=!0):n&&!r&&(o.track({type:1,doc:n}),a=!0,(d||f)&&(l=!0)),a&&(c=r?(h=h.add(r),s?c.add(e):c.delete(e)):(h=h.delete(e),c.delete(e)))}),null!==this.query.limit)for(;h.size>this.query.limit;){const e="F"===this.query.limitType?h.last():h.first();h=h.delete(e.key),c=c.delete(e.key),o.track({type:1,doc:e})}return{tc:h,sc:o,ji:l,mutatedKeys:c}}ic(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.tc;this.tc=e.tc,this.mutatedKeys=e.mutatedKeys;const i=e.sc.Cu();i.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Kr()}};return n(e)-n(t)}(e.type,t.type)||this.Zu(e.doc,t.doc)),this.rc(n);var s=t?this.oc():[],a=0===this.Xu.size&&this.current?1:0,o=a!==this.Yu;return this.Yu=a,0!==i.length||o?{snapshot:new Dl(this.query,e.tc,r,i,e.mutatedKeys,0==a,o,!1,!!n&&0<n.resumeToken.approximateByteSize()),uc:s}:{uc:s}}ku(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tc:this.tc,sc:new xl,mutatedKeys:this.mutatedKeys,ji:!1},!1)):{uc:[]}}cc(e){return!this.Ju.has(e)&&!!this.tc.has(e)&&!this.tc.get(e).hasLocalMutations}rc(e){e&&(e.addedDocuments.forEach(e=>this.Ju=this.Ju.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ju=this.Ju.delete(e)),this.current=e.current)}oc(){if(!this.current)return[];const t=this.Xu;this.Xu=no(),this.tc.forEach(e=>{this.cc(e.key)&&(this.Xu=this.Xu.add(e.key))});const n=[];return t.forEach(e=>{this.Xu.has(e)||n.push(new ql(e))}),this.Xu.forEach(e=>{t.has(e)||n.push(new Vl(e))}),n}ac(e){this.Ju=e.sr,this.Xu=no();var t=this.nc(e.documents);return this.applyChanges(t,!0)}hc(){return Dl.fromInitialDocuments(this.query,this.tc,this.mutatedKeys,0===this.Yu,this.hasCachedResults)}}class Ul{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class jl{constructor(e){this.key=e,this.lc=!1}}class Kl{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.fc={},this.dc=new Ha(e=>Ka(e),ja),this._c=new Map,this.wc=new Set,this.mc=new vs(di.comparator),this.gc=new Map,this.yc=new eh,this.Ic={},this.Tc=new Map,this.Ec=Nc.kn(),this.onlineState="Unknown",this.Ac=void 0}get isPrimaryClient(){return!0===this.Ac}}async function Gl(n,e,t,r,i){n.Rc=(e,s,t)=>async function(e,t,n){let r=t.view.nc(s);r.ji&&(r=await xh(e.localStore,t.query,!1).then(({documents:e})=>t.view.nc(e,r)));var i=n&&n.targetChanges.get(t.targetId),i=t.view.applyChanges(r,e.isPrimaryClient,i);return Zl(e,t.targetId,i.uc),i.snapshot}(n,e,t);const s=await xh(n.localStore,e,!0),a=new Bl(e,s.sr),o=a.nc(s.documents),u=Wo.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),c=a.applyChanges(o,n.isPrimaryClient,u);Zl(n,t,c.uc);var h=new Ul(e,t,a);return n.dc.set(e,h),n._c.has(t)?n._c.get(t).push(e):n._c.set(t,[e]),c.snapshot}async function zl(e,t,n){const r=ad(e);try{const e=await function(e,i){const s=e,a=ai.now(),o=i.reduce((e,t)=>e.add(t.key),no());let u,c;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=Wa,r=no();return s.Xi.getEntries(n,o).next(e=>{t=e,t.forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(n,t)).next(e=>{u=e;const t=[];for(const n of i){const i=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=uo(r.transform,e||null);null!=i&&(null===n&&(n=ea.empty()),n.set(r.field,i))}return n||null}(n,u.get(n.key).overlayedDocument);null!=i&&t.push(new Ao(n.key,i,function r(e){const i=[];return ps(e.fields,(e,t)=>{const n=new li([e]);if(Ws(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new _s(i)}(i.value.mapValue),bo.exists(!0)))}return s.mutationQueue.addMutationBatch(n,a,t,i)}).next(e=>{var t=(c=e).applyToLocalDocumentSet(u,r);return s.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:c.batchId,changes:Ja(u)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ic[e.currentUser.toKey()];r=r||new vs(ri),r=r.insert(t,n),e.Ic[e.currentUser.toKey()]=r}(r,e.batchId,n),await td(r,e.changes),await pl(r.remoteStore)}catch(e){const t=_l(e,"Failed to persist write");n.reject(t)}}async function $l(e,t){const r=e;try{const e=await Eh(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.gc.get(t);n&&(Gr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.lc=!0:0<e.modifiedDocuments.size?Gr(n.lc):0<e.removedDocuments.size&&(Gr(n.lc),n.lc=!1))}),await td(r,e,t)}catch(e){await _i(e)}}function Ql(r,i,e){const t=r;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const r=[];t.dc.forEach((e,t)=>{var n=t.view.ku(i);n.snapshot&&r.push(n.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.ku(n)&&(r=!0)}),r&&Rl(t)}(t.eventManager,i),r.length&&t.fc.eu(r),t.onlineState=i,t.isPrimaryClient&&t.sharedClientState.setOnlineState(i)}}async function Hl(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.Xi.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let a=Si.resolve();return n.forEach(n=>{a=a.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);Gr(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),i.addEntry(e)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,t,r.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=no();for(let n=0;n<e.mutationResults.length;++n)0<e.mutationResults[n].transformResults.length&&(t=t.add(e.batch.mutations[n].key));return t}(r))).next(()=>i.localDocuments.getDocuments(e,t))})}(n.localStore,t);Xl(n,r,null),Wl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await td(n,e)}catch(e){await _i(e)}}function Wl(e,t){(e.Tc.get(t)||[]).forEach(e=>{e.resolve()}),e.Tc.delete(t)}function Xl(e,t,n){const r=e;let i=r.Ic[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ic[r.currentUser.toKey()]=i}}function Yl(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t._c.get(e))t.dc.delete(r),n&&t.fc.vc(r,n);t._c.delete(e),t.isPrimaryClient&&t.yc.ps(e).forEach(e=>{t.yc.containsKey(e)||Jl(t,e)})}function Jl(e,t){e.wc.delete(t.path.canonicalString());var n=e.mc.get(t);null!==n&&(ol(e.remoteStore,n),e.mc=e.mc.remove(t),e.gc.delete(n),ed(e))}function Zl(e,t,n){for(const r of n)r instanceof Vl?(e.yc.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.mc.get(n)||e.wc.has(r)||(qr("SyncEngine","New document in limbo: "+n),e.wc.add(r),ed(e))}(e,r)):r instanceof ql?(qr("SyncEngine","Document no longer in limbo: "+r.key),e.yc.removeReference(r.key,t),e.yc.containsKey(r.key)||Jl(e,r.key)):Kr()}function ed(e){for(;0<e.wc.size&&e.mc.size<e.maxConcurrentLimboResolutions;){var t=e.wc.values().next().value;e.wc.delete(t);var n=new di(ci.fromString(t)),t=e.Ec.next();e.gc.set(t,new jl(n)),e.mc=e.mc.insert(n,t),al(e.remoteStore,new ku(qa(Ma(n.path)),t,"TargetPurposeLimboResolution",Pi.ct))}}async function td(e,t,r){const i=e,s=[],a=[],o=[];i.dc.isEmpty()||(i.dc.forEach((e,n)=>{o.push(i.Rc(n,t,r).then(e=>{var t;(e||r)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(n.targetId,null!=e&&e.fromCache?"not-current":"current"),e&&(s.push(e),t=ph.Bi(n.targetId,e),a.push(t))}))}),await Promise.all(o),i.fc.eu(s),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>Si.forEach(t,t=>Si.forEach(t.$i,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>Si.forEach(t.Fi,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!Ni(e))throw e;qr("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Hi.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.Hi=r.Hi.insert(t,i)}}}(i.localStore,a))}async function nd(r,e){const i=r;if(sd(i),ad(i),!0===e&&!0!==i.Ac){const r=i.sharedClientState.getAllActiveQueryTargets(),e=await rd(i,r.toArray());i.Ac=!0,await bl(i.remoteStore,!0);for(const r of e)al(i.remoteStore,r)}else if(!1===e&&!1!==i.Ac){const r=[];let n=Promise.resolve();i._c.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(Yl(i,t),Sh(i.localStore,t,!0))),ol(i.remoteStore,t)}),await n,await rd(i,r),function(){const n=i;n.gc.forEach((e,t)=>{ol(n.remoteStore,t)}),n.yc.Is(),n.gc=new Map,n.mc=new vs(di.comparator)}(),i.Ac=!1,await bl(i.remoteStore,!1)}}async function rd(t,n){const r=t,i=[],s=[];for(const t of n){let e;const h=r._c.get(t);if(h&&0!==h.length){e=await _h(r.localStore,qa(h[0]));for(const t of h){const n=r.dc.get(t),h=(a=r,o=n,c=u=void 0,c=await xh((u=a).localStore,o.query,!0),c=o.view.ac(c),u.isPrimaryClient&&Zl(u,o.targetId,c.uc),await c);h.snapshot&&s.push(h.snapshot)}}else{const h=await Dh(r.localStore,t);e=await _h(r.localStore,h),await Gl(r,id(h),t,!1,e.resumeToken)}i.push(e)}var a,o,u,c;return r.fc.eu(s),i}function id(e){return Ra(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function sd(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=$l.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=(function(e,t){const n=e,r=n.gc.get(t);if(r&&r.lc)return no().add(r.key);{let e=no();const r=n._c.get(t);if(!r)return e;for(const t of r){const r=n.dc.get(t);e=e.unionWith(r.view.ec)}return e}}).bind(null,t),t.remoteStore.remoteSyncer.rejectListen=(async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.gc.get(t),s=i&&i.key;if(s){let e=new vs(di.comparator);e=e.insert(s,ta.newNoDocument(s,oi.min()));const n=no().add(s),i=new Ho(oi.min(),new Map,new vs(ri),e,n);await $l(r,i),r.mc=r.mc.remove(s),r.gc.delete(t),ed(r)}else await Sh(r.localStore,t,!1).then(()=>Yl(r,t,n)).catch(_i)}).bind(null,t),t.fc.eu=(function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Mu(e)&&(r=!0);i.xu=e}}r&&Rl(n)}).bind(null,t.eventManager),t.fc.vc=(function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}).bind(null,t.eventManager),t}function ad(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=Hl.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=(async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i.mutationQueue.lookupMutationBatch(t,r).next(e=>(Gr(null!==e),n=e.keys(),i.mutationQueue.removeMutationBatch(t,e))).next(()=>i.mutationQueue.performConsistencyCheck(t)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(t,n,r)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,n)).next(()=>i.localDocuments.getDocuments(t,n))})}(r.localStore,t);Xl(r,t,n),Wl(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await td(r,e)}catch(n){await _i(n)}}).bind(null,t),t}class od{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Xh(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return wh(this.persistence,new yh,e.initialUser,this.serializer)}createPersistence(e){return new ah(uh.js,this.serializer)}createSharedClientState(e){return new qh}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class ud extends od{constructor(e,t,n){super(),this.bc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.bc.initialize(this,e),await ad(this.bc.syncEngine),await pl(this.bc.remoteStore),await this.persistence.pi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return wh(this.persistence,new yh,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new Pc(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){var n=new Oi(t,this.persistence);return new Li(e.asyncQueue,n)}createPersistence(e){var t=mh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ec.withCacheSize(this.cacheSizeBytes):Ec.DEFAULT;return new dh(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Hh(),Wh(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new qh}}class cd extends ud{constructor(e,t){super(e,t,!1),this.bc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.bc.syncEngine;this.sharedClientState instanceof Vh&&(this.sharedClientState.syncEngine={Qr:(async function(e,t,n,r){var i=e,s=await function(e,n){const r=e,i=r.mutationQueue;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.Vn(t,n).next(e=>e?r.localDocuments.getDocuments(t,e):Si.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await pl(i.remoteStore):"acknowledged"===n||"rejected"===n?(Xl(i,t,r||null),Wl(i,t),i.localStore.mutationQueue.Dn(t)):Kr(),await td(i,s)):qr("SyncEngine","Cannot apply mutation batch with id: "+t)}).bind(null,t),jr:(async function(e,t,n,r){const i=e;if(i.Ac)qr("SyncEngine","Ignoring unexpected query state notification.");else{var s=i._c.get(t);if(s&&0<s.length)switch(n){case"current":case"not-current":{const e=await Ah(i.localStore,$a(s[0])),r=Ho.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,xs.EMPTY_BYTE_STRING);await td(i,e,r);break}case"rejected":await Sh(i.localStore,t,!0),Yl(i,t,r);break;default:Kr()}}}).bind(null,t),zr:(async function(e,t,n){const r=sd(e);if(r.Ac){for(const e of t)if(r._c.has(e))qr("SyncEngine","Adding an already active target "+e);else{const t=await Dh(r.localStore,e),n=await _h(r.localStore,t);await Gl(r,id(t),n.targetId,!1,n.resumeToken),al(r.remoteStore,n)}for(const e of n)r._c.has(e)&&await Sh(r.localStore,e,!1).then(()=>{ol(r.remoteStore,e),Yl(r,e)}).catch(_i)}}).bind(null,t),Mi:(function(e){return e.localStore.persistence.Mi()}).bind(null,t),Gr:(async function(e,t){const n=e;return Ah(n.localStore,t).then(e=>td(n,e))}).bind(null,t)},await this.sharedClientState.start()),await this.persistence.pi(async e=>{await nd(this.bc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){var t=Hh();if(!Vh.D(t))throw new $r(zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=mh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Vh(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class hd{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Ql(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=(async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){qr("SyncEngine","User change. New user:",t.toKey());const r=await bh(n.localStore,t);n.currentUser=t,(e=n).Tc.forEach(e=>{e.forEach(e=>{e.reject(new $r(zr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Tc.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await td(n,r.tr)}}).bind(null,this.syncEngine),await bl(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Cl}createDatastore(e){var t,n,r,i,s=Xh(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new Qh(t));return n=e.authCredentials,r=e.appCheckCredentials,i=t,e=s,new tl(n,r,i,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Ql(this.syncEngine,e,0),s=new(Uh.D()?Uh:Bh),new rl(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){const o=new Kl(e,t,n,r,i,s);return a&&(o.Ac=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;qr("RemoteStore","RemoteStore shutting down."),t.Au.add(5),await sl(t),t.vu.shutdown(),t.Pu.set("Unknown")}(this.remoteStore)}}function ld(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class dd{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Vc(this.observer.next,e)}error(e){this.observer.error?this.Vc(this.observer.error,e):Br("Uncaught Error in snapshot listener:",e.toString())}Sc(){this.muted=!0}Vc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class fd{constructor(e,t){this.Dc=e,this.serializer=t,this.metadata=new Qr,this.buffer=new Uint8Array,this.Cc=new TextDecoder("utf-8"),this.xc().then(e=>{e&&e.Gu()?this.metadata.resolve(e.Ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.Ku)}`))},e=>this.metadata.reject(e))}close(){return this.Dc.cancel()}async getMetadata(){return this.metadata.promise}async Pc(){return await this.getMetadata(),this.xc()}async xc(){var e=await this.Nc();if(null===e)return null;var t=this.Cc.decode(e),n=Number(t);isNaN(n)&&this.kc(`length string (${t}) is not valid number`);t=await this.Mc(n);return new Fl(JSON.parse(t),e.length+n)}Oc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Nc(){for(;this.Oc()<0&&!await this.$c(););if(0===this.buffer.length)return null;var e=this.Oc();e<0&&this.kc("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Mc(e){for(;this.buffer.length<e;)await this.$c()&&this.kc("Reached the end of bundle when more is expected.");var t=this.Cc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}kc(e){throw this.Dc.cancel(),new Error(`Invalid bundle format: ${e}`)}async $c(){var e=await this.Dc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class gd{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new $r(zr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=yu(r.serializer)+"/documents",i={documents:t.map(e=>fu(r.serializer,e))},s=await r.Ao("BatchGetDocuments",n,i,t.length),a=new Map;s.forEach(e=>{const t=(n=r.serializer,"found"in(e=e)?function(e,t){Gr(!!t.found),t.found.name,t.found.updateTime;var n=gu(e,t.found.name),r=hu(t.found.updateTime),i=t.found.createTime?hu(t.found.createTime):oi.min(),s=new ea({mapValue:{fields:t.found.fields}});return ta.newFoundDocument(n,r,i,s)}(n,e):"missing"in e?function(e,t){Gr(!!t.missing),Gr(!!t.readTime);var n=gu(e,t.missing),r=hu(t.readTime);return ta.newNoDocument(n,r)}(n,e):Kr());var n;a.set(t.key.toString(),t)});const o=[];return t.forEach(e=>{var t=a.get(e.toString());Gr(!!t),o.push(t)}),o}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ro(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{var n=di.fromPath(t);this.mutations.push(new Mo(n,this.precondition(n)))}),await async function(e,t){const n=e,r=yu(n.serializer)+"/documents",i={writes:t.map(e=>Iu(n.serializer,e))};await n.po("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Kr();t=oi.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new $r(zr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(oi.min())?bo.exists(!1):bo.updateTime(t):bo.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return bo.exists(!0);if(t.isEqual(oi.min()))throw new $r(zr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return bo.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class md{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Fc=n.maxAttempts,this.Lo=new Yh(this.asyncQueue,"transaction_retry")}run(){--this.Fc,this.Bc()}Bc(){this.Lo.xo(async()=>{const t=new gd(this.datastore),e=this.Lc(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.qc(e)}))}).catch(e=>{this.qc(e)})})}Lc(e){try{var t=this.updateFunction(e);return!Vi(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}qc(e){0<this.Fc&&this.Uc(e)?(--this.Fc,this.asyncQueue.enqueueAndForget(()=>(this.Bc(),Promise.resolve()))):this.deferred.reject(e)}Uc(e){if("FirebaseError"!==e.name)return!1;var t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Vo(t)}}class pd{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Lr.UNAUTHENTICATED,this.clientId=ni.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{qr("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(qr("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new $r(zr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new Qr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=_l(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function yd(e,t){e.asyncQueue.verifyOperationInProgress(),qr("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await bh(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function vd(e,n){e.asyncQueue.verifyOperationInProgress();var t=await bd(e);qr("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await n.initialize(t,r),e.setCredentialChangeListener(e=>wl(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>wl(n.remoteStore,t)),e._onlineComponents=n}function wd(e){return"FirebaseError"===e.name?e.code===zr.FAILED_PRECONDITION||e.code===zr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function bd(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){qr("FirestoreClient","Using user provided OfflineComponentProvider");try{await yd(t,t._uninitializedComponentsProvider._offline)}catch(e){var n=e;if(!wd(n))throw n;Ur("Error using user provided cache. Falling back to memory cache: "+n),await yd(t,new od)}}else qr("FirestoreClient","Using default OfflineComponentProvider"),await yd(t,new od);return t._offlineComponents}async function Id(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(qr("FirestoreClient","Using user provided OnlineComponentProvider"),await vd(e,e._uninitializedComponentsProvider._online)):(qr("FirestoreClient","Using default OnlineComponentProvider"),await vd(e,new hd))),e._onlineComponents}function Ed(e){return bd(e).then(e=>e.persistence)}function Td(e){return bd(e).then(e=>e.localStore)}function _d(e){return Id(e).then(e=>e.remoteStore)}function Sd(e){return Id(e).then(e=>e.syncEngine)}async function xd(e){const t=await Id(e),n=t.eventManager;return n.onListen=(async function(e,t){const n=sd(e);let r,i;const s=n.dc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.hc();else{const e=await _h(n.localStore,qa(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Gl(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&al(n.remoteStore,e)}return i}).bind(null,t.syncEngine),n.onUnlisten=(async function(e,t){const n=e,r=n.dc.get(t),i=n._c.get(r.targetId);if(1<i.length)return n._c.set(r.targetId,i.filter(e=>!ja(e,t))),void n.dc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Sh(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),ol(n.remoteStore,r.targetId),Yl(n,r.targetId)}).catch(_i)):(Yl(n,r.targetId),await Sh(n.localStore,r.targetId,!0))}).bind(null,t.syncEngine),n}function Dd(e,t,n={}){const r=new Qr;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,i,s,a){const e=new dd({next:e=>{r.enqueueAndForget(()=>kl(n,o));var t=e.docs.has(i);!t&&e.fromCache?a.reject(new $r(zr.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?a.reject(new $r(zr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(e)},error:e=>a.reject(e)}),o=new Ml(Ma(i.path),e,{includeMetadataChanges:!0,Uu:!0});return Nl(n,o)}(await xd(e),e.asyncQueue,t,n,r)),r.promise}function Ad(e,t,n={}){const r=new Qr;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,i){const s=new dd({next:e=>{n.enqueueAndForget(()=>kl(t,a)),e.fromCache&&"server"===r.source?i.reject(new $r(zr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),a=new Ml(e,s,{includeMetadataChanges:!0,Uu:!0});return Nl(t,a)}(await xd(e),e.asyncQueue,t,n,r)),r.promise}function Cd(e,t,n,r){const i=(n=n,t=Xh(t),s="string"==typeof n?jo().encode(n):n,n=function(e){if(e instanceof Uint8Array)return ld(e,void 0);if(e instanceof ArrayBuffer)return ld(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(s),t=t,new fd(n,t));var s;e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=hu(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ls.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);r._updateProgress(Pl(i));const a=new Ol(i,t.localStore,n.serializer);let e=await n.Pc();for(;e;){const t=await a.ju(e);t&&r._updateProgress(t),e=await n.Pc()}var s=await a.complete();return await td(t,s.Hu,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ls.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress),Promise.resolve(s.Wu)}catch(t){return Ur("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t),Promise.resolve(new Set)}}(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}(await Sd(e),i,r)})}const Nd=new Map;function kd(e,t,n){if(!n)throw new $r(zr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Rd(e,t,n,r){if(!0===t&&!0===r)throw new $r(zr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Md(e){if(!di.isDocumentKey(e))throw new $r(zr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Fd(e){if(di.isDocumentKey(e))throw new $r(zr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Ld(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Kr();if(e instanceof Array)return"an array";var t=(e=e).constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}function Od(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new $r(zr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Ld(e);throw new $r(zr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}function Pd(e,t){if(t<=0)throw new $r(zr.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Vd{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new $r(zr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new $r(zr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Rd("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling||void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!1:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class qd{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Vd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new $r(zr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new $r(zr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Vd(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Wr;switch(e.type){case"firstParty":return new Zr(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new $r(zr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Nd.get(e);t&&(qr("ComponentProvider","Removing Datastore"),Nd.delete(e),t.terminate())}(this),Promise.resolve()}}function Bd(n,e,t,r={}){var i;const s=(n=Od(n,qd))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&Ur("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let e,t;if("string"==typeof r.mockUserToken)e=r.mockUserToken,t=Lr.MOCK_USER;else{e=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e),[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(i)),""].join(".")}(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new $r(zr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new Lr(s)}n._authCredentials=new Xr(new Hr(e,t))}}class Ud{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Kd(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ud(this.firestore,e,this._key)}}class jd{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new jd(this.firestore,e,this._query)}}class Kd extends jd{constructor(e,t,n){super(e,t,Ma(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ud(this.firestore,null,new di(e))}withConverter(e){return new Kd(this.firestore,e,this._path)}}function Gd(e,t,...n){if(e=m(e),kd("collection","path",t),e instanceof qd){var r=ci.fromString(t,...n);return Fd(r),new Kd(e,null,r)}if(!(e instanceof Ud||e instanceof Kd))throw new $r(zr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(ci.fromString(t,...n));return Fd(r),new Kd(e.firestore,null,r)}function zd(e,t,...n){if(e=m(e),kd("doc","path",t=1===arguments.length?ni.A():t),e instanceof qd){var r=ci.fromString(t,...n);return Md(r),new Ud(e,null,new di(r))}if(!(e instanceof Ud||e instanceof Kd))throw new $r(zr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(ci.fromString(t,...n));return Md(r),new Ud(e.firestore,e instanceof Kd?e.converter:null,new di(r))}function $d(e,t){return e=m(e),t=m(t),(e instanceof Ud||e instanceof Kd)&&(t instanceof Ud||t instanceof Kd)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Qd(e,t){return e=m(e),t=m(t),e instanceof jd&&t instanceof jd&&e.firestore===t.firestore&&ja(e._query,t._query)&&e.converter===t.converter}class Hd{constructor(){this.Kc=Promise.resolve(),this.Gc=[],this.Qc=!1,this.jc=[],this.zc=null,this.Wc=!1,this.Hc=!1,this.Jc=[],this.Lo=new Yh(this,"async_queue_retry"),this.Yc=()=>{var e=Wh();e&&qr("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Lo.ko()};const e=Wh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Yc)}get isShuttingDown(){return this.Qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Xc(),this.Zc(e)}enterRestrictedMode(e){if(!this.Qc){this.Qc=!0,this.Hc=e||!1;const t=Wh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Yc)}}enqueue(e){if(this.Xc(),this.Qc)return new Promise(()=>{});const t=new Qr;return this.Zc(()=>this.Qc&&this.Hc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Gc.push(e),this.ta()))}async ta(){if(0!==this.Gc.length){try{await this.Gc[0](),this.Gc.shift(),this.Lo.reset()}catch(e){if(!Ni(e))throw e;qr("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Gc.length&&this.Lo.xo(()=>this.ta())}}Zc(e){var t=this.Kc.then(()=>(this.Wc=!0,e().catch(e=>{throw this.zc=e,this.Wc=!1,Br("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Wc=!1,e))));return this.Kc=t}enqueueAfterDelay(e,t,n){this.Xc(),-1<this.Jc.indexOf(e)&&(t=0);var r=Tl.createAndSchedule(this,e,t,n,e=>this.ea(e));return this.jc.push(r),r}Xc(){this.zc&&Kr()}verifyOperationInProgress(){}async na(){for(var e;await(e=this.Kc),e!==this.Kc;);}sa(e){for(const t of this.jc)if(t.timerId===e)return!0;return!1}ia(t){return this.na().then(()=>{this.jc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.jc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.na()})}ra(e){this.Jc.push(e)}ea(e){var t=this.jc.indexOf(e);this.jc.splice(t,1)}}function Wd(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class Xd{constructor(){this._progressObserver={},this._taskCompletionResolver=new Qr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var Yd,Jd,Zd;class ef extends qd{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Hd,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||nf(this),this._firestoreClient.terminate()}}function tf(e){return e._firestoreClient||nf(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function nf(e){var t,n,r,i,s,a=e._freezeSettings(),o=(n=e._databaseId,r=(null===(o=e._app)||void 0===o?void 0:o.options.appId)||"",i=e._persistenceKey,s=a,new Fs(n,r,i,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));e._firestoreClient=new pd(e._authCredentials,e._appCheckCredentials,e._queue,o),null!==(o=a.cache)&&void 0!==o&&o._offlineComponentProvider&&null!==(t=a.cache)&&void 0!==t&&t._onlineComponentProvider&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:a.cache.kind,_offline:a.cache._offlineComponentProvider,_online:a.cache._onlineComponentProvider})}function rf(e,t,n){const r=new Qr;return e.asyncQueue.enqueue(async()=>{try{await yd(e,n),await vd(e,t),r.resolve()}catch(e){const t=e;if(!wd(t))throw t;Ur("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}}).then(()=>r.promise)}function sf(e){return function(e){const t=new Qr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;dl(n.remoteStore)||qr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.Tc.get(e)||[];r.push(t),n.Tc.set(e,r)}catch(e){const n=_l(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await Sd(e),t)),t.promise}(tf(e=Od(e,ef)))}function af(e){return(n=tf(e=Od(e,ef))).asyncQueue.enqueue(async()=>{const e=await Ed(n),t=await _d(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.Au.delete(0),il(e)}()});var n}function of(e){return(n=tf(e=Od(e,ef))).asyncQueue.enqueue(async()=>{const e=await Ed(n),t=await _d(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.Au.add(0),await sl(e),e.Pu.set("Offline")}()});var n}function uf(t,e){return n=tf(t=Od(t,ef)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Ls.getNamedQuery(e,t))}(await Td(n),r)).then(e=>e?new jd(t,null,e.query):null);var n,r}function cf(e){if(e._initialized||e._terminated)throw new $r(zr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class hf{constructor(e){this._byteString=e}static fromBase64String(e){try{return new hf(xs.fromBase64String(e))}catch(e){throw new $r(zr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new hf(xs.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class lf{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new $r(zr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new li(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class df{constructor(e){this._methodName=e}}class ff{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new $r(zr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new $r(zr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ri(this._lat,e._lat)||ri(this._long,e._long)}}const gf=/^__.*__$/;class mf{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Ao(e,this.data,this.fieldMask,t,this.fieldTransforms):new Do(e,this.data,t,this.fieldTransforms)}}class pf{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Ao(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function yf(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Kr()}}class vf{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.oa(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ua(){return this.settings.ua}ca(e){return new vf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}aa(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ca({path:n,ha:!1});return r.la(e),r}fa(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ca({path:n,ha:!1});return r.oa(),r}da(e){return this.ca({path:void 0,ha:!0})}_a(e){return Vf(e,this.settings.methodName,this.settings.wa||!1,this.path,this.settings.ma)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}oa(){if(this.path)for(let e=0;e<this.path.length;e++)this.la(this.path.get(e))}la(e){if(0===e.length)throw this._a("Document fields must not be empty");if(yf(this.ua)&&gf.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class wf{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Xh(e)}ga(e,t,n,r=!1){return new vf({ua:e,methodName:t,ma:n,path:li.emptyPath(),ha:!1,wa:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function bf(e){var t=e._freezeSettings(),n=Xh(e._databaseId);return new wf(e._databaseId,!!t.ignoreUndefinedProperties,n)}function If(e,t,n,r,i,s={}){const a=e.ga(s.merge||s.mergeFields?2:0,t,n,i);Ff("Data must be an object, but it was:",a,r);var o=Rf(r,a);let u,c;if(s.merge)u=new _s(a.fieldMask),c=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Lf(t,r,n);if(!a.contains(i))throw new $r(zr.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);qf(e,i)||e.push(i)}u=new _s(e),c=a.fieldTransforms.filter(e=>u.covers(e.field))}else u=null,c=a.fieldTransforms;return new mf(new ea(o),u,c)}class Ef extends df{_toFieldTransform(e){if(2!==e.ua)throw 1===e.ua?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ef}}function Tf(e,t,n){return new vf({ua:3,ma:t.settings.ma,methodName:e._methodName,ha:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class _f extends df{_toFieldTransform(e){return new vo(e.path,new co)}isEqual(e){return e instanceof _f}}class Sf extends df{constructor(e,t){super(e),this.ya=t}_toFieldTransform(e){const t=Tf(this,e,!0),n=this.ya.map(e=>kf(e,t)),r=new ho(n);return new vo(e.path,r)}isEqual(e){return this===e}}class xf extends df{constructor(e,t){super(e),this.ya=t}_toFieldTransform(e){const t=Tf(this,e,!0),n=this.ya.map(e=>kf(e,t)),r=new fo(n);return new vo(e.path,r)}isEqual(e){return this===e}}class Df extends df{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){var t=new mo(e.serializer,ao(e.serializer,this.pa));return new vo(e.path,t)}isEqual(e){return this===e}}function Af(e,i,s,t){const a=e.ga(1,i,s);Ff("Data must be an object, but it was:",a,t);const o=[],u=ea.empty();ps(t,(e,t)=>{var n=Pf(i,e,s);t=m(t);var r=a.fa(n);if(t instanceof Ef)o.push(n);else{const e=kf(t,r);null!=e&&(o.push(n),u.set(n,e))}});var n=new _s(o);return new pf(u,n,a.fieldTransforms)}function Cf(e,t,n,r,i,s){const a=e.ga(1,t,n),o=[Lf(t,r,n)],u=[i];if(s.length%2!=0)throw new $r(zr.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)o.push(Lf(t,s[f])),u.push(s[f+1]);const c=[],h=ea.empty();for(let g=o.length-1;0<=g;--g)if(!qf(c,o[g])){const t=o[g];var l=m(l=u[g]);const r=a.fa(t);if(l instanceof Ef)c.push(t);else{const e=kf(l,r);null!=e&&(c.push(t),h.set(t,e))}}var d=new _s(c);return new pf(h,d,a.fieldTransforms)}function Nf(e,t,n,r=!1){return kf(n,e.ga(r?4:3,t))}function kf(s,e){if(Mf(s=m(s)))return Ff("Unsupported field value:",e,s),Rf(s,e);if(s instanceof df)return function(e,t){if(!yf(t.ua))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(s,e),null;if(void 0===s&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.ha&&4!==e.ua)throw e._a("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const i of s){let e=kf(i,t.da(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=m(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return ao(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=ai.fromDate(e);return{timestampValue:uu(t.serializer,n)}}if(e instanceof ai){n=new ai(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:uu(t.serializer,n)}}if(e instanceof ff)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof hf)return{bytesValue:cu(t.serializer,e._byteString)};if(e instanceof Ud){const r=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(r))throw t._a(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:lu(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a(`Unsupported field value: ${Ld(e)}`)}(0,e)}function Rf(e,r){const i={};return ys(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):ps(e,(e,t)=>{var n=kf(t,r.aa(e));null!=n&&(i[e]=n)}),{mapValue:{fields:i}}}function Mf(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ai||e instanceof ff||e instanceof hf||e instanceof Ud||e instanceof df)}function Ff(e,t,n){if(!Mf(n)||("object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))){var r=Ld(n);throw"an object"===r?t._a(e+" a custom object"):t._a(e+" "+r)}var i}function Lf(e,t,n){if((t=m(t))instanceof lf)return t._internalPath;if("string"==typeof t)return Pf(e,t);throw Vf("Field path arguments must be of type string or ",e,!1,void 0,n)}const Of=new RegExp("[~\\*/\\[\\]]");function Pf(t,n,r){if(0<=n.search(Of))throw Vf(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new lf(...n.split("."))._internalPath}catch(e){throw Vf(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function Vf(e,t,n,r,i){var s=r&&!r.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let u="";return(s||a)&&(u+=" (found",s&&(u+=` in field ${r}`),a&&(u+=` in document ${i}`),u+=")"),new $r(zr.INVALID_ARGUMENT,o+e+u)}function qf(e,t){return e.some(e=>e.isEqual(t))}class Bf{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ud(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new Uf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){var t=this._document.data.field(jf("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Uf extends Bf{data(){return super.data()}}function jf(e,t){return"string"==typeof t?Pf(e,t):(t instanceof lf?t:t._delegate)._internalPath}function Kf(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new $r(zr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Gf{}class zf extends Gf{}function $f(e,t,...n){let r=[];t instanceof Gf&&r.push(t),r=r.concat(n),function(e){var t=e.filter(e=>e instanceof Hf).length,n=e.filter(e=>e instanceof Qf).length;if(1<t||0<t&&0<n)throw new $r(zr.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class Qf extends zf{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Qf(e,t,n)}_apply(e){var t=this._parse(e);return ng(e._query,t),new jd(e.firestore,e.converter,Ba(e._query,t))}_parse(e){var t=bf(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new $r(zr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){tg(a,s);const t=[];for(const n of a)t.push(eg(r,e,n));o={arrayValue:{values:t}}}else o=eg(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||tg(a,s),o=Nf(n,t,a,"in"===s||"not-in"===s);return oa.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class Hf extends Gf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Hf(e,t)}_parse(t){var e=this._queryConstraints.map(e=>e._parse(t)).filter(e=>0<e.getFilters().length);return 1===e.length?e[0]:ua.create(e,this._getOperator())}_apply(e){const n=this._parse(e);return 0===n.getFilters().length?e:(function(e){let t=e;for(const e of n.getFlattenedFilters())ng(t,e),t=Ba(t,e)}(e._query),new jd(e.firestore,e.converter,Ba(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Wf extends zf{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Wf(e,t)}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new $r(zr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new $r(zr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i=new sa(t,n);return n=i,null!==La(e=e)||null!==(r=Oa(e))&&rg(0,r,n.field),i}(e._query,this._field,this._direction);return new jd(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new ka(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class Xf extends zf{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Xf(e,t,n)}_apply(e){return new jd(e.firestore,e.converter,Ua(e._query,this._limit,this._limitType))}}class Yf extends zf{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Yf(e,t,n)}_apply(e){var t,n=Zf(e,this.type,this._docOrFields,this._inclusive);return new jd(e.firestore,e.converter,(t=e._query,e=n,new ka(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class Jf extends zf{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Jf(e,t,n)}_apply(e){var t,n=Zf(e,this.type,this._docOrFields,this._inclusive);return new jd(e.firestore,e.converter,(t=e._query,e=n,new ka(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function Zf(e,t,n,r){if(n[0]=m(n[0]),n[0]instanceof Bf)return function(e,t,n,r,i){if(!r)throw new $r(zr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Va(e))if(n.field.isKeyField())s.push(Gs(t,r.key));else{const e=r.data.field(n.field);if(ks(e))throw new $r(zr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new $r(zr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new na(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=bf(e.firestore);return function(e,t,n,r,i,s){const a=e.explicitOrderBy;if(i.length>a.length)throw new $r(zr.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const o=[];for(let u=0;u<i.length;u++){const c=i[u];if(a[u].field.isKeyField()){if("string"!=typeof c)throw new $r(zr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Pa(e)&&-1!==c.indexOf("/"))throw new $r(zr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(ci.fromString(c));if(!di.isDocumentKey(n))throw new $r(zr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new di(n);o.push(Gs(t,i))}else{const e=Nf(n,r,c);o.push(e)}}return new na(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}function eg(e,t,n){if("string"==typeof(n=m(n))){if(""===n)throw new $r(zr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pa(t)&&-1!==n.indexOf("/"))throw new $r(zr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);var r=t.path.child(ci.fromString(n));if(!di.isDocumentKey(r))throw new $r(zr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Gs(e,new di(r))}if(n instanceof Ud)return Gs(e,n._key);throw new $r(zr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ld(n)}.`)}function tg(e,t){if(!Array.isArray(e)||0===e.length)throw new $r(zr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function ng(e,t){if(t.isInequality()){const r=Oa(e),i=t.field;if(null!==r&&!r.isEqual(i))throw new $r(zr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);var n=La(e);null!==n&&rg(0,i,n)}const r=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(0<=t.indexOf(e.op))return e.op;return null}(e.filters,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new $r(zr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new $r(zr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function rg(e,t,n){if(!n.isEqual(t))throw new $r(zr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class ig{convertValue(e,t="none"){switch(Vs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Cs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ns(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Kr()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,n="none"){const r={};return ps(e,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new ff(Cs(e.latitude),Cs(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=Rs(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ms(e));default:return null}}convertTimestamp(e){var t=As(e);return new ai(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ci.fromString(e);Gr(Nu(n));const r=new Ls(n.get(1),n.get(3)),i=new di(n.popFirst(5));return r.isEqual(t)||Br(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function sg(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class ag extends ig{constructor(e){super(),this.firestore=e}convertBytes(e){return new hf(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ud(this.firestore,null,t)}}class og{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ug extends Bf{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new cg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){var n=this._document.data.field(jf("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class cg extends ug{data(e={}){return super.data(e)}}class hg{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new og(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new cg(this._firestore,this._userDataWriter,e.key,e,new og(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new $r(zr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let n=0;return s._snapshot.docChanges.map(e=>{var t=new cg(s._firestore,s._userDataWriter,e.doc.key,e.doc,new og(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);return e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:n++}})}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new cg(s._firestore,s._userDataWriter,e.doc.key,e.doc,new og(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Kr()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function lg(e,t){return e instanceof ug&&t instanceof ug?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof hg&&t instanceof hg&&e._firestore===t._firestore&&Qd(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class dg extends ig{constructor(e){super(),this.firestore=e}convertBytes(e){return new hf(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ud(this.firestore,null,t)}}function fg(t){t=Od(t,Ud);const n=Od(t.firestore,ef),e=tf(n),r=new dg(n);return function(e,t){const n=new Qr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(t);i.isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new $r(zr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){var r=_l(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await Td(e),t,n)),n.promise}(e,t._key).then(e=>new ug(n,r,t._key,e,new og(null!==e&&e.hasLocalMutations,!0),t.converter))}function gg(t){t=Od(t,jd);const n=Od(t.firestore,ef),e=tf(n),r=new dg(n);return function(e,t){const n=new Qr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await xh(e,t,!0),s=new Bl(t,i.sr),a=s.nc(i.documents),o=s.applyChanges(a,!1);n.resolve(o.snapshot)}catch(e){var r=_l(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await Td(e),t,n)),n.promise}(e,t._query).then(e=>new hg(n,r,t,e))}function mg(e,t,n){e=Od(e,Ud);var r=Od(e.firestore,ef),i=sg(e.converter,t,n);return wg(r,[If(bf(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,bo.none())])}function pg(e,t,n,...r){e=Od(e,Ud);var i=Od(e.firestore,ef),s=bf(i);let a;return a="string"==typeof(t=m(t))||t instanceof lf?Cf(s,"updateDoc",e._key,t,n,r):Af(s,"updateDoc",e._key,t),wg(i,[a.toMutation(e._key,bo.exists(!0))])}function yg(t,...n){var e;t=m(t);let r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||Wd(n[i])||(r=n[i],i++);var s={includeMetadataChanges:r.includeMetadataChanges};if(Wd(n[i])){const t=n[i];n[i]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[i+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[i+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let a,o,u;if(t instanceof Ud)o=Od(t.firestore,ef),u=Ma(t._key.path),a={next:e=>{n[i]&&n[i](bg(o,t,e))},error:n[i+1],complete:n[i+2]};else{const c=Od(t,jd);o=Od(c.firestore,ef),u=c._query;const h=new dg(o);a={next:e=>{n[i]&&n[i](new hg(o,h,c,e))},error:n[i+1],complete:n[i+2]},Kf(t._query)}return function(e,t,n,r){const i=new dd(r),s=new Ml(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>Nl(await xd(e),s)),()=>{i.Sc(),e.asyncQueue.enqueueAndForget(async()=>kl(await xd(e),s))}}(tf(o),u,s,a)}function vg(e,t){return function(e,t){const n=new dd(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Nu.add(t),t.next()}(await xd(e),n)),()=>{n.Sc(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Nu.delete(t)}(await xd(e),n))}}(tf(e=Od(e,ef)),Wd(t)?t:{next:t})}function wg(e,t){return function(e,t){const n=new Qr;return e.asyncQueue.enqueueAndForget(async()=>zl(await Sd(e),t,n)),n.promise}(tf(e),t)}function bg(e,t,n){var r=n.docs.get(t._key),i=new dg(e);return new ug(e,i,t._key,r,new og(n.hasPendingWrites,n.fromCache),t.converter)}const Ig={maxAttempts:5};class Eg{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=bf(e)}set(e,t,n){this._verifyNotCommitted();const r=Tg(e,this._firestore),i=sg(r.converter,t,n),s=If(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,bo.none())),this}update(e,t,n,...r){this._verifyNotCommitted();var i=Tg(e,this._firestore);let s;return s="string"==typeof(t=m(t))||t instanceof lf?Cf(this._dataReader,"WriteBatch.update",i._key,t,n,r):Af(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,bo.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=Tg(e,this._firestore);return this._mutations=this._mutations.concat(new Ro(t._key,bo.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new $r(zr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Tg(e,t){if((e=m(e)).firestore!==t)throw new $r(zr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class _g extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=bf(e)}get(e){const n=Tg(e,this._firestore),r=new ag(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return Kr();const t=e[0];if(t.isFoundDocument())return new Bf(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new Bf(this._firestore,r,n._key,null,n.converter);throw Kr()})}set(e,t,n){var r=Tg(e,this._firestore),i=sg(r.converter,t,n),i=If(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(e,t,n,...r){var i=Tg(e,this._firestore),s="string"==typeof(t=m(t))||t instanceof lf?Cf(this._dataReader,"Transaction.update",i._key,t,n,r):Af(this._dataReader,"Transaction.update",i._key,t);return this._transaction.update(i._key,s),this}delete(e){var t=Tg(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Tg(e,this._firestore),n=new dg(this._firestore);return super.get(e).then(e=>new ug(this._firestore,n,t._key,e._document,new og(!1,!1),t.converter))}}function Sg(t,n,e){t=Od(t,ef);var r=Object.assign(Object.assign({},Ig),e);return function(){if(r.maxAttempts<1)throw new $r(zr.INVALID_ARGUMENT,"Max attempts must be at least 1")}(),function(t,n,r){const i=new Qr;return t.asyncQueue.enqueueAndForget(async()=>{var e=await Id(t).then(e=>e.datastore);new md(t.asyncQueue,e,r,n,i).run()}),i.promise}(tf(t),e=>n(new _g(t,e)),r)}Yd=Jg.SDK_VERSION,Or=Yd,Jg._registerComponent(new p("firestore",(e,{instanceIdentifier:t,options:n})=>{const r=e.getProvider("app").getImmediate(),i=new ef(new Yr(e.getProvider("auth-internal")),new ti(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new $r(zr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ls(e.options.projectId,t)}(r,t),r);return n=Object.assign({useFetchStreams:!0},n),i._setSettings(n),i},"PUBLIC").setMultipleInstances(!0)),Jg.registerVersion(Fr,"3.11.0",void 0),Jg.registerVersion(Fr,"3.11.0","esm2017");function xg(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new $r("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function Dg(){if("undefined"==typeof Uint8Array)throw new $r("unimplemented","Uint8Arrays are not available in this environment.")}function Ag(){if("undefined"==typeof atob)throw new $r("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Cg{constructor(e){this._delegate=e}static fromBase64String(e){return Ag(),new Cg(hf.fromBase64String(e))}static fromUint8Array(e){return Dg(),new Cg(hf.fromUint8Array(e))}toBase64(){return Ag(),this._delegate.toBase64()}toUint8Array(){return Dg(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Ng(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class kg{enableIndexedDbPersistence(e,t){return function(e,t){cf(e=Od(e,ef));var n=tf(e);if(n._uninitializedComponentsProvider)throw new $r(zr.FAILED_PRECONDITION,"SDK cache is already specified.");Ur("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");var r=e._freezeSettings(),i=new hd;return rf(n,i,new ud(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){cf(e=Od(e,ef));var t=tf(e);if(t._uninitializedComponentsProvider)throw new $r(zr.FAILED_PRECONDITION,"SDK cache is already specified.");Ur("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");var n=e._freezeSettings(),r=new hd;return rf(t,r,new cd(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new $r(zr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Qr;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!Di.D())return Promise.resolve();var t=e+"main";await Di.delete(t)}(mh(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class Rg{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Ls||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Ur("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){Bd(this._delegate,e,t,n)}enableNetwork(){return af(this._delegate)}disableNetwork(){return of(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Rd("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return sf(this._delegate)}onSnapshotsInSync(e){return vg(this._delegate,e)}get app(){if(!this._appCompat)throw new $r("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new $g(this,Gd(this._delegate,e))}catch(e){throw Vg(e,"collection()","Firestore.collection()")}}doc(e){try{return new Pg(this,zd(this._delegate,e))}catch(e){throw Vg(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Kg(this,function(e,t){if(e=Od(e,qd),kd("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new $r(zr.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new jd(e,null,(t=t,new ka(ci.emptyPath(),t)))}(this._delegate,e))}catch(e){throw Vg(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Sg(this._delegate,e=>t(new Fg(this,e)))}batch(){return tf(this._delegate),new Lg(new Eg(this._delegate,e=>wg(this._delegate,e)))}loadBundle(e){return t=this._delegate,e=e,n=tf(t=Od(t,ef)),r=new Xd,Cd(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return uf(this._delegate,e).then(e=>e?new Kg(this,e):null)}}class Mg extends ig{constructor(e){super(),this.firestore=e}convertBytes(e){return new Cg(new hf(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return Pg.forKey(t,this.firestore,null)}}class Fg{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Mg(e)}get(e){const t=Qg(e);return this._delegate.get(t).then(e=>new Ug(this._firestore,new ug(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){var r=Qg(e);return n?(xg("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=Qg(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=Qg(e);return this._delegate.delete(t),this}}class Lg{constructor(e){this._delegate=e}set(e,t,n){var r=Qg(e);return n?(xg("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=Qg(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=Qg(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Og{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){var n=new cg(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new jg(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Og.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new Og(e,new Mg(e),t),r.set(t,i)),i}}Og.INSTANCES=new WeakMap;class Pg{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Mg(e)}static forPath(e,t,n){if(e.length%2!=0)throw new $r("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new Pg(t,new Ud(t._delegate,n,new di(e)))}static forKey(e,t,n){return new Pg(t,new Ud(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new $g(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new $g(this.firestore,Gd(this._delegate,e))}catch(e){throw Vg(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=m(e))instanceof Ud&&$d(this._delegate,e)}set(e,t){t=xg("DocumentReference.set",t);try{return t?mg(this._delegate,e,t):mg(this._delegate,e)}catch(e){throw Vg(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?pg(this._delegate,e):pg(this._delegate,e,t,...n)}catch(e){throw Vg(e,"updateDoc()","DocumentReference.update()")}}delete(){return wg(Od((e=this._delegate).firestore,ef),[new Ro(e._key,bo.none())]);var e}onSnapshot(...e){var t=qg(e),n=Bg(e,e=>new Ug(this.firestore,new ug(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return yg(this._delegate,t,n)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?fg:"server"===(null==e?void 0:e.source)?function(t){t=Od(t,Ud);const n=Od(t.firestore,ef);return Dd(tf(n),t._key,{source:"server"}).then(e=>bg(n,t,e))}:function(t){t=Od(t,Ud);const n=Od(t.firestore,ef);return Dd(tf(n),t._key).then(e=>bg(n,t,e))})(this._delegate),t.then(e=>new Ug(this.firestore,new ug(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new Pg(this.firestore,e?this._delegate.withConverter(Og.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Vg(e,t,n){return e.message=e.message.replace(t,n),e}function qg(e){for(const t of e)if("object"==typeof t&&!Ng(t))return t;return{}}function Bg(e,t){var n;let r;return r=Ng(e[0])?e[0]:Ng(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{r.next&&r.next(t(e))},error:null===(n=r.error)||void 0===n?void 0:n.bind(r),complete:null===(n=r.complete)||void 0===n?void 0:n.bind(r)}}class Ug{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Pg(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return lg(this._delegate,e._delegate)}}class jg extends Ug{data(e){var t=this._delegate.data(e);return void 0!==t||Kr(),t}}class Kg{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Mg(e)}where(e,t,n){try{return new Kg(this.firestore,$f(this._delegate,(r=n,i=t,s=jf("where",e),Qf._create(s,i,r))))}catch(e){throw Vg(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new Kg(this.firestore,$f(this._delegate,([n,r="asc"]=[e,t],i=r,s=jf("orderBy",n),Wf._create(s,i))))}catch(e){throw Vg(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,i,s}limit(e){try{return new Kg(this.firestore,$f(this._delegate,(Pd("limit",t=e),Xf._create("limit",t,"F"))))}catch(e){throw Vg(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new Kg(this.firestore,$f(this._delegate,(Pd("limitToLast",t=e),Xf._create("limitToLast",t,"L"))))}catch(e){throw Vg(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new Kg(this.firestore,$f(this._delegate,function(...e){return Yf._create("startAt",e,!0)}(...e)))}catch(e){throw Vg(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Kg(this.firestore,$f(this._delegate,function(...e){return Yf._create("startAfter",e,!1)}(...e)))}catch(e){throw Vg(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Kg(this.firestore,$f(this._delegate,function(...e){return Jf._create("endBefore",e,!1)}(...e)))}catch(e){throw Vg(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Kg(this.firestore,$f(this._delegate,function(...e){return Jf._create("endAt",e,!0)}(...e)))}catch(e){throw Vg(e,"endAt()","Query.endAt()")}}isEqual(e){return Qd(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?gg:"server"===(null==e?void 0:e.source)?function(t){t=Od(t,jd);const n=Od(t.firestore,ef),e=tf(n),r=new dg(n);return Ad(e,t._query,{source:"server"}).then(e=>new hg(n,r,t,e))}:function(t){t=Od(t,jd);const n=Od(t.firestore,ef),e=tf(n),r=new dg(n);return Kf(t._query),Ad(e,t._query).then(e=>new hg(n,r,t,e))})(this._delegate),t.then(e=>new zg(this.firestore,new hg(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=qg(e),n=Bg(e,e=>new zg(this.firestore,new hg(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return yg(this._delegate,t,n)}withConverter(e){return new Kg(this.firestore,e?this._delegate.withConverter(Og.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Gg{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new jg(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class zg{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Kg(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new jg(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new Gg(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new jg(this._firestore,e))})}isEqual(e){return lg(this._delegate,e._delegate)}}class $g extends Kg{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new Pg(this.firestore,e):null}doc(e){try{return void 0===e?new Pg(this.firestore,zd(this._delegate)):new Pg(this.firestore,zd(this._delegate,e))}catch(e){throw Vg(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Od(e.firestore,ef),r=zd(e),i=sg(e.converter,t);return wg(n,[If(bf(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,bo.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new Pg(this.firestore,e))}isEqual(e){return $d(this._delegate,e._delegate)}withConverter(e){return new $g(this.firestore,e?this._delegate.withConverter(Og.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Qg(e){return Od(e,Ud)}const Hg={Firestore:Rg,GeoPoint:ff,Timestamp:ai,Blob:Cg,Transaction:Fg,WriteBatch:Lg,DocumentReference:Pg,DocumentSnapshot:Ug,Query:Kg,QueryDocumentSnapshot:jg,QuerySnapshot:zg,CollectionReference:$g,FieldPath:class Wg{constructor(...e){this._delegate=new lf(...e)}static documentId(){return new Wg(li.keyField().canonicalString())}isEqual(e){return(e=m(e))instanceof lf&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class Xg{constructor(e){this._delegate=e}static serverTimestamp(){const e=new _f("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Xg(e)}static delete(){const e=new Ef("deleteField");return e._methodName="FieldValue.delete",new Xg(e)}static arrayUnion(...e){const t=function(...e){return new Sf("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new Xg(t)}static arrayRemove(...e){const t=function(...e){return new xf("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new Xg(t)}static increment(e){const t=new Df("increment",e);return t._methodName="FieldValue.increment",new Xg(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,Pr.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};Jd=t.default,Zd=(e,t)=>new Rg(e,t,new kg),Jd.INTERNAL.registerComponent(new p("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return Zd(t,n)},"PUBLIC").setServiceProps(Object.assign({},Hg))),Jd.registerVersion("@firebase/firestore-compat","0.3.8")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore-compat.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore-compat.js.map
