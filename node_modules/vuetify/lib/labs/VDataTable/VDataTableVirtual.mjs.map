{"version":3,"file":"VDataTableVirtual.mjs","names":["VTable","VDataTableHeaders","VDataTableRows","createHeaders","makeDataTableHeaderProps","makeDataTableItemProps","useDataTableItems","makeDataTableExpandProps","provideExpanded","createSort","makeDataTableSortProps","provideSort","useSortedItems","createGroupBy","makeDataTableGroupProps","provideGroupBy","useGroupedItems","makeDataTableSelectProps","provideSelection","makeDataTableVirtualProps","useVirtual","useOptions","makeFilterProps","useFilter","provideDefaults","computed","ref","toRef","convertToUnit","genericComponent","useRender","makeVDataTableProps","VDataTableVirtual","name","props","emits","value","click:row","e","setup","_ref","emit","slots","groupBy","sortBy","multiSort","mustSort","columns","showSelect","showExpand","items","filterKeys","map","c","key","search","filteredItems","sortByWithGroups","opened","extractRows","sortedItems","flatItems","allRows","containerRef","paddingTop","paddingBottom","startIndex","stopIndex","itemHeight","handleScroll","visibleItems","slice","page","itemsPerPage","hideNoData","noDataText","_createVNode","fixedHeader","fixedFooter","height","hover","top","wrapper","border","length","bottom"],"sources":["../../../src/labs/VDataTable/VDataTableVirtual.tsx"],"sourcesContent":["// Components\nimport { VTable } from '@/components/VTable'\nimport { VDataTableHeaders } from './VDataTableHeaders'\nimport { VDataTableRows } from './VDataTableRows'\n\n// Composables\nimport { createHeaders, makeDataTableHeaderProps } from './composables/headers'\nimport { makeDataTableItemProps, useDataTableItems } from './composables/items'\nimport { makeDataTableExpandProps, provideExpanded } from './composables/expand'\nimport { createSort, makeDataTableSortProps, provideSort, useSortedItems } from './composables/sort'\nimport { createGroupBy, makeDataTableGroupProps, provideGroupBy, useGroupedItems } from './composables/group'\nimport { makeDataTableSelectProps, provideSelection } from './composables/select'\nimport { makeDataTableVirtualProps, useVirtual } from './composables/virtual'\nimport { useOptions } from './composables/options'\nimport { makeFilterProps, useFilter } from '@/composables/filter'\nimport { provideDefaults } from '@/composables/defaults'\n\n// Utlities\nimport { computed, ref, toRef } from 'vue'\nimport { convertToUnit, genericComponent, useRender } from '@/util'\nimport { makeVDataTableProps } from './VDataTable'\n\n// Types\nimport type { DataTableItem } from './types'\nimport type { VDataTableRowsSlots } from './VDataTableRows'\n\nexport type VDataTableVirtualSlots = VDataTableRowsSlots & {\n  top: []\n  headers: []\n  bottom: []\n}\n\nexport const VDataTableVirtual = genericComponent<VDataTableVirtualSlots>()({\n  name: 'VDataTableVirtual',\n\n  props: {\n    ...makeVDataTableProps(),\n    ...makeVDataTableProps(),\n    ...makeDataTableGroupProps(),\n    ...makeDataTableExpandProps(),\n    ...makeDataTableHeaderProps(),\n    ...makeDataTableItemProps(),\n    ...makeDataTableSelectProps(),\n    ...makeDataTableSortProps(),\n    ...makeDataTableVirtualProps(),\n    ...makeFilterProps(),\n  },\n\n  emits: {\n    'update:modelValue': (value: any[]) => true,\n    'update:sortBy': (value: any) => true,\n    'update:options': (value: any) => true,\n    'update:groupBy': (value: any) => true,\n    'update:expanded': (value: any) => true,\n    'click:row': (e: Event, value: { item: DataTableItem }) => true,\n  },\n\n  setup (props, { emit, slots }) {\n    const { groupBy } = createGroupBy(props)\n    const { sortBy, multiSort, mustSort } = createSort(props)\n\n    const { columns } = createHeaders(props, {\n      groupBy,\n      showSelect: toRef(props, 'showSelect'),\n      showExpand: toRef(props, 'showExpand'),\n    })\n    const { items } = useDataTableItems(props, columns)\n\n    const filterKeys = computed(() => columns.value.map(c => 'columns.' + c.key))\n    const search = toRef(props, 'search')\n    const { filteredItems } = useFilter<DataTableItem>(props, items, search, { filterKeys })\n\n    provideSort({ sortBy, multiSort, mustSort })\n    const { sortByWithGroups, opened, extractRows } = provideGroupBy({ groupBy, sortBy })\n\n    const { sortedItems } = useSortedItems(filteredItems, sortByWithGroups, columns)\n    const { flatItems } = useGroupedItems(sortedItems, groupBy, opened)\n\n    const allRows = computed(() => extractRows(flatItems.value))\n\n    provideSelection(props, allRows)\n    provideExpanded(props)\n\n    const {\n      containerRef,\n      paddingTop,\n      paddingBottom,\n      startIndex,\n      stopIndex,\n      itemHeight,\n      handleScroll,\n    } = useVirtual(props, flatItems)\n\n    const visibleItems = computed(() => {\n      return flatItems.value.slice(startIndex.value, stopIndex.value)\n    })\n\n    useOptions({\n      sortBy,\n      page: ref(1),\n      itemsPerPage: ref(-1),\n      groupBy,\n      search,\n    })\n\n    provideDefaults({\n      VDataTableRows: {\n        hideNoData: toRef(props, 'hideNoData'),\n        noDataText: toRef(props, 'noDataText'),\n      },\n    })\n\n    useRender(() => (\n      <VTable\n        class=\"v-data-table\"\n        style={{\n          '--v-table-row-height': convertToUnit(itemHeight.value),\n        }}\n        fixedHeader={ props.fixedHeader }\n        fixedFooter={ props.fixedFooter }\n        height={ props.height }\n        hover={ props.hover }\n      >\n        {{\n          top: slots.top,\n          wrapper: () => (\n            <div\n              ref={ containerRef }\n              onScroll={ handleScroll }\n              class=\"v-table__wrapper\"\n              style={{\n                height: convertToUnit(props.height),\n              }}\n            >\n              <table>\n                <thead>\n                  <VDataTableHeaders\n                    sticky={ props.fixedHeader }\n                    multiSort={ props.multiSort }\n                    v-slots={ slots }\n                  />\n                </thead>\n                <tbody>\n                  <tr style={{ height: convertToUnit(paddingTop.value), border: 0 }}>\n                    <td colspan={ columns.value.length } style={{ height: convertToUnit(paddingTop.value), border: 0 }}></td>\n                  </tr>\n\n                  <VDataTableRows\n                    items={ visibleItems.value }\n                    onClick:row={ props['onClick:row'] }\n                    v-slots={ slots }\n                  />\n\n                  <tr style={{ height: convertToUnit(paddingBottom.value), border: 0 }}>\n                    <td colspan={ columns.value.length } style={{ height: convertToUnit(paddingBottom.value), border: 0 }}></td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          ),\n          bottom: slots.bottom,\n        }}\n      </VTable>\n    ))\n  },\n})\n\nexport type VDataTableVirtual = InstanceType<typeof VDataTableVirtual>\n"],"mappings":"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"}